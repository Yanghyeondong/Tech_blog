{"componentChunkName":"component---src-templates-post-template-tsx","path":"/k8s_struct/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>과거에 K3s와 K8s를 비교하는 글을 쓰면서 클러스터에서 각 노드의 명명구조가 조금 다르다는 것을 느꼈습니다. 이같은 차이점을 정립할겸 K8s의 구조를 정리해 보았습니다.<br>\n<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d0a0d0b9505506d4ca64d676ab6f2887/48c10/k8s_ar.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgADBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHorRIp1f/EABUQAQEAAAAAAAAAAAAAAAAAAEEQ/9oACAEBAAEFAlb/AP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AVf/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAEAAwEBAAAAAAAAAAAAAAABABARITH/2gAIAQEAAT8hgDDrE6o9r//aAAwDAQACAAMAAAAQbB//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAwEBPxCI/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8Qo//EABsQAAMAAgMAAAAAAAAAAAAAAAABIUFxETGB/9oACAEBAAE/EOISlY3cJz0dFN0ydGzL2f/Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d0a0d0b9505506d4ca64d676ab6f2887/a59e9/k8s_ar.webp 192w,\n/static/d0a0d0b9505506d4ca64d676ab6f2887/0ca9f/k8s_ar.webp 384w,\n/static/d0a0d0b9505506d4ca64d676ab6f2887/dc9b9/k8s_ar.webp 768w,\n/static/d0a0d0b9505506d4ca64d676ab6f2887/e2c2f/k8s_ar.webp 1152w,\n/static/d0a0d0b9505506d4ca64d676ab6f2887/f3efb/k8s_ar.webp 1536w,\n/static/d0a0d0b9505506d4ca64d676ab6f2887/0efc7/k8s_ar.webp 1557w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d0a0d0b9505506d4ca64d676ab6f2887/150b2/k8s_ar.jpg 192w,\n/static/d0a0d0b9505506d4ca64d676ab6f2887/6985d/k8s_ar.jpg 384w,\n/static/d0a0d0b9505506d4ca64d676ab6f2887/19de6/k8s_ar.jpg 768w,\n/static/d0a0d0b9505506d4ca64d676ab6f2887/4472f/k8s_ar.jpg 1152w,\n/static/d0a0d0b9505506d4ca64d676ab6f2887/d58d1/k8s_ar.jpg 1536w,\n/static/d0a0d0b9505506d4ca64d676ab6f2887/48c10/k8s_ar.jpg 1557w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d0a0d0b9505506d4ca64d676ab6f2887/19de6/k8s_ar.jpg\"\n            alt=\".\"\n            title=\".\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>K8s 클러스터는 여러 노드로 구성되는데, 역할에 따라 다음과 같이 구분할 수 있다.</p>\n<h3 id=\"control-plane-컨트롤-플레인\" style=\"position:relative;\"><a href=\"#control-plane-%EC%BB%A8%ED%8A%B8%EB%A1%A4-%ED%94%8C%EB%A0%88%EC%9D%B8\" aria-label=\"control plane 컨트롤 플레인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Control plane 컨트롤 플레인</h3>\n<p>이전에는 마스터 노드라는 이름으로 불렸으며, 클러스터 관리를 수행한다.<br>\nAPI 서버, DNS 서버, 코어 시스템 컨트롤러 등이 동작한다.<br>\nAKS와 같은 클라우드 매니지드 서비스의 경우, 컨트롤 플레인이 추상화 되어있고 직접 관리하지 않는다.<br>\n하나의 클러스터에 여러 컨트롤 플레인을 사용할수도 있으며, 하나가 다운되면 투표를 통해 새로운 컨트롤 플레인 노드를 뽑는다.</p>\n<ul>\n<li><strong>API 서버</strong><br>\n클러스터 관리 요청을 처리해준다.<br>\nHTTPS 프로토콜을 사용하는 REST API 엔드포인트로 구현되어 있다.<br>\nkubectl로 접속하거나 내부 API로 접근한다.<br>\nkube-apiserver 파드에서 실행된다.</li>\n<li><strong>스케줄러</strong><br>\n파드 생성 요청시 파드를 실행할 노드를 선택한다.<br>\n직접 만든 스케줄러를 사용할 수도 있다.<br>\nkube-scheduler 파드에서 실행된다.</li>\n<li><strong>컨트롤러 매니저</strong><br>\n코어 컨트롤러를 구동한다. 노드 상태를 관찰하며 서비스 엔드포인트를 관리한다.<br>\nkube-controller-manager 파드에서 실행된다.</li>\n<li><strong>etcd</strong><br>\nk8s의 데이터 저장소. 분산 key-value DB로 구성되며, 클러스터내에 여러 복제본이 존재한다.</li>\n</ul>\n<h4 id=\"tip\" style=\"position:relative;\"><a href=\"#tip\" aria-label=\"tip permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TIP</h4>\n<p><strong>API</strong> : 두 시스템(어플리케이션)이 상호작용할 수 있게 하는 매개체<br>\n<strong>ENDPOINT</strong> : 컴퓨터 네트워크에 연결하고 정보를 교환하는 물리적 장치, 휴대폰 데스크톱 등. 좁은 의미에서는 커뮤니케이션 채널의 한쪽 끝에 해당하는 URI.<br>\n<strong>Proxy 프록시</strong> : 서버와 클라이언트 사이에서 중계기로서 대리 통신을 수행하는 것. 빠른 액세스(캐시)나 부담 분산, 안전한 통신을 위해 사용한다.</p>\n<h3 id=\"worker-node-워커-노드\" style=\"position:relative;\"><a href=\"#worker-node-%EC%9B%8C%EC%BB%A4-%EB%85%B8%EB%93%9C\" aria-label=\"worker node 워커 노드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Worker Node 워커 노드</h3>\n<p>이전에는 미니언이라는 이름으로 불렸으며, 클러스터가 수행하는 작업을 실제로 담당한다.<br>\nControl plane과 연결을 유지하며 파드 실행 요청을 받거나 관리하고 상태 보고를 보낸다.</p>\n<ul>\n<li><strong>kubelet (쿠블릿)</strong><br>\n노드 서버에서 구동되는 백그라운드 에이전트로, 프로세스 형태이다.<br>\n파드 생성 요청을 전달받고 생애주기를 관리하며, 상태 보고를 API 서버에 전달한다.</li>\n<li><strong>kube-proxy</strong><br>\n노드 내 파드끼리 통신이나 다른 노드 속 파드와의 통신에서 트래픽 라우팅을 담당한다.<br>\n노드마다 하나씩 배치된다.</li>\n<li><strong>컨테이너 런타임</strong><br>\nkubelet의 지시에 따라 파드 컨테이너를 관리한다. Docker, containerd 등을 사용하며, CRI를 준수하는 런타임을 사용할 수 있다.</li>\n</ul>\n<h4 id=\"kubeadm-큐브어드민\" style=\"position:relative;\"><a href=\"#kubeadm-%ED%81%90%EB%B8%8C%EC%96%B4%EB%93%9C%EB%AF%BC\" aria-label=\"kubeadm 큐브어드민 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubeadm (큐브어드민)</h4>\n<p>쿠버네티스 클러스터 구축 작업을 도와주는 도구.<br>\n컨트롤 플레인 초기화, 클러스터 노드 추가, 버전 업그레이드 등의 작업을 수행한다.</p>\n<h2 id=\"k3s-구조\" style=\"position:relative;\"><a href=\"#k3s-%EA%B5%AC%EC%A1%B0\" aria-label=\"k3s 구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>K3S 구조</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/150da00e5cbeecd179a039479644db79/87bab/k3s_ar.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.29166666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAQAF/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAECA//aAAwDAQACEAMQAAAB2UsaYmf/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAXEAADAQAAAAAAAAAAAAAAAAABECEx/9oACAEBAAE/ISXsf//aAAwDAQACAAMAAAAQvO//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAWEQEBAQAAAAAAAAAAAAAAAAAAASH/2gAIAQIBAT8Q1H//xAAbEAEAAgMBAQAAAAAAAAAAAAABABEhMUFR0f/aAAgBAQABPxDjzsVzYVXsVx9itk2RbKdQ1P/Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/150da00e5cbeecd179a039479644db79/a59e9/k3s_ar.webp 192w,\n/static/150da00e5cbeecd179a039479644db79/0ca9f/k3s_ar.webp 384w,\n/static/150da00e5cbeecd179a039479644db79/dc9b9/k3s_ar.webp 768w,\n/static/150da00e5cbeecd179a039479644db79/1a410/k3s_ar.webp 1089w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/150da00e5cbeecd179a039479644db79/150b2/k3s_ar.jpg 192w,\n/static/150da00e5cbeecd179a039479644db79/6985d/k3s_ar.jpg 384w,\n/static/150da00e5cbeecd179a039479644db79/19de6/k3s_ar.jpg 768w,\n/static/150da00e5cbeecd179a039479644db79/87bab/k3s_ar.jpg 1089w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/150da00e5cbeecd179a039479644db79/19de6/k3s_ar.jpg\"\n            alt=\"0\"\n            title=\"0\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\r\nk3s는 서버 노드와 에이전트 노드로 나뉜다.<br>\n두 노드 모두 kubelet, 컨테이너 런타임(container-d)를 실행한다.<br>\n서버 노드는 k3s server command를 실행시키며 control-plane과 datastore component(etcd로 추측됨)을 관리한다. 에이전트 노드는 k3s agent command를 실행시키며 control-plane과 datastore component가 없는 노드이다.</p>\n<h2 id=\"source\" style=\"position:relative;\"><a href=\"#source\" aria-label=\"source permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Source</h2>\n<ul>\n<li>『쿠버네티스 교과서』- 엘튼 스톤맨, 길벗<br>\n<a href=\"https://github.com/gilbutITbook/kiamol\" target=\"_blank\" rel=\"nofollow\">https://github.com/gilbutITbook/kiamol</a></li>\n</ul>","id":"5f1bc6e1-61f3-5cad-bef0-73ef01690f73","tableOfContents":"<ul>\n<li>\n<ul>\n<li>\n<p><a href=\"#control-plane-%EC%BB%A8%ED%8A%B8%EB%A1%A4-%ED%94%8C%EB%A0%88%EC%9D%B8\">Control plane 컨트롤 플레인</a></p>\n<ul>\n<li><a href=\"#tip\">TIP</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#worker-node-%EC%9B%8C%EC%BB%A4-%EB%85%B8%EB%93%9C\">Worker Node 워커 노드</a></p>\n<ul>\n<li><a href=\"#kubeadm-%ED%81%90%EB%B8%8C%EC%96%B4%EB%93%9C%EB%AF%BC\">kubeadm (큐브어드민)</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#k3s-%EA%B5%AC%EC%A1%B0\">K3S 구조</a></p>\n</li>\n<li>\n<p><a href=\"#source\">Source</a></p>\n</li>\n</ul>","frontmatter":{"title":"K8s는 어떻게 구성되어 있을까?","summary":"K8s 클러스터 구조를 정리해 봅니다.","date":"2024.04.21.","categories":["K8s","Tip"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcElEQVQoz42RT0sCURTF2+W8Gd+8f6Mz2USaG8F883zW1DSFmRFuy3XtooT2FUF9gJAiib5FGWjQtm1E4OdwEzIbF4W2CZksOFy4nPvjXDgTADk/peg8yhaQ6elxT8WOirge95DpQcNVEB85nhjZIzBHpnxmryGWI3YJJ9aI4dCEz+xiBObGwlhoVCowq9ICk2eLB++F/TcqjgGRETivUQmwCIcHD1NppSuI8eTG9V7j867du231dhufyVIdMW6lK1EqFZ2Hw4ZdpIlVyER656n+ELx0ei+d3uV9kNpuQyZoYtWwi7/CyPRiM+vI8leOOlePwfPrx/PrR70ZLNU6eMofWOZyOAx0rhEZmy3rlJNsrXLRvWn1G+1+5bxLs4c65bHZskYkCIe/8yEHWETU9LR7kqk2M9Xm9NLpJJhTcX5gja1KKMOqzNQWsVxIspqeoZYbT27GZtZ/PhyeDJCjYjFUXiVyIJwHSAyn8zf8f30B4xBu4XgMU4kAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/f87e807cf4148baca5e9ae8202c9aab8/e018d/k8s.png","srcSet":"/static/f87e807cf4148baca5e9ae8202c9aab8/c6b60/k8s.png 480w,\n/static/f87e807cf4148baca5e9ae8202c9aab8/f5e84/k8s.png 960w,\n/static/f87e807cf4148baca5e9ae8202c9aab8/e018d/k8s.png 1920w","sizes":"(min-width: 1920px) 1920px, 100vw"},"sources":[{"srcSet":"/static/f87e807cf4148baca5e9ae8202c9aab8/0df1a/k8s.webp 480w,\n/static/f87e807cf4148baca5e9ae8202c9aab8/eeb31/k8s.webp 960w,\n/static/f87e807cf4148baca5e9ae8202c9aab8/702da/k8s.webp 1920w","type":"image/webp","sizes":"(min-width: 1920px) 1920px, 100vw"}]},"width":1920,"height":1080}},"publicURL":"/static/f87e807cf4148baca5e9ae8202c9aab8/k8s.png"}}}}]}},"pageContext":{"slug":"/k8s_struct/"}},"staticQueryHashes":[]}