---
date: '2023-02-03'
title: '[SW Coaching - Week 3] Pandas Dataframe ë‹¤ë£¨ê¸°'
categories: ['Python','WebScraping','SW-Coaching']
summary: 'íŒŒì´ì¬ Web Scraping, Pandas, iloc, ëŒë‹¤ í‘œí˜„ì‹'
thumbnail: './sw-coaching-week-3/title.png'
---

*ë³¸ í¬ìŠ¤íŠ¸ëŠ” IOWA ëŒ€í•™ **ì´ê°•í‘œ**(Kang-Pyo Lee) ë°•ì‚¬ë‹˜ì˜ í—ˆë½ì„ êµ¬í•˜ê³  ê°•ì˜ë¥¼ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤.*  
*ê°•ì˜ ì‚¬ì§„, ì½”ë“œì˜ ì €ì‘ê¶Œì€ ëª¨ë‘ ì´ê°•í‘œ ë°•ì‚¬ë‹˜ê»˜ ìˆìŠµë‹ˆë‹¤.*


## 1. ê°•ì˜ ì •ë¦¬
~~ì„¤ ì—°íœ´ë¡œ í¬ìŠ¤íŒ…ì´ ì¢€ ë°€ë ¸ìŠµë‹ˆë‹¤~~  
ì´ë²ˆ ê°•ì˜ë„ ì‹¤ìŠµ ìœ„ì£¼ë¡œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤. ì¼ë¶€ ì¤‘ìš”ì ë§Œ ì •ë¦¬í•˜ì—¬ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.   
### dataframe ì ‘ê·¼
ìš°ì„  ê°„ë‹¨í•˜ê²Œ import ë° ë¶ˆëŸ¬ì˜¤ê¸°ë¥¼ ì§„í–‰í•©ë‹ˆë‹¤.  
```py
import pandas as pd
df = pd.read_csv(f"test.csv", sep="\t")
```
ë‹¤ìŒìœ¼ë¡œ ì¸ë±ì‹±ì„ í†µí•´ rowì— ì ‘ê·¼í•´ ë³´ê² ìŠµë‹ˆë‹¤.  
```py
df[0] # error
```
ìœ„ì˜ ì½”ë“œì—ì„œ `df[0]` ë¶€ë¶„ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤. dataframeì—ì„œ íŠ¹ì • rowë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì˜ˆì‹œì²˜ëŸ¼ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì¦‰, ë²”ìœ„ ì¸ë±ì‹±ë§Œ ê°€ëŠ¥í•œ ê²ƒì…ë‹ˆë‹¤.  
```py
df[0:1]
df[:-1]
df[1:]
```
\
ë‹¤ìŒìœ¼ë¡œ íŠ¹ì • column ì˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²½ìš°ì…ë‹ˆë‹¤.  
ì˜ˆì‹œë¡œ `text`ë¼ëŠ” columnì˜ 0ë²ˆì§¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ë³´ê² ìŠµë‹ˆë‹¤. 
```py
df["text"][0]
```
ë°˜ëŒ€ë¡œ ì‘ì„±í•  ê²½ìš° ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  
```py
df[0]["text"] # error
```
\
ë‹¤ìŒìœ¼ë¡œ `.iloc()`ì„ ì´ìš©í•œ ì ‘ê·¼ì…ë‹ˆë‹¤.  
```py
df.iloc[0]
```
ìœ„ì˜ ì½”ë“œëŠ” `df[0]`ì™€ ë‹¤ë¥´ê²Œ ì˜¤ë¥˜ê°€ ë‚˜ì§€ ì•Šìœ¼ë©°, 0ë²ˆì§¸ rowê°€ ì˜ ì¶œë ¥ë©ë‹ˆë‹¤.  
`.iloc()`ì˜ ê²½ìš° rowì™€ columnì˜ ë™ì‹œ ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.  
```py
df.iloc[-3:, -2:] # Return the last 3 rows in the last 2 columns
```
ì¡°ê±´ì„ ë‹¤ëŠ” ê²ƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.  
```py
df[df.retweet_count > 5000]  # rows with its retweet_count larger than 5000
```
\
ë§ˆì§€ë§‰ìœ¼ë¡œ ë°˜ë³µë¬¸ì„ í†µí•œ row ì¶œë ¥ì…ë‹ˆë‹¤.  
```py
for idx, row in df2.iterrows():
    sid = row.status_id
    text = row.text
    print(f"[{idx}]\nsid: {sid}\ntext: {text}\n")
```


### dataframe ìˆ˜ì •

í˜„ì¬ dataframeì— ìƒˆë¡œìš´ columnì´ë‚˜ ë°ì´í„°ë¥¼ ë§Œë“œëŠ” ë²•ì„ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.  

```py
df["text_length"] = df.text.apply(lambda x: len(x))
```
`text_length`ë¼ëŠ” columnì„ ìƒˆë¡œ ë§Œë“­ë‹ˆë‹¤. ì´ë•Œ ê° rowì˜ ë‚´ìš©ì€ `text` columnì˜ ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¨ í›„ ëŒë‹¤ í‘œí˜„ì‹ì„ í†µí•´ ê¸¸ì´ë¥¼ ê³„ì‚°í•˜ì—¬ ì±„ì›ë‹ˆë‹¤.  
\
ë‹¤ìŒê³¼ ê°™ì´ dataframe ì „ì²´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.  
```py
df["text_detailed"] = df.apply(lambda x: f"[{x.created_at}] {x.text}", axis=1)
```
\
stringì˜ ê²½ìš°, êµ³ì´ ëŒë‹¤ì‹ì„ ì‚¬ìš©í•˜ì§€ ì•Šë”ë¼ë„ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
```py
df["text_splits"] = df.text.str.split()
df["text_nospace"] = df.text.str.replace(" ", "_")
df["mention_covid"] = df.text.str.contains("covid", case=False)
df["num_hashtags"] = df.text.str.count("#")
```
### dataframe ì €ì¥

ìˆ˜ì •í•˜ê±°ë‚˜ ìƒˆë¡œ ë§Œë“  dataframeì€ ë‹¤ìŒê³¼ ê°™ì´ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
```py
# text ë¶€ë¶„ë§Œ csvë¡œ ì €ì¥
df.text.to_csv(f"{outcome_folder}/timeline_copy.csv", index=False)
# ì „ì²´ dataframeì„ csvë¡œ ì €ì¥
df.to_csv(f"{outcome_folder}/timeline_copy1.csv", sep="\t", index=False)
```

## 2. ì½”ë“œ ì½”ì¹­
*ì½”ë“œ ì „ë¬¸ì€ ë¶„ëŸ‰ìƒ ì œì™¸í•˜ì˜€ìœ¼ë©°, í”¼ë“œë°± ìœ„ì£¼ë¡œ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤. Colab í™˜ê²½ì„ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤.*  

### í•¨ìˆ˜ ìµœì í™”
dataframeì´ í´ìˆ˜ë¡ ì ìš©ì‹œí‚¤ëŠ” í•¨ìˆ˜ í•˜ë‚˜í•˜ë‚˜ì˜ ìµœì í™”ì— ë”°ë¼ ì‚¬ìš© ì‹œê°„ì´ í¬ê²Œ ë³€í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì•„ë˜ì˜ ì½”ë“œëŠ”  ê°„ë‹¨íˆ ëŒë‹¤ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ `split()`ë¥¼ 2ë²ˆ ì‹œí–‰í•©ë‹ˆë‹¤.
```py
%time df["first_last_token"] = df.text.apply(lambda x: (x.split()[0], x.split()[-1]))
# CPU times: user 14.7 ms, sys: 941 Âµs, total: 15.7 ms Wall time: 19.5 ms
```
í•˜ì§€ë§Œ ì´ë¥¼ ë‹¤ìŒ ì½”ë“œì²˜ëŸ¼ ìƒˆ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ `split()`ì„ í•œ ë²ˆë§Œ ì‚¬ìš©í•œë‹¤ë©´ ì‹œê°„ì„ ì ˆë°˜ìœ¼ë¡œ ì ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
```py
def get_token(x :str)-> tuple:
    splited = x.split()
    return(splited[0], splited[-1])

%time df["first_last_token"] = df.text.apply(lambda x: get_token(x))
# CPU times: user 5.92 ms, sys: 1.94 ms, total: 7.86 ms Wall time: 8.05 ms
```
### [] ì ‘ê·¼ vs . ì ‘ê·¼
dataframeì˜ íŠ¹ì • columnì— ì ‘ê·¼í•  ë•Œ ë‹¤ìŒê³¼ ê°™ì´ `[]` ë¿ë§Œ ì•„ë‹ˆë¼ `.`ìœ¼ë¡œ ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.  
```py
df["text"]
df.text
```
í•˜ì§€ë§Œ, ìƒˆë¡œìš´ columnì„ ë§Œë“¤ ë•ŒëŠ” `.`ì´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê¼­ `[]`ë¥¼ ì‚¬ìš©í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.  
```py
df["text_shortened"] = df.text.apply(lambda x: x[:30] + "...")
df.text_shortened = df.text.apply(lambda x: x[:30] + "...") # error
```

## 3. ëŠë‚€ ì 
ì§€ê¸ˆê¹Œì§€ Web scrapingìœ¼ë¡œ ~~í˜ë“¤ê²Œ~~ ìˆ˜ì§‘í•œ ë°ì´í„°ë“¤ì„ ì§ì ‘ ìˆ˜ì •í•˜ê³  í™•ì¸í•´ ë³´ëŠ” ì‹œê°„ì´ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ë§ì€ ë°ì´í„°ë¥¼ ì´í† ë¡ ì‰½ê³  ë¹ ë¥´ê²Œ ë‹¤ë£¨ëŠ” pandasê°€ ìƒˆì‚¼ ëŒ€ë‹¨í•˜ê²Œ ëŠê»´ì¡ŒìŠµë‹ˆë‹¤. ë‹¤ìŒ ì‹œê°„ì— ë°°ìš°ëŠ” í´ëŸ¬ìŠ¤í„°ë§ê³¼ í† í”½ ëª¨ë¸ë§ìœ¼ë¡œ ì¢€ ë” ê¹Šì€ ë¶„ì„ì„ í•˜ëŠ” ìˆœê°„ì´ ê¸°ë‹¤ë ¤ì§‘ë‹ˆë‹¤. ğŸ˜


## Source
- ì„±ê· ê´€ëŒ€í•™êµ SW Coaching í”„ë¡œê·¸ë¨  
- ì´ê°•í‘œ(Kang-Pyo Lee) ë°•ì‚¬ë‹˜ ê°•ì˜  

<!--
1ì£¼ Web Scraping ê¸°ì´ˆ
2ì£¼ Web Scraping ì‹¬í™”
3ì£¼ Pandas Dataframe ë‹¤ë£¨ê¸°
4ì£¼ í…ìŠ¤íŠ¸ ë°ì´í„° ì²˜ë¦¬
5ì£¼ ë¬¸ì„œ í´ëŸ¬ìŠ¤í„°ë§ ë° í† í”½ ëª¨ë¸ë§
6ì£¼ ê°œì¸ í”„ë¡œì íŠ¸ ë°œí‘œ
-->