{"componentChunkName":"component---src-templates-post-template-tsx","path":"/xv6_2/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p><em>해당 포스트는 MIT의 교육용 운영체제 XV6를 활용하며, 코드 저작권은 MIT에 있음을 밝힙니다.</em></p>\n<h2 id=\"목표\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%ED%91%9C\" aria-label=\"목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목표</h2>\n<h3 id=\"cfs-scheduler-구현\" style=\"position:relative;\"><a href=\"#cfs-scheduler-%EA%B5%AC%ED%98%84\" aria-label=\"cfs scheduler 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CFS scheduler 구현</h3>\n<h2 id=\"과정\" style=\"position:relative;\"><a href=\"#%EA%B3%BC%EC%A0%95\" aria-label=\"과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>과정</h2>\n<h4 id=\"0-make-file-cpu-수정\" style=\"position:relative;\"><a href=\"#0-make-file-cpu-%EC%88%98%EC%A0%95\" aria-label=\"0 make file cpu 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0. Make file cpu 수정</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\nifndef CPUS\r\nCPUS <span class=\"token operator\">:</span><span class=\"token operator\">=</span> <span class=\"token number\">1</span>\r\nendif\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>원활한 테스트를 위해 사용 cpu 수를 1개로 제한하였다.</p>\n<h4 id=\"1-proc-구조체에-runtime-vruntime-time_slice-run_d_wruntimeweight-추가-및-초기화\" style=\"position:relative;\"><a href=\"#1-proc-%EA%B5%AC%EC%A1%B0%EC%B2%B4%EC%97%90-runtime-vruntime-time_slice-run_d_wruntimeweight-%EC%B6%94%EA%B0%80-%EB%B0%8F-%EC%B4%88%EA%B8%B0%ED%99%94\" aria-label=\"1 proc 구조체에 runtime vruntime time_slice run_d_wruntimeweight 추가 및 초기화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. proc 구조체에 runtime, vruntime, time_slice, run_d_w(runtime/weight) 추가 및 초기화</h4>\n<p>proc.h</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token keyword\">struct</span> <span class=\"token class-name\">inode</span> <span class=\"token operator\">*</span>cwd<span class=\"token punctuation\">;</span>           <span class=\"token comment\">// Current directory</span>\r\n  <span class=\"token keyword\">char</span> name<span class=\"token punctuation\">[</span><span class=\"token number\">16</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>               <span class=\"token comment\">// Process name (debugging)</span>\r\n  <span class=\"token keyword\">int</span> nice<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">int</span> runtime<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">int</span> vruntime<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">int</span> time_slice<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">int</span> run_d_w<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>proc.c</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\nfound<span class=\"token operator\">:</span>\r\n  p<span class=\"token operator\">-></span>state <span class=\"token operator\">=</span> EMBRYO<span class=\"token punctuation\">;</span>\r\n  p<span class=\"token operator\">-></span>pid <span class=\"token operator\">=</span> nextpid<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n  p<span class=\"token operator\">-></span>nice <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">;</span>\r\n  p<span class=\"token operator\">-></span>runtime <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n  p<span class=\"token operator\">-></span>vruntime <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n  p<span class=\"token operator\">-></span>time_slice <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n  p<span class=\"token operator\">-></span>run_d_w <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>기본 nice 값은 20으로 초기화한다.</p>\n<h4 id=\"2-nice-weight-하드-코드\" style=\"position:relative;\"><a href=\"#2-nice-weight-%ED%95%98%EB%93%9C-%EC%BD%94%EB%93%9C\" aria-label=\"2 nice weight 하드 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Nice weight 하드 코드</h4>\n<p>proc.c, trap.c</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> weight_table<span class=\"token punctuation\">[</span><span class=\"token number\">40</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n<span class=\"token comment\">/*  0*/</span> <span class=\"token number\">88761</span><span class=\"token punctuation\">,</span> <span class=\"token number\">71755</span><span class=\"token punctuation\">,</span> <span class=\"token number\">56483</span><span class=\"token punctuation\">,</span> <span class=\"token number\">46273</span><span class=\"token punctuation\">,</span> <span class=\"token number\">36291</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token comment\">/*  5*/</span> <span class=\"token number\">29154</span><span class=\"token punctuation\">,</span> <span class=\"token number\">23254</span><span class=\"token punctuation\">,</span> <span class=\"token number\">18705</span><span class=\"token punctuation\">,</span> <span class=\"token number\">14949</span><span class=\"token punctuation\">,</span> <span class=\"token number\">11916</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token comment\">/* 10*/</span>  <span class=\"token number\">9548</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">7620</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">6100</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">4904</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">3906</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token comment\">/* 15*/</span>  <span class=\"token number\">3121</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">2501</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">1991</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">1586</span><span class=\"token punctuation\">,</span>  <span class=\"token number\">1277</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token comment\">/* 20*/</span>  <span class=\"token number\">1024</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">820</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">655</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">526</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">423</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token comment\">/* 25*/</span>   <span class=\"token number\">335</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">272</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">215</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">172</span><span class=\"token punctuation\">,</span>   <span class=\"token number\">137</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token comment\">/* 30*/</span>   <span class=\"token number\">110</span><span class=\"token punctuation\">,</span>    <span class=\"token number\">87</span><span class=\"token punctuation\">,</span>    <span class=\"token number\">70</span><span class=\"token punctuation\">,</span>    <span class=\"token number\">56</span><span class=\"token punctuation\">,</span>    <span class=\"token number\">45</span><span class=\"token punctuation\">,</span>\r\n<span class=\"token comment\">/* 35*/</span>    <span class=\"token number\">36</span><span class=\"token punctuation\">,</span>    <span class=\"token number\">29</span><span class=\"token punctuation\">,</span>    <span class=\"token number\">23</span><span class=\"token punctuation\">,</span>    <span class=\"token number\">18</span><span class=\"token punctuation\">,</span>    <span class=\"token number\">15</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>hard-code를 사전에 작성해 놓는다.</p>\n<h4 id=\"3-스케줄러-함수-구현\" style=\"position:relative;\"><a href=\"#3-%EC%8A%A4%EC%BC%80%EC%A4%84%EB%9F%AC-%ED%95%A8%EC%88%98-%EA%B5%AC%ED%98%84\" aria-label=\"3 스케줄러 함수 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 스케줄러 함수 구현</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span>\r\n<span class=\"token function\">scheduler</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">proc</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">proc</span> <span class=\"token operator\">*</span>p1<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">proc</span> <span class=\"token operator\">*</span>p2<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">proc</span> <span class=\"token operator\">*</span>most_p<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">int</span> total_weight<span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">cpu</span> <span class=\"token operator\">*</span>c <span class=\"token operator\">=</span> <span class=\"token function\">mycpu</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  c<span class=\"token operator\">-></span>proc <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n  \r\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// Enable interrupts on this processor.</span>\r\n    <span class=\"token function\">sti</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token function\">acquire</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>lock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=</span> ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">;</span> p <span class=\"token operator\">&lt;</span> <span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">[</span>NPROC<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> p<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>state <span class=\"token operator\">!=</span> RUNNABLE<span class=\"token punctuation\">)</span>\r\n        <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\r\n\r\n      total_weight <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>p1 <span class=\"token operator\">=</span> ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">;</span> p1 <span class=\"token operator\">&lt;</span> <span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">[</span>NPROC<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> p1<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>p1<span class=\"token operator\">-></span>state <span class=\"token operator\">!=</span> RUNNABLE<span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\r\n        total_weight <span class=\"token operator\">+=</span> weight_table<span class=\"token punctuation\">[</span>p1<span class=\"token operator\">-></span>nice<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n\r\n      most_p <span class=\"token operator\">=</span> p<span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>p2 <span class=\"token operator\">=</span> ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">;</span> p2 <span class=\"token operator\">&lt;</span> <span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">[</span>NPROC<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> p2<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>p2<span class=\"token operator\">-></span>state <span class=\"token operator\">!=</span> RUNNABLE<span class=\"token punctuation\">)</span> <span class=\"token keyword\">continue</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>most_p<span class=\"token operator\">-></span>vruntime <span class=\"token operator\">></span> p2<span class=\"token operator\">-></span>vruntime<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n          most_p <span class=\"token operator\">=</span> p2<span class=\"token punctuation\">;</span>\r\n          <span class=\"token punctuation\">}</span>\r\n      <span class=\"token punctuation\">}</span>\r\n      \r\n      most_p<span class=\"token operator\">-></span>time_slice <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>weight_table<span class=\"token punctuation\">[</span>most_p<span class=\"token operator\">-></span>nice<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> total_weight<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span><span class=\"token number\">10</span> <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span>weight_table<span class=\"token punctuation\">[</span>most_p<span class=\"token operator\">-></span>nice<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> total_weight <span class=\"token operator\">!=</span><span class=\"token number\">0</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n      c<span class=\"token operator\">-></span>proc <span class=\"token operator\">=</span> most_p<span class=\"token punctuation\">;</span>\r\n      <span class=\"token function\">switchuvm</span><span class=\"token punctuation\">(</span>most_p<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      most_p<span class=\"token operator\">-></span>state <span class=\"token operator\">=</span> RUNNING<span class=\"token punctuation\">;</span>\r\n\r\n      <span class=\"token function\">swtch</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span>c<span class=\"token operator\">-></span>scheduler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> most_p<span class=\"token operator\">-></span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token function\">switchkvm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      c<span class=\"token operator\">-></span>proc <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token function\">release</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>lock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>우선 p1 proc 포인터로 ptable을 순회하며 time_slice 계산에 필요한 total_weight 를 누적한다. 다음으로 p2 proc 포인터로 ptable을 다시 순회하며 가장 작은 vruntime을 가진 프로세스를 찾고, 이를 most_p proc 포인터에 저장한다.</p>\n<p>time_slice를 계산하는데, 해당 프로세서의 weight 값에 10 tick 을 곱해주고 앞서 구한 total_weight 값으로 나누어 준다. <code class=\"language-text\">+ ((10 * (weight_table[most_p->nice])) % total_weight !=0 )</code> 부분은 틱의 올림을 위해서 이다.</p>\n<p>마지막으로는 c->proc 에 해당 프로세서 most_p를 할당해주고, swtch(&#x26;(c->scheduler), most_p->context) 을 통해 trap 부분으로 넘어가게 된다. 이후 해당 스케줄러는 해당 작업을 계속 반복하게 된다.</p>\n<h4 id=\"4-trapc-타임인터럽트-추가구현\" style=\"position:relative;\"><a href=\"#4-trapc-%ED%83%80%EC%9E%84%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8-%EC%B6%94%EA%B0%80%EA%B5%AC%ED%98%84\" aria-label=\"4 trapc 타임인터럽트 추가구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. trap.c 타임인터럽트 추가구현</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>state <span class=\"token operator\">==</span> RUNNING <span class=\"token operator\">&amp;&amp;</span> tf<span class=\"token operator\">-></span>trapno <span class=\"token operator\">==</span> T_IRQ0<span class=\"token operator\">+</span>IRQ_TIMER<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n \r\n    <span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>runtime <span class=\"token operator\">=</span> <span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>runtime <span class=\"token operator\">+</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>vruntime <span class=\"token operator\">=</span> <span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>vruntime <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token operator\">*</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token punctuation\">(</span>weight_table2<span class=\"token punctuation\">[</span><span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>nice<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>run_d_w <span class=\"token operator\">=</span> <span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>runtime <span class=\"token operator\">/</span> weight_table2<span class=\"token punctuation\">[</span><span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>nice<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>time_slice<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>time_slice<span class=\"token operator\">&lt;=</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span>time_slice <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token function\">yield</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>매 틱마다 runtime 및 vruntime을 증가시켜 준다. 이때 단위는 밀리틱이므로 1000씩 더해준다. vruntime의 경우 <code class=\"language-text\">(1000밀리틱 x 1024(nice 20의 weight)) / 해당 프로세스의 weight</code> 로 구현하였다. run_d_w의 경우 추후 print의 편의성을 위해 같이 계산해주었다.</p>\n<h4 id=\"5-fork함수-수정\" style=\"position:relative;\"><a href=\"#5-fork%ED%95%A8%EC%88%98-%EC%88%98%EC%A0%95\" aria-label=\"5 fork함수 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. fork함수 수정</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\nnp<span class=\"token operator\">-></span>vruntime <span class=\"token operator\">=</span> curproc<span class=\"token operator\">-></span>vruntime<span class=\"token punctuation\">;</span> \r\nnp<span class=\"token operator\">-></span>sz <span class=\"token operator\">=</span> curproc<span class=\"token operator\">-></span>sz<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<h4 id=\"6-wakeup-함수-수정\" style=\"position:relative;\"><a href=\"#6-wakeup-%ED%95%A8%EC%88%98-%EC%88%98%EC%A0%95\" aria-label=\"6 wakeup 함수 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. wakeup 함수 수정</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span>\r\n<span class=\"token function\">wakeup1</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>chan<span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">proc</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">int</span> min_vrun <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">int</span> is_run <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">int</span> vrun_1tick <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=</span> ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">;</span> p <span class=\"token operator\">&lt;</span> <span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">[</span>NPROC<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> p<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>state <span class=\"token operator\">==</span> RUNNABLE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n      is_run <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n      min_vrun <span class=\"token operator\">=</span> p<span class=\"token operator\">-></span>vruntime<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>is_run <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=</span> ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">;</span> p <span class=\"token operator\">&lt;</span> <span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">[</span>NPROC<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> p<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\r\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>state <span class=\"token operator\">==</span> RUNNABLE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>min_vrun <span class=\"token operator\">></span> p<span class=\"token operator\">-></span>vruntime<span class=\"token punctuation\">)</span> min_vrun <span class=\"token operator\">=</span> p<span class=\"token operator\">-></span>vruntime<span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n\r\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=</span> ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">;</span> p <span class=\"token operator\">&lt;</span> <span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">[</span>NPROC<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> p<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>state <span class=\"token operator\">==</span> SLEEPING <span class=\"token operator\">&amp;&amp;</span> p<span class=\"token operator\">-></span>chan <span class=\"token operator\">==</span> chan<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n      vrun_1tick <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token operator\">*</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token operator\">/</span><span class=\"token punctuation\">(</span>weight_table<span class=\"token punctuation\">[</span>p<span class=\"token operator\">-></span>nice<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>min_vrun <span class=\"token operator\">&lt;</span> vrun_1tick<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n        p<span class=\"token operator\">-></span>vruntime <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n      <span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\r\n        p<span class=\"token operator\">-></span>vruntime <span class=\"token operator\">=</span> min_vrun <span class=\"token operator\">-</span> vrun_1tick<span class=\"token punctuation\">;</span>\r\n        <span class=\"token comment\">//cprintf(\"set %d-> vrun %d (%d - %d)\\n\",p->pid, p->vruntime, min_vrun, vrun_1tick);</span>\r\n      <span class=\"token punctuation\">}</span>\r\n      p<span class=\"token operator\">-></span>state <span class=\"token operator\">=</span> RUNNABLE<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n      \r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>우선 첫번째 <code class=\"language-text\">for(p = ptable.proc; p &lt; &amp;ptable.proc[NPROC]; p++)</code> 문을 통해 RUNNABLE 프로세스가 있는지 확인하고 있다면 임의로 하나를 할당한다. 없다면 min_vrun 은 0으로 초기화 된다. 이후 RUNNABLE 프로세스가 있다면 두번째 <code class=\"language-text\">for(p = ptable.proc; p &lt; &amp;ptable.proc[NPROC]; p++)</code> 문을 통해 min_vrun에 가장 작은 값을 할당한다. 마지막으로 <code class=\"language-text\">if(p->state == SLEEPING &amp;&amp; p->chan == chan)</code> 문에서는 우선 아래 공식을 적용하여 vrun_1tick 값을 구한다.</p>\n<p>다음으로 <code class=\"language-text\">(minimum vruntime of processes in the ready queue – vruntime(1tick))</code> 에 해당하는 코드\r\n<code class=\"language-text\">p->vruntime = min_vrun - vrun_1tick;</code> 를 작성했다. 여기서 <code class=\"language-text\">if(min_vrun &lt; vrun_1tick) p->vruntime = 0;</code> 를 넣은 이유는 뺄셈 공식으로 인해 vruntime이 음수가 되는 경우를 피하기 위해서이다. sched()는 추가하지 않았다.</p>\n<h4 id=\"7-ps-수정\" style=\"position:relative;\"><a href=\"#7-ps-%EC%88%98%EC%A0%95\" aria-label=\"7 ps 수정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. ps() 수정</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">void</span>\r\n<span class=\"token function\">ps</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> pid<span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> states<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token string\">\"UNUSED  \"</span><span class=\"token punctuation\">,</span> \r\n    <span class=\"token string\">\"EMBRYO  \"</span><span class=\"token punctuation\">,</span> \r\n    <span class=\"token string\">\"SLEEPING\"</span><span class=\"token punctuation\">,</span> \r\n    <span class=\"token string\">\"RUNNABLE\"</span><span class=\"token punctuation\">,</span> \r\n    <span class=\"token string\">\"RUNNING \"</span><span class=\"token punctuation\">,</span> \r\n    <span class=\"token string\">\"ZOMBIE  \"</span>\r\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">struct</span> <span class=\"token class-name\">proc</span> <span class=\"token operator\">*</span>p<span class=\"token punctuation\">;</span>\r\n  <span class=\"token function\">acquire</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>lock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">int</span> valid_pid <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=</span> ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">;</span> p <span class=\"token operator\">&lt;</span> <span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">[</span>NPROC<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> p<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>pid <span class=\"token operator\">==</span> pid<span class=\"token punctuation\">)</span> valid_pid <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> valid_pid <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n  \r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>valid_pid<span class=\"token operator\">==</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">release</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>lock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">int</span> <span class=\"token function\">getlens</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">char</span><span class=\"token operator\">*</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">[</span>len<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> len<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">return</span> len<span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">int</span> <span class=\"token function\">getleni</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>n<span class=\"token operator\">==</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>n <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n      n <span class=\"token operator\">=</span> n<span class=\"token operator\">/</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token operator\">++</span>len<span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> len<span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">int</span> maxl_name <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">int</span> maxl_runtime <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">int</span> maxl_vruntime <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=</span> ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">;</span> p <span class=\"token operator\">&lt;</span> <span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">[</span>NPROC<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> p<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>pid <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>pid <span class=\"token operator\">==</span> pid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>state <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n          <span class=\"token keyword\">int</span> name_len <span class=\"token operator\">=</span> <span class=\"token function\">getlens</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n          <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>maxl_name<span class=\"token operator\">&lt;</span>name_len<span class=\"token punctuation\">)</span> maxl_name <span class=\"token operator\">=</span> name_len<span class=\"token punctuation\">;</span>\r\n\r\n          <span class=\"token keyword\">int</span> runtime_len <span class=\"token operator\">=</span> <span class=\"token function\">getleni</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>runtime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n          <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>maxl_runtime<span class=\"token operator\">&lt;</span>runtime_len<span class=\"token punctuation\">)</span> maxl_runtime <span class=\"token operator\">=</span> runtime_len<span class=\"token punctuation\">;</span>\r\n\r\n          <span class=\"token keyword\">int</span> vruntime_len <span class=\"token operator\">=</span> <span class=\"token function\">getleni</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>vruntime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n          <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>maxl_vruntime<span class=\"token operator\">&lt;</span>vruntime_len<span class=\"token punctuation\">)</span> maxl_vruntime <span class=\"token operator\">=</span> vruntime_len<span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span>\r\n\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>maxl_runtime<span class=\"token operator\">&lt;</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span> maxl_runtime <span class=\"token operator\">=</span> <span class=\"token number\">6</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>maxl_vruntime<span class=\"token operator\">&lt;</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span> maxl_vruntime <span class=\"token operator\">=</span> <span class=\"token number\">6</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">int</span> name_range <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>maxl_name<span class=\"token operator\">/</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">6</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">int</span> runtime_range <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>maxl_runtime<span class=\"token operator\">/</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">6</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">int</span> vruntime_range <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>maxl_vruntime<span class=\"token operator\">/</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span><span class=\"token number\">6</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span>name_range<span class=\"token operator\">-</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"pid      \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"state       \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"priority    \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"runtime/weight    \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"runtime\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span>runtime_range<span class=\"token operator\">-</span><span class=\"token number\">7</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"vruntime\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span>vruntime_range<span class=\"token operator\">-</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tick %d\"</span><span class=\"token punctuation\">,</span>ticks<span class=\"token operator\">*</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span>p <span class=\"token operator\">=</span> ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">;</span> p <span class=\"token operator\">&lt;</span> <span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>proc<span class=\"token punctuation\">[</span>NPROC<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> p<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>pid <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>pid <span class=\"token operator\">==</span> pid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>state <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n\r\n        <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\"</span><span class=\"token punctuation\">,</span>p<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">int</span> l1 <span class=\"token operator\">=</span> <span class=\"token function\">getlens</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span>name_range<span class=\"token operator\">-</span>l1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        \r\n        <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%d\"</span><span class=\"token punctuation\">,</span>p<span class=\"token operator\">-></span>pid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">int</span> l2 <span class=\"token operator\">=</span> <span class=\"token function\">getleni</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>pid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token operator\">-</span>l2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%s\"</span><span class=\"token punctuation\">,</span>states<span class=\"token punctuation\">[</span>p<span class=\"token operator\">-></span>state<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">int</span> l3 <span class=\"token operator\">=</span> <span class=\"token function\">getlens</span><span class=\"token punctuation\">(</span>states<span class=\"token punctuation\">[</span>p<span class=\"token operator\">-></span>state<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token number\">12</span><span class=\"token operator\">-</span>l3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%d\"</span><span class=\"token punctuation\">,</span>p<span class=\"token operator\">-></span>nice<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">int</span> l4 <span class=\"token operator\">=</span> <span class=\"token function\">getleni</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>nice<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token number\">12</span><span class=\"token operator\">-</span>l4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%d\"</span><span class=\"token punctuation\">,</span>p<span class=\"token operator\">-></span>run_d_w<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">int</span> l5 <span class=\"token operator\">=</span> <span class=\"token function\">getleni</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>run_d_w<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token number\">18</span><span class=\"token operator\">-</span>l5<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%d\"</span><span class=\"token punctuation\">,</span>p<span class=\"token operator\">-></span>runtime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">int</span> l6 <span class=\"token operator\">=</span> <span class=\"token function\">getleni</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>runtime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span>runtime_range<span class=\"token operator\">-</span>l6<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%d\"</span><span class=\"token punctuation\">,</span>p<span class=\"token operator\">-></span>vruntime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">int</span> l7 <span class=\"token operator\">=</span> <span class=\"token function\">getleni</span><span class=\"token punctuation\">(</span>p<span class=\"token operator\">-></span>vruntime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span>vruntime_range<span class=\"token operator\">-</span>l7<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  \r\n        <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span>\r\n  <span class=\"token function\">release</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>ptable<span class=\"token punctuation\">.</span>lock<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음과 같은 과정으로 기능을 추가했다.</p>\n<ol>\n<li>getlens(), getleni() 함수. gcc가 지원하는 중첩함수를 통해 각각 string과 int의 길이를 반환한다.</li>\n<li>반복문을 통해 각 column 별 최대 길이를 구하고, 이를 전부 담을수 있는 전체 길이를 선정한다.</li>\n<li>특정 string이나 int를 출력하고, 전체길이 - getlens() or getleni() 길이만큼 공백을 추가한다.</li>\n</ol>\n<h4 id=\"8-테스트-코드\" style=\"position:relative;\"><a href=\"#8-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C\" aria-label=\"8 테스트 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8. 테스트 코드</h4>\n<p>우선 틱 마다 변화를 보기위해 임시적으로 trap.c에 다음 코드를 추가하였다. 테스트 후에는 삭제했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ticks<span class=\"token operator\">%</span><span class=\"token number\">20</span><span class=\"token operator\">==</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token punctuation\">(</span>ticks<span class=\"token operator\">>=</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token operator\">&amp;&amp;</span><span class=\"token function\">myproc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">ps</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">cprintf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\n\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>mytestlonglong.c – 8.1, 8.2 테스트에 활용</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">int</span> pid1 <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">int</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">int</span> range <span class=\"token operator\">=</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">;</span>\r\n\r\n\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>pid1<span class=\"token operator\">></span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n\r\n        <span class=\"token function\">setnice</span><span class=\"token punctuation\">(</span><span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span> range<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j<span class=\"token operator\">&lt;</span> range<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n            a <span class=\"token operator\">=</span> <span class=\"token number\">9.9</span><span class=\"token operator\">+</span><span class=\"token number\">9.9</span><span class=\"token operator\">*</span>a<span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"ans: %d\\n\"</span><span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>pid1 <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">setnice</span><span class=\"token punctuation\">(</span><span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span> range<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j<span class=\"token operator\">&lt;</span> range<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n            a <span class=\"token operator\">=</span> <span class=\"token number\">9.9</span><span class=\"token operator\">+</span><span class=\"token number\">9.9</span><span class=\"token operator\">*</span>a<span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"ans: %d\\n\"</span><span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>mytest.c – 8.3 테스트에 활용</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">setnice</span><span class=\"token punctuation\">(</span><span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">int</span> pid1 <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">int</span> a <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">int</span> range <span class=\"token operator\">=</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>pid1<span class=\"token operator\">></span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">int</span> pid2 <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>pid2<span class=\"token operator\">></span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">int</span> pid3 <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>pid3<span class=\"token operator\">></span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span> range<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j<span class=\"token operator\">&lt;</span> range<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                        a <span class=\"token operator\">=</span> <span class=\"token number\">9.9</span><span class=\"token operator\">+</span><span class=\"token number\">9.9</span><span class=\"token operator\">*</span>a<span class=\"token punctuation\">;</span>\r\n                    <span class=\"token punctuation\">}</span>\r\n                <span class=\"token punctuation\">}</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"%d - ans: %d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n            <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>pid3<span class=\"token operator\">==</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token function\">setnice</span><span class=\"token punctuation\">(</span><span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">15</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n                <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span> range<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j<span class=\"token operator\">&lt;</span> range<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                        a <span class=\"token operator\">=</span> <span class=\"token number\">9.9</span><span class=\"token operator\">+</span><span class=\"token number\">9.9</span><span class=\"token operator\">*</span>a<span class=\"token punctuation\">;</span>\r\n                    <span class=\"token punctuation\">}</span>\r\n                <span class=\"token punctuation\">}</span>\r\n                <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"%d - ans: %d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>pid2 <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n            <span class=\"token function\">setnice</span><span class=\"token punctuation\">(</span><span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span> range<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j<span class=\"token operator\">&lt;</span> range<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                a <span class=\"token operator\">=</span> <span class=\"token number\">9.9</span><span class=\"token operator\">+</span><span class=\"token number\">9.9</span><span class=\"token operator\">*</span>a<span class=\"token punctuation\">;</span>\r\n                <span class=\"token punctuation\">}</span>\r\n            <span class=\"token punctuation\">}</span>\r\n            <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"%d - ans: %d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>pid1 <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">setnice</span><span class=\"token punctuation\">(</span><span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span> range<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j<span class=\"token operator\">&lt;</span> range<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n            a <span class=\"token operator\">=</span> <span class=\"token number\">9.9</span><span class=\"token operator\">+</span><span class=\"token number\">9.9</span><span class=\"token operator\">*</span>a<span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token string\">\"%d - ans: %d\\n\"</span><span class=\"token punctuation\">,</span><span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    \r\n    <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4 id=\"81-vruntime-유지\" style=\"position:relative;\"><a href=\"#81-vruntime-%EC%9C%A0%EC%A7%80\" aria-label=\"81 vruntime 유지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8.1 vruntime 유지</h4>\n<p>weight가 서로 다른 두개의 프로세스가 스케줄링 될 때, 서로 vurntime이 비슷하게 비율이 유지되며 증가한다. runtime은 확실히 차이가 나고, runtime/weight는 서로 비슷하게 비율이 유지되며 증가한다.</p>\n<h4 id=\"82-fork-부모-복사\" style=\"position:relative;\"><a href=\"#82-fork-%EB%B6%80%EB%AA%A8-%EB%B3%B5%EC%82%AC\" aria-label=\"82 fork 부모 복사 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8.2 fork() 부모 복사</h4>\n<p>자식 프로세스가 생기는 순간 부모의 vruntime 8000을 잘 복제하는 모습을 보여준다.</p>\n<h4 id=\"83-sleeping-에서-복귀\" style=\"position:relative;\"><a href=\"#83-sleeping-%EC%97%90%EC%84%9C-%EB%B3%B5%EA%B7%80\" aria-label=\"83 sleeping 에서 복귀 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8.3 sleeping 에서 복귀</h4>\n<p>프로세스 3이 wait()으로 자식을 기다리며 sleeping을 하다가 4번 자식이 끝나는 순간 wakeup을 하며, 이때 vruntime 은 가장 낮은 6번의 3003에서 nice 5 의 가중치를 고려한 vruntime 1 tick 값 35 를 뺀 2968 이 된다. 만약 RUNNABLE 이 없을 경우 0으로 잘 초기화 된다. 11인 이유는 초기화 되고나서 1틱동안 실행되었기 때문이다.</p>\n<h2 id=\"source\" style=\"position:relative;\"><a href=\"#source\" aria-label=\"source permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Source</h2>\n<ul>\n<li>mit-pdos/xv6-public<br>\n<a href=\"https://github.com/mit-pdos/xv6-public\" target=\"_blank\" rel=\"nofollow\">https://github.com/mit-pdos/xv6-public</a></li>\n</ul>","id":"b5af3c78-fba1-5d9a-abfd-05ef8e59b17c","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EB%AA%A9%ED%91%9C\">목표</a></p>\n<ul>\n<li><a href=\"#cfs-scheduler-%EA%B5%AC%ED%98%84\">CFS scheduler 구현</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B3%BC%EC%A0%95\">과정</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#0-make-file-cpu-%EC%88%98%EC%A0%95\">0. Make file cpu 수정</a></li>\n<li><a href=\"#1-proc-%EA%B5%AC%EC%A1%B0%EC%B2%B4%EC%97%90-runtime-vruntime-time_slice-run_d_wruntimeweight-%EC%B6%94%EA%B0%80-%EB%B0%8F-%EC%B4%88%EA%B8%B0%ED%99%94\">1. proc 구조체에 runtime, vruntime, time_slice, run_d_w(runtime/weight) 추가 및 초기화</a></li>\n<li><a href=\"#2-nice-weight-%ED%95%98%EB%93%9C-%EC%BD%94%EB%93%9C\">2. Nice weight 하드 코드</a></li>\n<li><a href=\"#3-%EC%8A%A4%EC%BC%80%EC%A4%84%EB%9F%AC-%ED%95%A8%EC%88%98-%EA%B5%AC%ED%98%84\">3. 스케줄러 함수 구현</a></li>\n<li><a href=\"#4-trapc-%ED%83%80%EC%9E%84%EC%9D%B8%ED%84%B0%EB%9F%BD%ED%8A%B8-%EC%B6%94%EA%B0%80%EA%B5%AC%ED%98%84\">4. trap.c 타임인터럽트 추가구현</a></li>\n<li><a href=\"#5-fork%ED%95%A8%EC%88%98-%EC%88%98%EC%A0%95\">5. fork함수 수정</a></li>\n<li><a href=\"#6-wakeup-%ED%95%A8%EC%88%98-%EC%88%98%EC%A0%95\">6. wakeup 함수 수정</a></li>\n<li><a href=\"#7-ps-%EC%88%98%EC%A0%95\">7. ps() 수정</a></li>\n<li><a href=\"#8-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C\">8. 테스트 코드</a></li>\n<li><a href=\"#81-vruntime-%EC%9C%A0%EC%A7%80\">8.1 vruntime 유지</a></li>\n<li><a href=\"#82-fork-%EB%B6%80%EB%AA%A8-%EB%B3%B5%EC%82%AC\">8.2 fork() 부모 복사</a></li>\n<li><a href=\"#83-sleeping-%EC%97%90%EC%84%9C-%EB%B3%B5%EA%B7%80\">8.3 sleeping 에서 복귀</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#source\">Source</a></p>\n</li>\n</ul>","frontmatter":{"title":"XV6 운영체제 개선해 보기 <CFS scheduler 구현>","summary":"XV6 운영체제의 구성을 알아보고 추가적인 기능을 도전해봅니다.","date":"2023.09.04.","categories":["Operating System"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA80lEQVQoz92SS0tCURSF/ZOBYN3buRmIgyKIIEgIx5LpfSgUFV2EizoTH/SUwMfAB1hOlPCnfLL1DLsozQrWYC043z777H0i7j6/VuR/wI4pEmPo6JrYe6INsGNSjFOwxN8m8RSeJfH+mIcTqRIOK/K7+GeM6rQfGTd4KtJyxExeqKZXvajwmz2Lqx2m78x6+Kd8vtItM6wz70uVm4R+UQisuI4ybbMYSfweMqjx4dOrMG5Sy5CNypkfYE+RixFc0K+KgpQAnYDKJV9vTJ4pnZOPhcB6YIfSvKv05AoH2AZ3RzI/29hiVdqvlrSOW63q73zPJU+/WoDmnxbZAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/0fe9f60f12a06de4130cb2f66fce12f1/55486/xv6.png","srcSet":"/static/0fe9f60f12a06de4130cb2f66fce12f1/ea722/xv6.png 200w,\n/static/0fe9f60f12a06de4130cb2f66fce12f1/f9bbb/xv6.png 400w,\n/static/0fe9f60f12a06de4130cb2f66fce12f1/55486/xv6.png 800w","sizes":"(min-width: 800px) 800px, 100vw"},"sources":[{"srcSet":"/static/0fe9f60f12a06de4130cb2f66fce12f1/4c856/xv6.webp 200w,\n/static/0fe9f60f12a06de4130cb2f66fce12f1/4dac1/xv6.webp 400w,\n/static/0fe9f60f12a06de4130cb2f66fce12f1/d0f18/xv6.webp 800w","type":"image/webp","sizes":"(min-width: 800px) 800px, 100vw"}]},"width":800,"height":600}},"publicURL":"/static/0fe9f60f12a06de4130cb2f66fce12f1/xv6.png"}}}}]}},"pageContext":{"slug":"/xv6_2/"}},"staticQueryHashes":[]}