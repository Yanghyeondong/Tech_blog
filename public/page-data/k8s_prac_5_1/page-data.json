{"componentChunkName":"component---src-templates-post-template-tsx","path":"/k8s_prac_5_1/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p><em>해당 포스트는 교재 『쿠버네티스 교과서』를 활용하며,</em><br>\n<em>환경은 Kubernetes v1.28. Docker Desktop으로 진행합니다.</em></p>\n<h2 id=\"개념-요약\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EB%85%90-%EC%9A%94%EC%95%BD\" aria-label=\"개념 요약 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개념 요약</h2>\n<h3 id=\"파드속-컨테이너-파일-시스템-구성-방식\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EB%93%9C%EC%86%8D-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%ED%8C%8C%EC%9D%BC-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EA%B5%AC%EC%84%B1-%EB%B0%A9%EC%8B%9D\" aria-label=\"파드속 컨테이너 파일 시스템 구성 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파드속 컨테이너 파일 시스템 구성 방식</h3>\n<ol>\n<li>컨테이너 이미지가 초기 내용을 제공</li>\n<li>기록 가능 레이어에 파일의 수정이나 새로운 파일이 기록됨</li>\n<li>볼륨 마운트</li>\n</ol>\n<h4 id=\"주의사항\" style=\"position:relative;\"><a href=\"#%EC%A3%BC%EC%9D%98%EC%82%AC%ED%95%AD\" aria-label=\"주의사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>주의사항</h4>\n<p>파드가 새로 생성되면 기존 기록 가능 레이어의 데이터는 사라진다!</p>\n<h3 id=\"공디렉터리-emptydir\" style=\"position:relative;\"><a href=\"#%EA%B3%B5%EB%94%94%EB%A0%89%ED%84%B0%EB%A6%AC-emptydir\" aria-label=\"공디렉터리 emptydir permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>공디렉터리 emptyDir</h3>\n<p>파드 수준의 디렉토리. 공디렉터리 볼륨에 저장된 데이터는 컨테이너가 대체되어도 유지된다. 단, 파드가 대체될 경우 사라진다. 로컬 캐시로서 활용해 애플리케이션의 성능을 높일 수 있다.</p>\n<h3 id=\"호스트경로-볼륨\" style=\"position:relative;\"><a href=\"#%ED%98%B8%EC%8A%A4%ED%8A%B8%EA%B2%BD%EB%A1%9C-%EB%B3%BC%EB%A5%A8\" aria-label=\"호스트경로 볼륨 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>호스트경로 볼륨</h3>\n<p>데이터가 특정 노드에 고정되게 된다.</p>\n<h4 id=\"장점\" style=\"position:relative;\"><a href=\"#%EC%9E%A5%EC%A0%90\" aria-label=\"장점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>장점</h4>\n<p>손쉽게 접근이 가능하다.\r\nstatefull 애플리케이션에 유리하다.\r\nstatefull = 트랜잭션의 컨텍스트와 내역이 저장되는 형태.</p>\n<h4 id=\"단점\" style=\"position:relative;\"><a href=\"#%EB%8B%A8%EC%A0%90\" aria-label=\"단점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>단점</h4>\n<p>해당 노드에서만 쓸 수 있기에 전체 클러스터에서 쓰지 못한다.\r\n보안적으로 취약하다. 노드의 파일 시스템 전체에 파드 컨테이너가 접근할 수 있게 된다. 단, 이는 볼륨과 마운트 정의에서 SubPath를 활용하면 된다.</p>\n<h3 id=\"k8s-분산-스토리지-시스템\" style=\"position:relative;\"><a href=\"#k8s-%EB%B6%84%EC%82%B0-%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80-%EC%8B%9C%EC%8A%A4%ED%85%9C\" aria-label=\"k8s 분산 스토리지 시스템 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>k8s 분산 스토리지 시스템</h3>\n<p>AKS - Azure 파일스, Azure 디스크<br>\nEKS - Elastic Block Store\r\n온프레미스 - NFS, GlusterFS</p>\n<p>파드 : 컴퓨팅 계층의 추상\r\n서비스 : 네트워크 계층의 추상\r\n영구볼륨&#x26;클레임 : 스토리지 계층의 추상</p>\n<h3 id=\"분산-스토리지가-없을-경우\" style=\"position:relative;\"><a href=\"#%EB%B6%84%EC%82%B0-%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80%EA%B0%80-%EC%97%86%EC%9D%84-%EA%B2%BD%EC%9A%B0\" aria-label=\"분산 스토리지가 없을 경우 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>분산 스토리지가 없을 경우</h3>\n<p>특정 노드에 레이블을 부여하고 해당 노드의 로컬볼륨을 영구볼륨으로 활용.</p>\n<h3 id=\"영구볼륨-클레임\" style=\"position:relative;\"><a href=\"#%EC%98%81%EA%B5%AC%EB%B3%BC%EB%A5%A8-%ED%81%B4%EB%A0%88%EC%9E%84\" aria-label=\"영구볼륨 클레임 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>영구볼륨 클레임</h3>\n<p>파드가 사용하는 스토리지의 추상. 파드가 영구 볼륨을 사용하기 위해 요청하는 대상. 접근 유형과 스토리지 용량, 스토리지 유형을 지정한다. 스토리지 유형을 지정하지 않으면 쿠버네티스가 현존하는 영구볼륨 중 찾아서 연결해준다. 영구볼륨 클레임과 영구 볼륨과 1대1의 대응을 가진다.</p>\n<h3 id=\"tip\" style=\"position:relative;\"><a href=\"#tip\" aria-label=\"tip permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TIP</h3>\n<p>클러스터에서 각 노드에 로그인할 권한이 없다면, 호스트경로 마운트로 노드의 루트 디렉터리를 마운트한 파드를 활용해서 로컬 볼륨에 원하는 작업을 할 수 있다.</p>\n<h2 id=\"실습\" style=\"position:relative;\"><a href=\"#%EC%8B%A4%EC%8A%B5\" aria-label=\"실습 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>실습</h2>\n<h3 id=\"주요-요점들\" style=\"position:relative;\"><a href=\"#%EC%A3%BC%EC%9A%94-%EC%9A%94%EC%A0%90%EB%93%A4\" aria-label=\"주요 요점들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>주요 요점들</h3>\n<ul>\n<li>영구볼륨과 연결되지 않은 클레임을 참조하는 파드를 배치할려고 하면 오류가 발생한다.</li>\n<li>영구볼륨을 명시적으로 생성 - 정적 프로비저닝</li>\n<li>클레임에서 사용가능한 볼륨이 없으면 peding 상태가 된다</li>\n</ul>\n<h3 id=\"매니페스트-파일\" style=\"position:relative;\"><a href=\"#%EB%A7%A4%EB%8B%88%ED%8E%98%EC%8A%A4%ED%8A%B8-%ED%8C%8C%EC%9D%BC\" aria-label=\"매니페스트 파일 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>매니페스트 파일</h3>\n<p>sleep-with-emptyDir.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\r\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\r\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sleep\r\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> sleep\r\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> sleep\r\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sleep\r\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> kiamol/ch03<span class=\"token punctuation\">-</span>sleep\r\n          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> data\r\n              <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /data\r\n      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> data\r\n          <span class=\"token key atrule\">emptyDir</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>persistentVolume.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\r\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolume\r\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> pv01\r\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">capacity</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 50Mi\r\n  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> ReadWriteOnce\r\n  <span class=\"token key atrule\">local</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /volumes/pv01 \r\n  <span class=\"token key atrule\">nodeAffinity</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">required</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token key atrule\">nodeSelectorTerms</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">matchExpressions</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> kiamol\r\n            <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span> In\r\n            <span class=\"token key atrule\">values</span><span class=\"token punctuation\">:</span>\r\n              <span class=\"token punctuation\">-</span> ch05</code></pre></div>\n<p>postgres-persistentVolumeClaim.yaml</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\r\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolumeClaim\r\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> postgres<span class=\"token punctuation\">-</span>pvc\r\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token punctuation\">-</span> ReadWriteOnce\r\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 40Mi\r\n  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span></code></pre></div>\n<h3 id=\"\" style=\"position:relative;\"><a href=\"#\" aria-label=\" permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># sleep 파드를 배치한다</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl apply <span class=\"token operator\">-</span>f <span class=\"token function\">sleep</span><span class=\"token operator\">/</span><span class=\"token function\">sleep</span><span class=\"token punctuation\">.</span>yaml\r\ndeployment<span class=\"token punctuation\">.</span>apps/<span class=\"token function\">sleep</span> unchanged\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 컨테이너 속에 파일 하나를 생성한다</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> sh <span class=\"token operator\">-</span>c <span class=\"token string\">'echo ch05 > /file.txt; ls /*.txt'</span>\r\n<span class=\"token operator\">/</span>file<span class=\"token punctuation\">.</span>txt\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 컨테이너 ID를 확인한다</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl get pod <span class=\"token operator\">-</span>l app=<span class=\"token function\">sleep</span> <span class=\"token operator\">-</span>o jsonpath=<span class=\"token string\">'{.items[0].status.containerStatuses[0].containerID}'</span>     \r\ndocker:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>2b8e762f528550bbf71c5f23d5de88ac87667d4a13aca0733ea0beb1e10639ab\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 파드가 재시작하도록 컨테이너의 모든 프로세스를 강제 종료한다</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec <span class=\"token operator\">-</span>it deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> killall5</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice> <span class=\"token comment\"># 대체된 컨테이너의 ID를 확인한다</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice> kubectl get pod <span class=\"token operator\">-</span>l app=<span class=\"token function\">sleep</span> <span class=\"token operator\">-</span>o jsonpath=<span class=\"token string\">'{.items[0].status.containerStatuses[0].containerID}'</span>\r\ndocker:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>77736249d5c4e43383981a0be037b5a60d2f86404bbf0cd0466f645f9a62d88f\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice> <span class=\"token comment\"># 조금 전 생성했던 파일이 사라졌다</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice> kubectl exec deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> <span class=\"token function\">ls</span> <span class=\"token operator\">/</span><span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>txt\r\n\r\n<span class=\"token function\">ls</span>: <span class=\"token operator\">/</span><span class=\"token operator\">*</span><span class=\"token punctuation\">.</span>txt: No such file or directory\r\ncommand terminated with <span class=\"token keyword\">exit</span> code 1</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 공디렉터리 볼륨을 사용하도록 sleep 파드 업데이트</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl apply <span class=\"token operator\">-</span>f <span class=\"token function\">sleep</span><span class=\"token operator\">/</span><span class=\"token function\">sleep</span><span class=\"token operator\">-</span>with-emptyDir<span class=\"token punctuation\">.</span>yaml\r\ndeployment<span class=\"token punctuation\">.</span>apps/<span class=\"token function\">sleep</span> configured\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 볼륨 마운트 속 파일 목록 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> <span class=\"token function\">ls</span> <span class=\"token operator\">/</span><span class=\"token keyword\">data</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 빈 디렉터리에 파일 하나 생성</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> sh <span class=\"token operator\">-</span>c <span class=\"token string\">'echo ch05 > /data/file.txt; ls /data'</span>\r\nfile<span class=\"token punctuation\">.</span>txt\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 컨테이너 ID 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl get pod <span class=\"token operator\">-</span>l app=<span class=\"token function\">sleep</span> <span class=\"token operator\">-</span>o jsonpath=<span class=\"token string\">'{.items[0].status.containerStatuses[0].containerID}'</span>\r\ndocker:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>5808d8b3dfe26dba2d68e9eb9d78ac981d6c2c6ab8d7e6421d9925647c656b24\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 컨테이너 프로세스 강제 종료</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> killall5\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 대체 컨테이너의 ID가 바뀌었는지 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl get pod <span class=\"token operator\">-</span>l app=<span class=\"token function\">sleep</span> <span class=\"token operator\">-</span>o jsonpath=<span class=\"token string\">'{.items[0].status.containerStatuses[0].containerID}'</span>\r\ndocker:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>6a769d2c72b7f0708eb151c2930f4338a0344b1ebfbd3799b2c1fe186d12d057\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 볼륨이 마운트된 경로의 파일 내용 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> <span class=\"token function\">cat</span> <span class=\"token operator\">/</span><span class=\"token keyword\">data</span><span class=\"token operator\">/</span>file<span class=\"token punctuation\">.</span>txt\r\nch05</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 파이 애플리케이션을 배치한다</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl apply <span class=\"token operator\">-</span>f pi/v1/\r\nconfigmap/pi-proxy-configmap created\r\nservice/pi-proxy created\r\ndeployment<span class=\"token punctuation\">.</span>apps/pi-proxy created\r\nservice/pi-web created\r\ndeployment<span class=\"token punctuation\">.</span>apps/pi-web created\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> \r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 파드가 준비 상태가 될 때까지 대기한다</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl wait <span class=\"token operator\">--</span><span class=\"token keyword\">for</span>=condition=Ready pod <span class=\"token operator\">-</span>l app=pi-web\r\npod/pi-web-66544ccb68-9pf2w condition met\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 로드밸런서 서비스의 URL을 출력한다</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl get svc pi-proxy <span class=\"token operator\">-</span>o jsonpath=<span class=\"token string\">'http://{.status.loadBalancer.ingress[0].*}:8080/?dp=30000'</span>\r\nhttp:<span class=\"token operator\">/</span><span class=\"token operator\">/</span>localhost:8080/?dp=30000\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 위 URL에 접근한 다음 페이지를 새로고침하라</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> \r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 프록시에 저장된 캐시를 확인한다</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/pi-proxy <span class=\"token operator\">--</span> <span class=\"token function\">ls</span> <span class=\"token operator\">-</span>l <span class=\"token operator\">/</span><span class=\"token keyword\">data</span><span class=\"token operator\">/</span>nginx/cache\r\ntotal 12\r\ndrwx-<span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span>    3 nginx    nginx         4096 Jan 18 08:01 4\r\ndrwx-<span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span>    3 nginx    nginx         4096 Jan 18 08:01 5\r\ndrwx-<span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span>    3 nginx    nginx         4096 Jan 18 08:01 d\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/pi-proxy <span class=\"token operator\">--</span> <span class=\"token function\">ls</span> <span class=\"token operator\">-</span>l <span class=\"token operator\">/</span><span class=\"token keyword\">data</span><span class=\"token operator\">/</span>nginx/cache\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 프록시 파드를 삭제한다</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl delete pod <span class=\"token operator\">-</span>l app=pi-proxy\r\npod <span class=\"token string\">\"pi-proxy-5498f7cdd5-jmdjj\"</span> deleted\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> \r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 새로 생성된 대체 파드의 캐시 디렉터리 내용을 확인한다</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/pi-proxy <span class=\"token operator\">--</span> <span class=\"token function\">ls</span> <span class=\"token operator\">-</span>l <span class=\"token operator\">/</span><span class=\"token keyword\">data</span><span class=\"token operator\">/</span>nginx/cache\r\ntotal 0\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/pi-proxy <span class=\"token operator\">--</span> <span class=\"token function\">ls</span> <span class=\"token operator\">-</span>l <span class=\"token operator\">/</span><span class=\"token keyword\">data</span><span class=\"token operator\">/</span>nginx/cache\r\ntotal 8\r\ndrwx-<span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span>    3 nginx    nginx         4096 Jan 18 08:07 2\r\ndrwx-<span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span>    3 nginx    nginx         4096 Jan 18 08:07 4</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 호스트경로 볼륨이 마운트된 파드 실행</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl apply <span class=\"token operator\">-</span>f <span class=\"token function\">sleep</span><span class=\"token operator\">/</span><span class=\"token function\">sleep</span><span class=\"token operator\">-</span>with-hostPath<span class=\"token punctuation\">.</span>yaml\r\ndeployment<span class=\"token punctuation\">.</span>apps/<span class=\"token function\">sleep</span> unchanged\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> \r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 컨테이너 속 로그 파일 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> <span class=\"token function\">ls</span> <span class=\"token operator\">-</span>l <span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>log\r\ntotal 0\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 노드 파일 시스템의 로그 파일 내용 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> <span class=\"token function\">ls</span> <span class=\"token operator\">-</span>l <span class=\"token operator\">/</span>node-root/<span class=\"token keyword\">var</span><span class=\"token operator\">/</span>log\r\ntotal 0\r\ndrwxr-xr-x    2 root     root           360 Jan 18 08:52 containers\r\ndrwxr-xr-x   19 root     root           380 Jan 18 08:52 pods      \r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>                                            \r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 컨테이너의 사용자명 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> whoami\r\nroot\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 파드 업데이트</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl apply <span class=\"token operator\">-</span>f <span class=\"token function\">sleep</span><span class=\"token operator\">/</span><span class=\"token function\">sleep</span><span class=\"token operator\">-</span>with-hostPath-subPath<span class=\"token punctuation\">.</span>yaml\r\ndeployment<span class=\"token punctuation\">.</span>apps/<span class=\"token function\">sleep</span> unchanged\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> \r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 노드 파일 시스템에서 파드의 로그 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> sh <span class=\"token operator\">-</span>c <span class=\"token string\">'ls /pod-logs | grep _pi-'</span>\r\n\r\ndefault_pi-proxy-5584cb46f7-zlx4s_5463a515-2ff4-4ee3-a17c-831400c8f92c\r\ndefault_pi-proxy-59d4899589-mg7qv_6652d70f-100d-440b-8c90-553d20900c96\r\ndefault_pi-web-66544ccb68-9pf2w_501b7421-5b9e-4c8a-b782-a016c0154542  \r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 컨테이너 로그 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> sh <span class=\"token operator\">-</span>c <span class=\"token string\">'ls /container-logs | grep nginx'</span>                                                                                        \r\npi-proxy-59d4899589-mg7qv_default_nginx-db67e8d56dc203701eeb2e361ef59dbc69e758622ff0ac3aec708418351e09f0<span class=\"token punctuation\">.</span>log</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 레이블 셀렉터로 노드의 존재 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl get nodes <span class=\"token operator\">-</span>l kiamol=ch05\r\nNAME             STATUS   ROLES           AGE   VERSION\r\ndocker-desktop   Ready    control-plane   22h   v1<span class=\"token punctuation\">.</span>28<span class=\"token punctuation\">.</span>2\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 레이블이 부여된 노드의 로컬 볼륨을 사용하는 영구볼륨을 배치</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl apply <span class=\"token operator\">-</span>f todo-list/persistentVolume<span class=\"token punctuation\">.</span>yaml\r\npersistentvolume/pv01 created\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 영구볼륨의 상세정보 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl get pv\r\nNAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE\r\npv01   50Mi       RWO            Retain           Available                                   3s\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 영구볼륨과 연결될 영구볼륨클레임을 생성</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl apply <span class=\"token operator\">-</span>f todo-list/postgres-persistentVolumeClaim<span class=\"token punctuation\">.</span>yaml\r\npersistentvolumeclaim/postgres-pvc created\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 영구볼륨클레임의 목록 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl get pvc\r\nNAME           STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE\r\npostgres-pvc   Bound    pv01     50Mi       RWO                           4s \r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 영구볼륨의 목록 확인 </span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl get pv\r\nNAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                  STORAGECLASS   REASON   AGE \r\npv01   50Mi       RWO            Retain           Bound    default/postgres-pvc                           6m7s</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 현재 사용 가능한 영구볼륨 중 일치하는 것이 없는 영구볼륨클레임을 배치</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl apply <span class=\"token operator\">-</span>f todo-list/postgres-persistentVolumeClaim-too-big<span class=\"token punctuation\">.</span>yaml\r\npersistentvolumeclaim/postgres-pvc-toobig created                                                                                     kiamol=c\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 영구볼륨클레임의 목록 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl get pvc\r\nNAME                  STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE\r\npostgres-pvc          Bound     pv01     50Mi       RWO                           37m\r\npostgres-pvc-toobig   Pending                                                     1s\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 노드의 디스크에 접근할 수 있는 sleep 파드를 실행</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl apply <span class=\"token operator\">-</span>f <span class=\"token function\">sleep</span><span class=\"token operator\">/</span><span class=\"token function\">sleep</span><span class=\"token operator\">-</span>with-hostPath<span class=\"token punctuation\">.</span>yaml\r\ndeployment<span class=\"token punctuation\">.</span>apps/<span class=\"token function\">sleep</span> configured\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> \r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 파드가 준비될 때까지 대기</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl wait <span class=\"token operator\">--</span><span class=\"token keyword\">for</span>=condition=Ready pod <span class=\"token operator\">-</span>l app=<span class=\"token function\">sleep</span>\r\npod/<span class=\"token function\">sleep</span><span class=\"token operator\">-</span>68f96fc8d5-wcs72 condition met\r\npod/<span class=\"token function\">sleep</span><span class=\"token operator\">-</span>fb8dfbfd8-qsrf2 condition met\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 영구볼륨에서 사용할 디렉터리를 생성</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> mkdir <span class=\"token operator\">-</span>p <span class=\"token operator\">/</span>node-root/volumes/pv01</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"powershell\"><pre class=\"language-powershell\"><code class=\"language-powershell\"><span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 데이터베이스 파드를 배치</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl apply <span class=\"token operator\">-</span>f todo-list/postgres/\r\nsecret/todo-db-secret created                                                                                                         kiamol=c\r\nservice/todo-db created\r\ndeployment<span class=\"token punctuation\">.</span>apps/todo-db created\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> \r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 데이터베이스 파일이 초기화될 때까지 대기</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token function\">sleep</span> 30\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> \r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 데이터베이스 파드의 로그를 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl logs <span class=\"token operator\">-</span>l app=todo-db <span class=\"token operator\">--</span>tail 1\r\n2024-01-18 13:48:35<span class=\"token punctuation\">.</span>695 UTC <span class=\"token punctuation\">[</span>1<span class=\"token punctuation\">]</span> LOG:  database system is ready to accept connections\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> <span class=\"token comment\"># 볼륨에 어떤 파일이 생성됐는지 확인</span>\r\n<span class=\"token function\">PS</span> C:\\Users\\hdyang\\Desktop\\Project\\k8s-practice\\ch05> kubectl exec deploy/<span class=\"token function\">sleep</span> <span class=\"token operator\">--</span> sh <span class=\"token operator\">-</span>c <span class=\"token string\">'ls -l /node-root/volumes/pv01 | grep wal'</span>\r\ndrwx-<span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">-</span>    3 70       70              80 Jan 18 13:48 pg_wal</code></pre></div>\n<h2 id=\"source\" style=\"position:relative;\"><a href=\"#source\" aria-label=\"source permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Source</h2>\n<ul>\n<li>『쿠버네티스 교과서』- 엘튼 스톤맨, 길벗<br>\n<a href=\"https://github.com/gilbutITbook/kiamol\" target=\"_blank\" rel=\"nofollow\">https://github.com/gilbutITbook/kiamol</a></li>\n</ul>","id":"7652448d-d323-54d7-8b9e-6cf880337cd4","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EA%B0%9C%EB%85%90-%EC%9A%94%EC%95%BD\">개념 요약</a></p>\n<ul>\n<li>\n<p><a href=\"#%ED%8C%8C%EB%93%9C%EC%86%8D-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%ED%8C%8C%EC%9D%BC-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EA%B5%AC%EC%84%B1-%EB%B0%A9%EC%8B%9D\">파드속 컨테이너 파일 시스템 구성 방식</a></p>\n<ul>\n<li><a href=\"#%EC%A3%BC%EC%9D%98%EC%82%AC%ED%95%AD\">주의사항</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B3%B5%EB%94%94%EB%A0%89%ED%84%B0%EB%A6%AC-emptydir\">공디렉터리 emptyDir</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%98%B8%EC%8A%A4%ED%8A%B8%EA%B2%BD%EB%A1%9C-%EB%B3%BC%EB%A5%A8\">호스트경로 볼륨</a></p>\n<ul>\n<li><a href=\"#%EC%9E%A5%EC%A0%90\">장점</a></li>\n<li><a href=\"#%EB%8B%A8%EC%A0%90\">단점</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#k8s-%EB%B6%84%EC%82%B0-%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80-%EC%8B%9C%EC%8A%A4%ED%85%9C\">k8s 분산 스토리지 시스템</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%B6%84%EC%82%B0-%EC%8A%A4%ED%86%A0%EB%A6%AC%EC%A7%80%EA%B0%80-%EC%97%86%EC%9D%84-%EA%B2%BD%EC%9A%B0\">분산 스토리지가 없을 경우</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%98%81%EA%B5%AC%EB%B3%BC%EB%A5%A8-%ED%81%B4%EB%A0%88%EC%9E%84\">영구볼륨 클레임</a></p>\n</li>\n<li>\n<p><a href=\"#tip\">TIP</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%8B%A4%EC%8A%B5\">실습</a></p>\n<ul>\n<li><a href=\"#%EC%A3%BC%EC%9A%94-%EC%9A%94%EC%A0%90%EB%93%A4\">주요 요점들</a></li>\n<li><a href=\"#%EB%A7%A4%EB%8B%88%ED%8E%98%EC%8A%A4%ED%8A%B8-%ED%8C%8C%EC%9D%BC\">매니페스트 파일</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#source\">Source</a></p>\n</li>\n</ul>","frontmatter":{"title":"『쿠버네티스 교과서』실습 5장 part 1","summary":"엘튼 스톤맨의 『쿠버네티스 교과서』를 바탕으로 k8s 실습을 진행합니다.","date":"2024.01.23.","categories":["K8s","Docker","DevOps"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAcCBQj/xAAWAQEBAQAAAAAAAAAAAAAAAAAJAgX/2gAMAwEAAhADEAAAAUQ68/wQe68DIU3/xAAbEAABBAMAAAAAAAAAAAAAAAACAAMEBQEGEP/aAAgBAQABBQKG209L3Oloq2GsozMuf//EACERAAICAQIHAAAAAAAAAAAAAAECAwQSABEFBxM0QXOy/9oACAEDAQE/AeQ9V7DcFaOxNWNW1FO/SZgLEWKg1pV3CNG3nIMQC2OzYstDsqvoi+Rr/8QAHhEAAQMFAQEAAAAAAAAAAAAAAwECEgAEESFhBTL/2gAIAQIBAT8B9S3IS4AZpyDYGUxNxA0sfes64qdkmqWv/8QAIxAAAgEDBAEFAAAAAAAAAAAAAQIRAxIiBBAhMQAFEzJBUf/aAAgBAQAGPwLT067W0nqAOTcOPzHLkwMcj0uUeaOr6ZUT3nsVlV5vWADwoCFvkzNIbDhFU75OzRMXMWie+ye/vb//xAAaEAEBAAMBAQAAAAAAAAAAAAABEQAhMUFx/9oACAEBAAE/ITqO+CxlF14nd15QbYYQsJzV+IXNc9YyfLHAxqUGnYXhjn//2gAMAwEAAgADAAAAEFv/AP/EABYRAQEBAAAAAAAAAAAAAAAAAAEQIf/aAAgBAwEBPxBFpaYiyxm1CBz+v//EABoRAQEAAgMAAAAAAAAAAAAAAAERADFBcbH/2gAIAQIBAT8Qs1GoBEKWhnNcjZ7fc//EABoQAQACAwEAAAAAAAAAAAAAAAEAESExwXH/2gAIAQEAAT8QuLX5IofsSCd43ADOLxb1Xx453POs5cjI3Qk8gWXBUWtsG551n//Z"},"images":{"fallback":{"src":"/static/582542484766a1b4ac3c5f037914dd69/bc134/k8s.jpg","srcSet":"/static/582542484766a1b4ac3c5f037914dd69/2278c/k8s.jpg 320w,\n/static/582542484766a1b4ac3c5f037914dd69/0f1c0/k8s.jpg 640w,\n/static/582542484766a1b4ac3c5f037914dd69/bc134/k8s.jpg 1280w","sizes":"(min-width: 1280px) 1280px, 100vw"},"sources":[{"srcSet":"/static/582542484766a1b4ac3c5f037914dd69/378b7/k8s.webp 320w,\n/static/582542484766a1b4ac3c5f037914dd69/3c3fb/k8s.webp 640w,\n/static/582542484766a1b4ac3c5f037914dd69/c2dd8/k8s.webp 1280w","type":"image/webp","sizes":"(min-width: 1280px) 1280px, 100vw"}]},"width":1280,"height":720}},"publicURL":"/static/582542484766a1b4ac3c5f037914dd69/k8s.jpg"}}}}]}},"pageContext":{"slug":"/k8s_prac_5_1/"}},"staticQueryHashes":[]}