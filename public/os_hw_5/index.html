<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta data-react-helmet="true" name="naver-site-verification" content="7727e68f404d4c7be584f2b673b9943ab5c6b9ab"/><meta data-react-helmet="true" name="google-site-verification" content="fygLmB3YoAnXWkSTMHoemYurOt8ZBEdT2K5M1qZQL5E"/><meta data-react-helmet="true" name="twitter:image" content="/static/5e3e112afb9c9c7bd4c291006dba33a4/book2.png"/><meta data-react-helmet="true" name="twitter:description" content="ÍµêÏû¨ Operating Systems: Three Easy Pieces [Remzi] ÏÜç Homework Î¨∏Ï†ú ÌíÄÏù¥"/><meta data-react-helmet="true" name="twitter:title" content="OS: Three Easy Pieces [Remzi] &lt;27.Debugging Race&gt; ÌíÄÏù¥"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" property="og:site_name" content="OS: Three Easy Pieces [Remzi] &lt;27.Debugging Race&gt; ÌíÄÏù¥"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" property="og:image" content="/static/5e3e112afb9c9c7bd4c291006dba33a4/book2.png"/><meta data-react-helmet="true" property="og:description" content="ÍµêÏû¨ Operating Systems: Three Easy Pieces [Remzi] ÏÜç Homework Î¨∏Ï†ú ÌíÄÏù¥"/><meta data-react-helmet="true" property="og:title" content="OS: Three Easy Pieces [Remzi] &lt;27.Debugging Race&gt; ÌíÄÏù¥"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" http-equiv="Content-Type" content="text/html;charset=UTF-8"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1.0"/><meta data-react-helmet="true" name="description" content="ÍµêÏû¨ Operating Systems: Three Easy Pieces [Remzi] ÏÜç Homework Î¨∏Ï†ú ÌíÄÏù¥"/><meta name="generator" content="Gatsby 4.19.2"/><style data-href="/styles.69a4e1e9c4403d061256.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:#2f2f2f;color:#eee;font-family:Roboto Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5em;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#363636}:not(pre)>code[class*=language-]{border-radius:.2em;padding:.1em;white-space:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1.25em 1em;position:relative}.language-css>code,.language-sass>code,.language-scss>code{color:#fd9170}[class*=language-] .namespace{opacity:.7}.token.atrule{color:#c792ea}.token.attr-name{color:#ffcb6b}.token.attr-value,.token.attribute{color:#a5e844}.token.boolean{color:#c792ea}.token.builtin{color:#ffcb6b}.token.cdata,.token.char{color:#80cbc4}.token.class{color:#ffcb6b}.token.class-name{color:#f2ff00}.token.comment{color:#616161}.token.constant{color:#c792ea}.token.deleted{color:#f66}.token.doctype{color:#616161}.token.entity{color:#f66}.token.function{color:#c792ea}.token.hexcode{color:#f2ff00}.token.id,.token.important{color:#c792ea;font-weight:700}.token.inserted{color:#80cbc4}.token.keyword{color:#c792ea}.token.number{color:#fd9170}.token.operator{color:#89ddff}.token.prolog{color:#616161}.token.property{color:#80cbc4}.token.pseudo-class,.token.pseudo-element{color:#a5e844}.token.punctuation{color:#89ddff}.token.regex{color:#f2ff00}.token.selector{color:#f66}.token.string{color:#a5e844}.token.symbol{color:#c792ea}.token.tag{color:#f66}.token.unit{color:#fd9170}.token.url,.token.variable{color:#f66}:host,:root{--fa-font-solid:normal 900 1em/1 "Font Awesome 6 Solid";--fa-font-regular:normal 400 1em/1 "Font Awesome 6 Regular";--fa-font-light:normal 300 1em/1 "Font Awesome 6 Light";--fa-font-thin:normal 100 1em/1 "Font Awesome 6 Thin";--fa-font-duotone:normal 900 1em/1 "Font Awesome 6 Duotone";--fa-font-brands:normal 400 1em/1 "Font Awesome 6 Brands"}svg:not(:host).svg-inline--fa,svg:not(:root).svg-inline--fa{box-sizing:content-box;overflow:visible}.svg-inline--fa{display:var(--fa-display,inline-block);height:1em;overflow:visible;vertical-align:-.125em}.svg-inline--fa.fa-2xs{vertical-align:.1em}.svg-inline--fa.fa-xs{vertical-align:0}.svg-inline--fa.fa-sm{vertical-align:-.07143em}.svg-inline--fa.fa-lg{vertical-align:-.2em}.svg-inline--fa.fa-xl{vertical-align:-.25em}.svg-inline--fa.fa-2xl{vertical-align:-.3125em}.svg-inline--fa.fa-pull-left{margin-right:var(--fa-pull-margin,.3em);width:auto}.svg-inline--fa.fa-pull-right{margin-left:var(--fa-pull-margin,.3em);width:auto}.svg-inline--fa.fa-li{top:.25em;width:var(--fa-li-width,2em)}.svg-inline--fa.fa-fw{width:var(--fa-fw-width,1.25em)}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-text{left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter{background-color:var(--fa-counter-background-color,#ff253a);border-radius:var(--fa-counter-border-radius,1em);box-sizing:border-box;color:var(--fa-inverse,#fff);line-height:var(--fa-counter-line-height,1);max-width:var(--fa-counter-max-width,5em);min-width:var(--fa-counter-min-width,1.5em);overflow:hidden;padding:var(--fa-counter-padding,.25em .5em);right:var(--fa-right,0);text-overflow:ellipsis;top:var(--fa-top,0);-webkit-transform:scale(var(--fa-counter-scale,.25));transform:scale(var(--fa-counter-scale,.25));-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-bottom-right{bottom:var(--fa-bottom,0);right:var(--fa-right,0);top:auto;-webkit-transform:scale(var(--fa-layers-scale,.25));transform:scale(var(--fa-layers-scale,.25));-webkit-transform-origin:bottom right;transform-origin:bottom right}.fa-layers-bottom-left{bottom:var(--fa-bottom,0);left:var(--fa-left,0);right:auto;top:auto;-webkit-transform:scale(var(--fa-layers-scale,.25));transform:scale(var(--fa-layers-scale,.25));-webkit-transform-origin:bottom left;transform-origin:bottom left}.fa-layers-top-right{right:var(--fa-right,0);top:var(--fa-top,0);-webkit-transform:scale(var(--fa-layers-scale,.25));transform:scale(var(--fa-layers-scale,.25));-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-top-left{left:var(--fa-left,0);right:auto;top:var(--fa-top,0);-webkit-transform:scale(var(--fa-layers-scale,.25));transform:scale(var(--fa-layers-scale,.25));-webkit-transform-origin:top left;transform-origin:top left}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-2xs{font-size:.625em;line-height:.1em;vertical-align:.225em}.fa-xs{font-size:.75em;line-height:.08333em;vertical-align:.125em}.fa-sm{font-size:.875em;line-height:.07143em;vertical-align:.05357em}.fa-lg{font-size:1.25em;line-height:.05em;vertical-align:-.075em}.fa-xl{font-size:1.5em;line-height:.04167em;vertical-align:-.125em}.fa-2xl{font-size:2em;line-height:.03125em;vertical-align:-.1875em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:var(--fa-li-margin,2.5em);padding-left:0}.fa-ul>li{position:relative}.fa-li{left:calc(var(--fa-li-width, 2em)*-1);line-height:inherit;position:absolute;text-align:center;width:var(--fa-li-width,2em)}.fa-border{border-color:var(--fa-border-color,#eee);border-radius:var(--fa-border-radius,.1em);border-style:var(--fa-border-style,solid);border-width:var(--fa-border-width,.08em);padding:var(--fa-border-padding,.2em .25em .15em)}.fa-pull-left{float:left;margin-right:var(--fa-pull-margin,.3em)}.fa-pull-right{float:right;margin-left:var(--fa-pull-margin,.3em)}.fa-beat{-webkit-animation-delay:var(--fa-animation-delay,0);animation-delay:var(--fa-animation-delay,0);-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-name:fa-beat;animation-name:fa-beat;-webkit-animation-timing-function:var(--fa-animation-timing,ease-in-out);animation-timing-function:var(--fa-animation-timing,ease-in-out)}.fa-bounce{-webkit-animation-delay:var(--fa-animation-delay,0);animation-delay:var(--fa-animation-delay,0);-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-name:fa-bounce;animation-name:fa-bounce;-webkit-animation-timing-function:var(--fa-animation-timing,cubic-bezier(.28,.84,.42,1));animation-timing-function:var(--fa-animation-timing,cubic-bezier(.28,.84,.42,1))}.fa-fade{-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-name:fa-fade;animation-name:fa-fade;-webkit-animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1));animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1))}.fa-beat-fade,.fa-fade{-webkit-animation-delay:var(--fa-animation-delay,0);animation-delay:var(--fa-animation-delay,0);-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:var(--fa-animation-duration,1s)}.fa-beat-fade{-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-name:fa-beat-fade;animation-name:fa-beat-fade;-webkit-animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1));animation-timing-function:var(--fa-animation-timing,cubic-bezier(.4,0,.6,1))}.fa-flip{-webkit-animation-delay:var(--fa-animation-delay,0);animation-delay:var(--fa-animation-delay,0);-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-name:fa-flip;animation-name:fa-flip;-webkit-animation-timing-function:var(--fa-animation-timing,ease-in-out);animation-timing-function:var(--fa-animation-timing,ease-in-out)}.fa-shake{-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-name:fa-shake;animation-name:fa-shake;-webkit-animation-timing-function:var(--fa-animation-timing,linear);animation-timing-function:var(--fa-animation-timing,linear)}.fa-shake,.fa-spin{-webkit-animation-delay:var(--fa-animation-delay,0);animation-delay:var(--fa-animation-delay,0);-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal)}.fa-spin{-webkit-animation-duration:var(--fa-animation-duration,2s);animation-duration:var(--fa-animation-duration,2s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-name:fa-spin;animation-name:fa-spin;-webkit-animation-timing-function:var(--fa-animation-timing,linear);animation-timing-function:var(--fa-animation-timing,linear)}.fa-spin-reverse{--fa-animation-direction:reverse}.fa-pulse,.fa-spin-pulse{-webkit-animation-direction:var(--fa-animation-direction,normal);animation-direction:var(--fa-animation-direction,normal);-webkit-animation-duration:var(--fa-animation-duration,1s);animation-duration:var(--fa-animation-duration,1s);-webkit-animation-iteration-count:var(--fa-animation-iteration-count,infinite);animation-iteration-count:var(--fa-animation-iteration-count,infinite);-webkit-animation-name:fa-spin;animation-name:fa-spin;-webkit-animation-timing-function:var(--fa-animation-timing,steps(8));animation-timing-function:var(--fa-animation-timing,steps(8))}@media (prefers-reduced-motion:reduce){.fa-beat,.fa-beat-fade,.fa-bounce,.fa-fade,.fa-flip,.fa-pulse,.fa-shake,.fa-spin,.fa-spin-pulse{-webkit-animation-delay:-1ms;animation-delay:-1ms;-webkit-animation-duration:1ms;animation-duration:1ms;-webkit-animation-iteration-count:1;animation-iteration-count:1;transition-delay:0s;transition-duration:0s}}@-webkit-keyframes fa-beat{0%,90%{-webkit-transform:scale(1);transform:scale(1)}45%{-webkit-transform:scale(var(--fa-beat-scale,1.25));transform:scale(var(--fa-beat-scale,1.25))}}@keyframes fa-beat{0%,90%{-webkit-transform:scale(1);transform:scale(1)}45%{-webkit-transform:scale(var(--fa-beat-scale,1.25));transform:scale(var(--fa-beat-scale,1.25))}}@-webkit-keyframes fa-bounce{0%{-webkit-transform:scale(1) translateY(0);transform:scale(1) translateY(0)}10%{-webkit-transform:scale(var(--fa-bounce-start-scale-x,1.1),var(--fa-bounce-start-scale-y,.9)) translateY(0);transform:scale(var(--fa-bounce-start-scale-x,1.1),var(--fa-bounce-start-scale-y,.9)) translateY(0)}30%{-webkit-transform:scale(var(--fa-bounce-jump-scale-x,.9),var(--fa-bounce-jump-scale-y,1.1)) translateY(var(--fa-bounce-height,-.5em));transform:scale(var(--fa-bounce-jump-scale-x,.9),var(--fa-bounce-jump-scale-y,1.1)) translateY(var(--fa-bounce-height,-.5em))}50%{-webkit-transform:scale(var(--fa-bounce-land-scale-x,1.05),var(--fa-bounce-land-scale-y,.95)) translateY(0);transform:scale(var(--fa-bounce-land-scale-x,1.05),var(--fa-bounce-land-scale-y,.95)) translateY(0)}57%{-webkit-transform:scale(1) translateY(var(--fa-bounce-rebound,-.125em));transform:scale(1) translateY(var(--fa-bounce-rebound,-.125em))}64%{-webkit-transform:scale(1) translateY(0);transform:scale(1) translateY(0)}to{-webkit-transform:scale(1) translateY(0);transform:scale(1) translateY(0)}}@keyframes fa-bounce{0%{-webkit-transform:scale(1) translateY(0);transform:scale(1) translateY(0)}10%{-webkit-transform:scale(var(--fa-bounce-start-scale-x,1.1),var(--fa-bounce-start-scale-y,.9)) translateY(0);transform:scale(var(--fa-bounce-start-scale-x,1.1),var(--fa-bounce-start-scale-y,.9)) translateY(0)}30%{-webkit-transform:scale(var(--fa-bounce-jump-scale-x,.9),var(--fa-bounce-jump-scale-y,1.1)) translateY(var(--fa-bounce-height,-.5em));transform:scale(var(--fa-bounce-jump-scale-x,.9),var(--fa-bounce-jump-scale-y,1.1)) translateY(var(--fa-bounce-height,-.5em))}50%{-webkit-transform:scale(var(--fa-bounce-land-scale-x,1.05),var(--fa-bounce-land-scale-y,.95)) translateY(0);transform:scale(var(--fa-bounce-land-scale-x,1.05),var(--fa-bounce-land-scale-y,.95)) translateY(0)}57%{-webkit-transform:scale(1) translateY(var(--fa-bounce-rebound,-.125em));transform:scale(1) translateY(var(--fa-bounce-rebound,-.125em))}64%{-webkit-transform:scale(1) translateY(0);transform:scale(1) translateY(0)}to{-webkit-transform:scale(1) translateY(0);transform:scale(1) translateY(0)}}@-webkit-keyframes fa-fade{50%{opacity:var(--fa-fade-opacity,.4)}}@keyframes fa-fade{50%{opacity:var(--fa-fade-opacity,.4)}}@-webkit-keyframes fa-beat-fade{0%,to{opacity:var(--fa-beat-fade-opacity,.4);-webkit-transform:scale(1);transform:scale(1)}50%{opacity:1;-webkit-transform:scale(var(--fa-beat-fade-scale,1.125));transform:scale(var(--fa-beat-fade-scale,1.125))}}@keyframes fa-beat-fade{0%,to{opacity:var(--fa-beat-fade-opacity,.4);-webkit-transform:scale(1);transform:scale(1)}50%{opacity:1;-webkit-transform:scale(var(--fa-beat-fade-scale,1.125));transform:scale(var(--fa-beat-fade-scale,1.125))}}@-webkit-keyframes fa-flip{50%{-webkit-transform:rotate3d(var(--fa-flip-x,0),var(--fa-flip-y,1),var(--fa-flip-z,0),var(--fa-flip-angle,-180deg));transform:rotate3d(var(--fa-flip-x,0),var(--fa-flip-y,1),var(--fa-flip-z,0),var(--fa-flip-angle,-180deg))}}@keyframes fa-flip{50%{-webkit-transform:rotate3d(var(--fa-flip-x,0),var(--fa-flip-y,1),var(--fa-flip-z,0),var(--fa-flip-angle,-180deg));transform:rotate3d(var(--fa-flip-x,0),var(--fa-flip-y,1),var(--fa-flip-z,0),var(--fa-flip-angle,-180deg))}}@-webkit-keyframes fa-shake{0%{-webkit-transform:rotate(-15deg);transform:rotate(-15deg)}4%{-webkit-transform:rotate(15deg);transform:rotate(15deg)}24%,8%{-webkit-transform:rotate(-18deg);transform:rotate(-18deg)}12%,28%{-webkit-transform:rotate(18deg);transform:rotate(18deg)}16%{-webkit-transform:rotate(-22deg);transform:rotate(-22deg)}20%{-webkit-transform:rotate(22deg);transform:rotate(22deg)}32%{-webkit-transform:rotate(-12deg);transform:rotate(-12deg)}36%{-webkit-transform:rotate(12deg);transform:rotate(12deg)}40%,to{-webkit-transform:rotate(0deg);transform:rotate(0deg)}}@keyframes fa-shake{0%{-webkit-transform:rotate(-15deg);transform:rotate(-15deg)}4%{-webkit-transform:rotate(15deg);transform:rotate(15deg)}24%,8%{-webkit-transform:rotate(-18deg);transform:rotate(-18deg)}12%,28%{-webkit-transform:rotate(18deg);transform:rotate(18deg)}16%{-webkit-transform:rotate(-22deg);transform:rotate(-22deg)}20%{-webkit-transform:rotate(22deg);transform:rotate(22deg)}32%{-webkit-transform:rotate(-12deg);transform:rotate(-12deg)}36%{-webkit-transform:rotate(12deg);transform:rotate(12deg)}40%,to{-webkit-transform:rotate(0deg);transform:rotate(0deg)}}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.fa-rotate-90{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-webkit-transform:scaleX(-1);transform:scaleX(-1)}.fa-flip-vertical{-webkit-transform:scaleY(-1);transform:scaleY(-1)}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical{-webkit-transform:scale(-1);transform:scale(-1)}.fa-rotate-by{-webkit-transform:rotate(var(--fa-rotate-angle,none));transform:rotate(var(--fa-rotate-angle,none))}.fa-stack{display:inline-block;height:2em;position:relative;vertical-align:middle;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0;z-index:var(--fa-stack-z-index,auto)}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:var(--fa-inverse,#fff)}.fa-sr-only,.fa-sr-only-focusable:not(:focus),.sr-only,.sr-only-focusable:not(:focus){clip:rect(0,0,0,0);border-width:0;height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;white-space:nowrap;width:1px}.svg-inline--fa .fa-primary{fill:var(--fa-primary-color,currentColor);opacity:var(--fa-primary-opacity,1)}.svg-inline--fa .fa-secondary{fill:var(--fa-secondary-color,currentColor)}.svg-inline--fa .fa-secondary,.svg-inline--fa.fa-swap-opacity .fa-primary{opacity:var(--fa-secondary-opacity,.4)}.svg-inline--fa.fa-swap-opacity .fa-secondary{opacity:var(--fa-primary-opacity,1)}.svg-inline--fa mask .fa-primary,.svg-inline--fa mask .fa-secondary{fill:#000}.fa-duotone.fa-inverse,.fad.fa-inverse{color:var(--fa-inverse,#fff)}</style><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=fe1cfd1d0f30f87b6d8f1bf6bea4c1e4" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=fe1cfd1d0f30f87b6d8f1bf6bea4c1e4"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=fe1cfd1d0f30f87b6d8f1bf6bea4c1e4"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=fe1cfd1d0f30f87b6d8f1bf6bea4c1e4"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=fe1cfd1d0f30f87b6d8f1bf6bea4c1e4"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=fe1cfd1d0f30f87b6d8f1bf6bea4c1e4"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=fe1cfd1d0f30f87b6d8f1bf6bea4c1e4"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=fe1cfd1d0f30f87b6d8f1bf6bea4c1e4"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=fe1cfd1d0f30f87b6d8f1bf6bea4c1e4"/><link rel="canonical" href="https://hyeondong.com/os_hw_5/" data-baseprotocol="https:" data-basehost="hyeondong.com"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true">OS: Three Easy Pieces [Remzi] &lt;27.Debugging Race&gt; ÌíÄÏù¥</title><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" title="Yangdongs RSS Feed" href="/rss.xml"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css vbubbu">.css-vbubbu{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100vh;overflow-x:hidden;width:100%;}</style><main class="css-vbubbu e1strnqo0"><style data-emotion="css 1pe8cy1">.css-1pe8cy1{position:fixed;margin:10px 10px;z-index:5;}</style><div class="css-1pe8cy1 e1md2nih0"><style data-emotion="css 1qhl3ja">.css-1qhl3ja{display:grid;place-items:center;width:60px;height:60px;border-radius:20px;background-color:#4ccd97;color:#ffffff;font-size:40px;cursor:pointer;box-shadow:0 0 5px rgba(0, 0, 0, 0.2);-webkit-transition:background-color 0.6s,color 0.6s;transition:background-color 0.6s,color 0.6s;}.css-1qhl3ja:hover{background-color:#ffffff;color:#4ccd97;}@media (max-width: 768px){.css-1qhl3ja{width:45px;height:45px;font-size:30px;border-radius:15px;}}</style><div class="css-1qhl3ja e1md2nih1"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="compass" class="svg-inline--fa fa-compass " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M288 256C288 273.7 273.7 288 256 288C238.3 288 224 273.7 224 256C224 238.3 238.3 224 256 224C273.7 224 288 238.3 288 256zM0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM325.1 306.7L380.6 162.4C388.1 142.1 369 123.9 349.6 131.4L205.3 186.9C196.8 190.1 190.1 196.8 186.9 205.3L131.4 349.6C123.9 369 142.1 388.1 162.4 380.6L306.7 325.1C315.2 321.9 321.9 315.2 325.1 306.7V306.7z"></path></svg></div><style data-emotion="css 12ua5r7">.css-12ua5r7{margin:10px 10px;border-radius:20px;z-index:4;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:fixed;-webkit-transition:500ms;transition:500ms;left:-600px;box-shadow:0 0 5px rgba(0, 0, 0, 0.2);background-color:white;}</style><div class="css-12ua5r7 ee3oskm2"><style data-emotion="css x68nae">.css-x68nae{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;text-align:center;margin-top:5%;margin-bottom:10%;margin:10px;}</style><div class="css-x68nae ee3oskm1"><style data-emotion="css 58nrwj">.css-58nrwj{font-size:20px;margin:15px;}.css-58nrwj:hover{border-bottom:3px solid #4ccd97;}</style><a class="css-58nrwj ee3oskm0" href="/">Home</a><a class="css-58nrwj ee3oskm0" href="/post/">Post</a><a href="https://github.com/Yanghyeondong/tech_blog#readme" class="css-58nrwj ee3oskm0">About</a></div></div></div><style data-emotion="css-global gyifnl">@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');@import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap');*{padding:0;margin:0;box-sizing:border-box;font-family:'Noto Sans KR',sans-serif;}html,body,#___gatsby{height:100%;}a,a:hover{color:inherit;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;}</style><style data-emotion="css 16cz9yp">.css-16cz9yp{position:relative;width:100%;height:400px;}@media (max-width: 768px){.css-16cz9yp{height:300px;}}</style><div class="css-16cz9yp e1opi4mu1"><style data-emotion="css 1bjn9yo">.css-1bjn9yo{z-index:-1;width:100%;height:400px;object-fit:cover;-webkit-filter:brightness(0.25);filter:brightness(0.25);}@media (max-width: 768px){.css-1bjn9yo{height:300px;}}</style><div data-gatsby-image-wrapper="" style="position:absolute" class="gatsby-image-wrapper gatsby-image-wrapper-constrained css-1bjn9yo e1opi4mu0"><div style="max-width:565px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;306&#x27; width=&#x27;565&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABESAAAREgEAwpvaAAABrklEQVQozzWSPa/qMAyG08RN4iRNvxADGwL1qiBoqaAduiAhMfADGEAV450Y2BD8+atTn/sMUeTYsvO+ZlEUOeeUUgCgtZZSGmMQ0VqrlPLex3EMAFEUAQAiAoBSii5MSqlG4ji21mZZhohJkiBilmXWWmNMFEVCCMr03mutAUBKyYQQnPMgCIQQv6ERzrmUEgAoQY4EQcAYU0pxzn87c86ttcfjcbvdFkWxXq/7vu+6bj6fV1V1Op2apun7vqqqpmkWiwVNEYYhc85xzrMsu9/v7/d7GIbb7fZ6vYZh+H6/5/P58/n8HXk+n4/H43q9MsZghGmtnXPee6VUnueHw6Esy9Vqtd/v+74vy7Jt2z8jk8lECEFyIqIQgiEi1ZPaZVnWdb3ZbOq67rpuvV4XRbHb7dq2nc1mxhgSIk1T5xwjqYMgoAt9hoQVQmithRD0pLXO89w5J6X8LQYAspROmsI5lyQJ+a+1NsZQkAy31iKiMebHKkQk6eM4FiNku9Y6DEP/H5rZWhtFUZqmy+XypzNV0pIBQBiGAOC9R0SayHtP24KI0+m0LMumaS6Xyz8ykDVBPPlfZQAAAABJRU5ErkJggg==" alt=""/><picture><source type="image/webp" data-srcset="/static/5e3e112afb9c9c7bd4c291006dba33a4/cdf2b/book2.webp 141w,/static/5e3e112afb9c9c7bd4c291006dba33a4/d9fe4/book2.webp 283w,/static/5e3e112afb9c9c7bd4c291006dba33a4/8b8b9/book2.webp 565w" sizes="(min-width: 565px) 565px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 565px) 565px, 100vw" decoding="async" loading="lazy" data-src="/static/5e3e112afb9c9c7bd4c291006dba33a4/3739d/book2.png" data-srcset="/static/5e3e112afb9c9c7bd4c291006dba33a4/da853/book2.png 141w,/static/5e3e112afb9c9c7bd4c291006dba33a4/9f0de/book2.png 283w,/static/5e3e112afb9c9c7bd4c291006dba33a4/3739d/book2.png 565w" alt="thumbnail"/></picture><noscript><picture><source type="image/webp" srcSet="/static/5e3e112afb9c9c7bd4c291006dba33a4/cdf2b/book2.webp 141w,/static/5e3e112afb9c9c7bd4c291006dba33a4/d9fe4/book2.webp 283w,/static/5e3e112afb9c9c7bd4c291006dba33a4/8b8b9/book2.webp 565w" sizes="(min-width: 565px) 565px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 565px) 565px, 100vw" decoding="async" loading="lazy" src="/static/5e3e112afb9c9c7bd4c291006dba33a4/3739d/book2.png" srcSet="/static/5e3e112afb9c9c7bd4c291006dba33a4/da853/book2.png 141w,/static/5e3e112afb9c9c7bd4c291006dba33a4/9f0de/book2.png 283w,/static/5e3e112afb9c9c7bd4c291006dba33a4/3739d/book2.png 565w" alt="thumbnail"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div><style data-emotion="css lzjgtp">.css-lzjgtp{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;height:400px;margin:0 auto;padding:60px 0;color:#ffffff;}@media (max-width: 768px){.css-lzjgtp{height:330px;width:100%;padding:40px 20px;}}</style><div class="css-lzjgtp e1st1jau7"><style data-emotion="css 10qqw1">.css-10qqw1{display:-webkit-box;overflow:hidden;overflow-wrap:break-word;margin:auto 0;text-overflow:ellipsis;white-space:normal;-webkit-line-clamp:2;-webkit-box-orient:vertical;font-size:42px;font-weight:800;}@media (max-width: 768px){.css-10qqw1{font-size:30px;}}</style><div class="css-10qqw1 e1st1jau5">OS: Three Easy Pieces [Remzi] &lt;27.Debugging Race&gt; ÌíÄÏù¥</div><style data-emotion="css 3gcnt2">.css-3gcnt2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-top:10px;font-size:18px;font-weight:700;}@media (max-width: 768px){.css-3gcnt2{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;font-size:15px;font-weight:400;}}</style><div class="css-3gcnt2 e1st1jau4"><style data-emotion="css 5yjeco">.css-5yjeco{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:start;justify-content:start;}@media (max-width: 768px){.css-5yjeco{-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}</style><div class="css-5yjeco e1st1jau3"><style data-emotion="css 1b9df66">.css-1b9df66{margin:2px 5px;padding:1px 7px 4px 7px;border-radius:6px;background-color:#49ae8e;font-size:16px;font-weight:800;color:white;}@media (max-width: 768px){.css-1b9df66{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}</style><div class="css-1b9df66 e1st1jau2">OS</div></div><style data-emotion="css 14b4j72">.css-14b4j72{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}@media (max-width: 768px){.css-14b4j72{margin:7px 7px;}}</style><div class="css-14b4j72 e1st1jau1"><style data-emotion="css nkt64x">.css-nkt64x{margin-right:10px;}</style><div class="css-nkt64x e1st1jau0"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="calendar-days" class="svg-inline--fa fa-calendar-days " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M160 32V64H288V32C288 14.33 302.3 0 320 0C337.7 0 352 14.33 352 32V64H400C426.5 64 448 85.49 448 112V160H0V112C0 85.49 21.49 64 48 64H96V32C96 14.33 110.3 0 128 0C145.7 0 160 14.33 160 32zM0 192H448V464C448 490.5 426.5 512 400 512H48C21.49 512 0 490.5 0 464V192zM64 304C64 312.8 71.16 320 80 320H112C120.8 320 128 312.8 128 304V272C128 263.2 120.8 256 112 256H80C71.16 256 64 263.2 64 272V304zM192 304C192 312.8 199.2 320 208 320H240C248.8 320 256 312.8 256 304V272C256 263.2 248.8 256 240 256H208C199.2 256 192 263.2 192 272V304zM336 256C327.2 256 320 263.2 320 272V304C320 312.8 327.2 320 336 320H368C376.8 320 384 312.8 384 304V272C384 263.2 376.8 256 368 256H336zM64 432C64 440.8 71.16 448 80 448H112C120.8 448 128 440.8 128 432V400C128 391.2 120.8 384 112 384H80C71.16 384 64 391.2 64 400V432zM208 384C199.2 384 192 391.2 192 400V432C192 440.8 199.2 448 208 448H240C248.8 448 256 440.8 256 432V400C256 391.2 248.8 384 240 384H208zM320 432C320 440.8 327.2 448 336 448H368C376.8 448 384 440.8 384 432V400C384 391.2 376.8 384 368 384H336C327.2 384 320 391.2 320 400V432z"></path></svg></div>2023.08.30.</div></div></div></div><style data-emotion="css hn6e83">.css-hn6e83{margin:auto auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}@media (min-width: 1200px){.css-hn6e83{margin-left:calc( 50% - 384px );}}@media (max-width: 768px){.css-hn6e83{width:100%;}}</style><div class="css-hn6e83 e6b6ljm0"><style data-emotion="css aco8as">.css-aco8as{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;margin:0 auto;padding:100px 0;word-break:break-all;line-height:2.5;font-size:18px;font-weight:400;}.css-aco8as p{padding:3px 0;}.css-aco8as strong{margin:0px 1px;font-size:18.3px;font-weight:800;}.css-aco8as h1,.css-aco8as h2{font-weight:800;margin-bottom:20px;}.css-aco8as h3{margin-bottom:0px;}.css-aco8as *+h1,.css-aco8as *+h2,.css-aco8as *+h3{margin-top:50px;}.css-aco8as *+h4{margin-top:25px;}.css-aco8as hr+h1,.css-aco8as hr+h2,.css-aco8as hr+h3{margin-top:0;}.css-aco8as hr+h4{margin-top:25px;}.css-aco8as h1{font-size:40px;}.css-aco8as h2{font-size:35px;}.css-aco8as h3{font-size:23px;color:#49ae8e;}.css-aco8as blockquote{margin:30px 10px;padding:5px 15px;border-left:2px solid #49ae8e;background-color:#f9f9f9;font-weight:400;}.css-aco8as blockquote li{font-size:18px;margin:0px 15px;padding:0px 10px 0px 5px;background-color:#f9f9f9;}.css-aco8as blockquote ol li::Marker{font-weight:800;color:#000;}.css-aco8as em{padding-right:8px;padding-left:3px;}.css-aco8as ol{margin-left:20px;padding:5px 0;}.css-aco8as ol li::Marker{font-weight:800;font-size:19px;color:#49ae8e;}.css-aco8as ul{margin:20px;margin-right:0px;}.css-aco8as ul li::Marker{content:"‚ñ∂ ";font-weight:800;color:#49ae8e;}.css-aco8as li{font-size:17px;margin:10px 20px;padding-left:10px;padding-right:10px;background-color:#f9f9f9;border-radius:10px;}.css-aco8as li strong{font-size:17.5px;}.css-aco8as del{-webkit-text-decoration:line-through 3px solid rgba(0, 0, 0, .4);text-decoration:line-through 3px solid rgba(0, 0, 0, .4);}.css-aco8as hr{border:1px solid #000000;margin:100px 0;}.css-aco8as a{font-weight:800;color:#49ae8e;-webkit-text-decoration:underline 1px;text-decoration:underline 1px;text-underline-position:under;}.css-aco8as a:hover{color:#ffffff;background-color:#49ae8e;}.css-aco8as pre[class*='language-']{font-weight:300;padding:20px 30px;margin-bottom:15px;font-size:20px;border-radius:10px;border:1px solid #dddddd;}.css-aco8as pre[class*='language-']::-webkit-scrollbar-thumb{background:rgba(255, 255, 255, 0.5);}.css-aco8as pre[class*='language-'] *{font-family:'Roboto Mono',monospace;font-weight:400;}.css-aco8as code[class*='language-']{font-size:16px;margin-right:4px;}.css-aco8as :not(pre)>code[class*="language-"]{font-size:15px;margin-right:4px;margin-left:4px;color:#000000;background-color:#fafafa;border:1px solid #dddddd;padding:1px 4px 3px 4px;border-radius:5px;}.css-aco8as :not(pre)>code[class*="language-"]::selection{background-color:#dadada;}@media (max-width: 768px){.css-aco8as{width:100%;padding:80px 20px;line-height:2.0;font-size:16px;}.css-aco8as h1{font-size:26px;}.css-aco8as h2{font-size:23px;}.css-aco8as h3{font-size:20px;}.css-aco8as strong{margin:0px 3px;font-size:17px;font-weight:800;}.css-aco8as img{width:100%;}.css-aco8as hr{margin:50px 0;}.css-aco8as li{font-size:16px;}}</style><div class="css-aco8as e1ijh0y10"><p><em>Ìï¥Îãπ Ìè¨Ïä§Ìä∏Îäî ÌïÑÏûêÍ∞Ä ÏßÅÏ†ë ÌíÄÏù¥Ìïú Í≤ÉÏúºÎ°ú Ïò§ÎãµÏù¥ÎÇò ÏûòÎ™ªÎêú Ìï¥ÏÑùÏù¥ ÏûàÏùÑ ÏàòÎèÑ ÏûàÏäµÎãàÎã§.</em><br>
<em>ÌòπÏãúÎÇò ÏßÄÏ†ÅÌï† Î∂ÄÎ∂ÑÏù¥ ÏûàÎã§Î©¥ Ìï≠ÏÉÅ ÌôòÏòÅÏûÖÎãàÎã§!</em> üòè</p>
<h2 id="Î¨∏Ï†ú-Î∞è-ÌíÄÏù¥" style="position:relative;"><a href="#%EB%AC%B8%EC%A0%9C-%EB%B0%8F-%ED%92%80%EC%9D%B4" aria-label="Î¨∏Ï†ú Î∞è ÌíÄÏù¥ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Î¨∏Ï†ú Î∞è ÌíÄÏù¥</h2>
<h4 id="1-first-build-main-racec-examine-the-code-so-you-can-see-the-hopefully-obvious-data-race-in-the-code-now-run-helgrind-by-typing-valgrind---toolhelgrind-main-race-to-see-how-it-reports-the-race-does-it-point-to-the-right-lines-of-code-what-other-information-does-it-give-to-you" style="position:relative;"><a href="#1-first-build-main-racec-examine-the-code-so-you-can-see-the-hopefully-obvious-data-race-in-the-code-now-run-helgrind-by-typing-valgrind---toolhelgrind-main-race-to-see-how-it-reports-the-race-does-it-point-to-the-right-lines-of-code-what-other-information-does-it-give-to-you" aria-label="1 first build main racec examine the code so you can see the hopefully obvious data race in the code now run helgrind by typing valgrind   toolhelgrind main race to see how it reports the race does it point to the right lines of code what other information does it give to you permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. First build main-race.c. Examine the code so you can see the (hopefully obvious) data race in the code. Now run helgrind (by typing valgrind ‚Äìtool=helgrind main-race) to see how it reports the race. Does it point to the right lines of code? What other information does it give to you?</h4>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"mythreads.h"</span></span>

<span class="token keyword">int</span> done <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">worker</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"this should print first\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    done <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">pthread_t</span> p<span class="token punctuation">;</span>
    <span class="token function">Pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> worker<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>done <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"this should print last\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">hdyang@DESKTOP<span class="token operator">-</span>EU17S6T<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>os_hw<span class="token operator">/</span><span class="token number">5</span>$ valgrind <span class="token operator">--</span>tool<span class="token operator">=</span>helgrind <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token operator">-</span>race
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> Helgrind<span class="token punctuation">,</span> a thread error detector
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> <span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2007</span><span class="token operator">-</span><span class="token number">2017</span><span class="token punctuation">,</span> and GNU GPL'd<span class="token punctuation">,</span> by OpenWorks LLP et al<span class="token punctuation">.</span>   
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> Using Valgrind<span class="token operator">-</span><span class="token number">3.18</span><span class="token number">.1</span> and LibVEX<span class="token punctuation">;</span> rerun with <span class="token operator">-</span>h <span class="token keyword">for</span> copyright info<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> Command<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token operator">-</span>race
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">-</span>Thread<span class="token operator">-</span>Announcement<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> Thread #<span class="token number">1</span> is the program's root thread
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">-</span>Thread<span class="token operator">-</span>Announcement<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>  
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> Thread #<span class="token number">2</span> was created
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    at <span class="token number">0x4990BA3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">76</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    by <span class="token number">0x4991A9E</span><span class="token operator">:</span> <span class="token function">__clone_internal</span> <span class="token punctuation">(</span>clone<span class="token operator">-</span>internal<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">83</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    by <span class="token number">0x48FF758</span><span class="token operator">:</span> <span class="token function">create_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">295</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    by <span class="token number">0x490027F</span><span class="token operator">:</span> pthread_create@@GLIBC_2<span class="token punctuation">.</span><span class="token number">34</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">828</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    by <span class="token number">0x4853767</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    by <span class="token number">0x109564</span><span class="token operator">:</span> <span class="token function">Pthread_create</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    by <span class="token number">0x109654</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>race<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">17</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>  
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> Possible data race during read of size <span class="token number">4</span> at <span class="token number">0x10C040</span> by thread #<span class="token number">1</span> 
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> Locks held<span class="token operator">:</span> none
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    at <span class="token number">0x109655</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>race<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> This conflicts with a previous write of size <span class="token number">4</span> by thread #<span class="token number">2</span>       
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> Locks held<span class="token operator">:</span> none
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    at <span class="token number">0x109609</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>race<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>  Address <span class="token number">0x10c040</span> is <span class="token number">0</span> bytes inside data symbol <span class="token string">"balance"</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> Possible data race during write of size <span class="token number">4</span> at <span class="token number">0x10C040</span> by thread #<span class="token number">1</span><span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> Locks held<span class="token operator">:</span> none
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    at <span class="token number">0x10965E</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>race<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> This conflicts with a previous write of size <span class="token number">4</span> by thread #<span class="token number">2</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> Locks held<span class="token operator">:</span> none
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    at <span class="token number">0x109609</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>race<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>  Address <span class="token number">0x10c040</span> is <span class="token number">0</span> bytes inside data symbol <span class="token string">"balance"</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> Use <span class="token operator">--</span>history<span class="token operator">-</span>level<span class="token operator">=</span>approx or <span class="token operator">=</span>none to gain increased speed<span class="token punctuation">,</span> at
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> the cost of reduced accuracy of conflicting<span class="token operator">-</span>access information
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> For lists of detected and suppressed errors<span class="token punctuation">,</span> rerun with<span class="token operator">:</span> <span class="token operator">-</span>s
<span class="token operator">==</span><span class="token number">127</span><span class="token operator">==</span> ERROR SUMMARY<span class="token operator">:</span> <span class="token number">2</span> errors from <span class="token number">2</span> <span class="token function">contexts</span> <span class="token punctuation">(</span>suppressed<span class="token operator">:</span> <span class="token number">0</span> from <span class="token number">0</span><span class="token punctuation">)</span></code></pre></div>
<p>helgrindÎ•º Î≥¥Î©¥ mainÏùò 15Î≤àÏß∏ Ï§Ñ(ÌòπÏùÄ address)Ïóê Ìï¥ÎãπÌïòÎäî ‚Äúbalance++;‚ÄúÏóêÏÑú raceÍ∞Ä ÎÇòÌÉÄÎÇúÎã§Îäî Í≤ÉÏùÑ Ïûò ÏïåÎ†§Ï£ºÍ≥† ÏûàÎã§. ÎòêÌïú, Thread #1Í≥º Thread #2Í∞Ä ÏÑúÎ°ú Ï∂©ÎèåÏùÑ ÏùºÏúºÌÇ¨Ïàò ÏûàÎã§Îäî ÏÇ¨Ïã§Í≥º ÏÇ¨Ïù¥Ï¶àÎäî 4, Ï∂©ÎèåÏù¥ Í∞ÄÎä•Ìïú Î≥ÄÏàòÍ∞Ä ‚Äúbalance‚ÄùÎùºÎäî Ï†êÎèÑ ÏïåÎ†§Ï§ÄÎã§.</p>
<h4 id="2-what-happens-when-you-remove-one-of-the-offending-lines-of-code-now-add-a-lock-around-one-of-the-updates-to-the-shared-variable-and-then-around-both-what-does-helgrind-report-in-each-of-these-cases" style="position:relative;"><a href="#2-what-happens-when-you-remove-one-of-the-offending-lines-of-code-now-add-a-lock-around-one-of-the-updates-to-the-shared-variable-and-then-around-both-what-does-helgrind-report-in-each-of-these-cases" aria-label="2 what happens when you remove one of the offending lines of code now add a lock around one of the updates to the shared variable and then around both what does helgrind report in each of these cases permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. What happens when you remove one of the offending lines of code? Now add a lock around one of the updates to the shared variable, and then around both. What does helgrind report in each of these cases?</h4>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token operator">==</span><span class="token number">139</span><span class="token operator">==</span> Helgrind<span class="token punctuation">,</span> a thread error detector
<span class="token operator">==</span><span class="token number">139</span><span class="token operator">==</span> <span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2007</span><span class="token operator">-</span><span class="token number">2017</span><span class="token punctuation">,</span> and GNU GPL'd<span class="token punctuation">,</span> by OpenWorks LLP et al<span class="token punctuation">.</span>   
<span class="token operator">==</span><span class="token number">139</span><span class="token operator">==</span> Using Valgrind<span class="token operator">-</span><span class="token number">3.18</span><span class="token number">.1</span> and LibVEX<span class="token punctuation">;</span> rerun with <span class="token operator">-</span>h <span class="token keyword">for</span> copyright info
<span class="token operator">==</span><span class="token number">139</span><span class="token operator">==</span> Command<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token operator">-</span>race
<span class="token operator">==</span><span class="token number">139</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">139</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">139</span><span class="token operator">==</span> Use <span class="token operator">--</span>history<span class="token operator">-</span>level<span class="token operator">=</span>approx or <span class="token operator">=</span>none to gain increased speed<span class="token punctuation">,</span> at
<span class="token operator">==</span><span class="token number">139</span><span class="token operator">==</span> the cost of reduced accuracy of conflicting<span class="token operator">-</span>access information 
<span class="token operator">==</span><span class="token number">139</span><span class="token operator">==</span> For lists of detected and suppressed errors<span class="token punctuation">,</span> rerun with<span class="token operator">:</span> <span class="token operator">-</span>s    
<span class="token operator">==</span><span class="token number">139</span><span class="token operator">==</span> ERROR SUMMARY<span class="token operator">:</span> <span class="token number">0</span> errors from <span class="token number">0</span> <span class="token function">contexts</span> <span class="token punctuation">(</span>suppressed<span class="token operator">:</span> <span class="token number">0</span> from <span class="token number">0</span><span class="token punctuation">)</span></code></pre></div>
<p>15Î≤àÏß∏ Ï§Ñ ‚Äúbalance++;‚ÄúÏùÑ Ï†úÍ±∞ÌïòÎãà ÏóêÎü¨Í∞Ä ÏÇ¨ÎùºÏßÑ Î™®ÏäµÏùÑ Î≥º Ïàò ÏûàÎã§.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"mythreads.h"</span></span>

<span class="token keyword">int</span> balance <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token class-name">pthread_mutex_t</span> lock<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">worker</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">Pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    balance<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// unprotected access</span>
    <span class="token function">Pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">pthread_t</span> p<span class="token punctuation">;</span>
    <span class="token function">Pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> worker<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    balance<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// unprotected access</span>
    <span class="token function">Pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Pthread_join</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token operator">==</span><span class="token number">151</span><span class="token operator">==</span> Helgrind<span class="token punctuation">,</span> a thread error detector
<span class="token operator">==</span><span class="token number">151</span><span class="token operator">==</span> <span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2007</span><span class="token operator">-</span><span class="token number">2017</span><span class="token punctuation">,</span> and GNU GPL'd<span class="token punctuation">,</span> by OpenWorks LLP et al<span class="token punctuation">.</span>   
<span class="token operator">==</span><span class="token number">151</span><span class="token operator">==</span> Using Valgrind<span class="token operator">-</span><span class="token number">3.18</span><span class="token number">.1</span> and LibVEX<span class="token punctuation">;</span> rerun with <span class="token operator">-</span>h <span class="token keyword">for</span> copyright info
<span class="token operator">==</span><span class="token number">151</span><span class="token operator">==</span> Command<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token operator">-</span>race
<span class="token operator">==</span><span class="token number">151</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">151</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">151</span><span class="token operator">==</span> Use <span class="token operator">--</span>history<span class="token operator">-</span>level<span class="token operator">=</span>approx or <span class="token operator">=</span>none to gain increased speed<span class="token punctuation">,</span> at
<span class="token operator">==</span><span class="token number">151</span><span class="token operator">==</span> the cost of reduced accuracy of conflicting<span class="token operator">-</span>access information 
<span class="token operator">==</span><span class="token number">151</span><span class="token operator">==</span> For lists of detected and suppressed errors<span class="token punctuation">,</span> rerun with<span class="token operator">:</span> <span class="token operator">-</span>s    
<span class="token operator">==</span><span class="token number">151</span><span class="token operator">==</span> ERROR SUMMARY<span class="token operator">:</span> <span class="token number">0</span> errors from <span class="token number">0</span> <span class="token function">contexts</span> <span class="token punctuation">(</span>suppressed<span class="token operator">:</span> <span class="token number">7</span> from <span class="token number">7</span><span class="token punctuation">)</span></code></pre></div>
<p>Pthread_mutex_lock(&#x26;lock)ÏùÑ Í±∏Ïñ¥Ï£ºÎãà ÏóêÎü¨Í∞Ä ÏÇ¨ÎùºÏßÑ Î™®ÏäµÏùÑ Î≥º Ïàò ÏûàÎã§.</p>
<h4 id="3-now-lets-look-at-main-deadlockc-examine-the-code-this-code-has-a-problem-known-as-deadlock-which-we-discuss-in-much-more-depth-in-a-forthcoming-chapter-can-you-see-what-problem-it-might-have" style="position:relative;"><a href="#3-now-lets-look-at-main-deadlockc-examine-the-code-this-code-has-a-problem-known-as-deadlock-which-we-discuss-in-much-more-depth-in-a-forthcoming-chapter-can-you-see-what-problem-it-might-have" aria-label="3 now lets look at main deadlockc examine the code this code has a problem known as deadlock which we discuss in much more depth in a forthcoming chapter can you see what problem it might have permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. Now let‚Äôs look at main-deadlock.c. Examine the code. This code has a problem known as deadlock (which we discuss in much more depth in a forthcoming chapter). Can you see what problem it might have?</h4>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"mythreads.h"</span></span>

<span class="token class-name">pthread_mutex_t</span> m1 <span class="token operator">=</span> PTHREAD_MUTEX_INITIALIZER<span class="token punctuation">;</span>
<span class="token class-name">pthread_mutex_t</span> m2 <span class="token operator">=</span> PTHREAD_MUTEX_INITIALIZER<span class="token punctuation">;</span>

<span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">worker</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">)</span> arg <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">Pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	<span class="token function">Pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">Pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">pthread_t</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">;</span>
    <span class="token function">Pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> worker<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> worker<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Pthread_join</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Pthread_join</span><span class="token punctuation">(</span>p2<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ÎëêÍ∞úÏùò thread p1, p2Í∞Ä Í∞ÅÍ∞Å m1Í≥º m2Ïóê ÎåÄÌï¥ lockÏùÑ Ìïú ÏÉÅÌÉúÏóêÏÑú, ÏÑúÎ°ú Îã§Ïãú ÏÉÅÎåÄÎ∞©Ïùò m2ÏôÄ m1ÏùÑ ÍµêÏ∞®Ìï¥ÏÑú lockÏùÑ ÌïòÍ≤å Îê† Í∞ÄÎä•ÏÑ±Ïù¥ ÏûàÎã§. Ï¶â, p1ÏùÄ m1ÏùÑ lock Ìïú ÏÉÅÌÉúÏóêÏÑú m2Í∞Ä lock Ïù¥ ÌíÄÎ¶¥ ÎïåÍπåÏßÄ Í∏∞Îã§Î¶¨Í≥† p2Îäî m2Î•º lockÌïú ÏÉÅÌÉúÏóêÏÑú m1Ïùò lockÏù¥ ÌíÄÎ¶¥ ÎïåÍπåÏßÄ Í∏∞Îã§Î¶¨ÎØÄÎ°ú ÏÑúÎ°ú dead lock ÏÉÅÌÉúÏóê Îπ†Ï†∏ÏÑú ÏòÅÏõêÌûà Ïã§ÌñâÎêòÏßÄ Î™ªÌïòÎäî ÏÉÅÌô©Ïù¥ Î∞úÏÉùÌï† Ïàò ÏûàÎã§.</p>
<h4 id="4-now-run-helgrind-on-this-code-what-does-helgrind-report" style="position:relative;"><a href="#4-now-run-helgrind-on-this-code-what-does-helgrind-report" aria-label="4 now run helgrind on this code what does helgrind report permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. Now run helgrind on this code. What does helgrind report?</h4>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">
hdyang@DESKTOP<span class="token operator">-</span>EU17S6T<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>os_hw<span class="token operator">/</span><span class="token number">5</span>$ valgrind <span class="token operator">--</span>tool<span class="token operator">=</span>helgrind <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token operator">-</span>deadlock
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Helgrind<span class="token punctuation">,</span> a thread error detector
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> <span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2007</span><span class="token operator">-</span><span class="token number">2017</span><span class="token punctuation">,</span> and GNU GPL'd<span class="token punctuation">,</span> by OpenWorks LLP et al<span class="token punctuation">.</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Using Valgrind<span class="token operator">-</span><span class="token number">3.18</span><span class="token number">.1</span> and LibVEX<span class="token punctuation">;</span> rerun with <span class="token operator">-</span>h <span class="token keyword">for</span> copyright info
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Command<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token operator">-</span>deadlock
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">-</span>Thread<span class="token operator">-</span>Announcement<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Thread #<span class="token number">3</span> was created
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4990BA3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">76</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4991A9E</span><span class="token operator">:</span> <span class="token function">__clone_internal</span> <span class="token punctuation">(</span>clone<span class="token operator">-</span>internal<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">83</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FF758</span><span class="token operator">:</span> <span class="token function">create_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">295</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x490027F</span><span class="token operator">:</span> pthread_create@@GLIBC_2<span class="token punctuation">.</span><span class="token number">34</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">828</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4853767</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109564</span><span class="token operator">:</span> <span class="token function">Pthread_create</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1096C9</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Thread #<span class="token number">3</span><span class="token operator">:</span> lock order <span class="token string">"0x10C040 before 0x10C080"</span> violated
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> <span class="token function">Observed</span> <span class="token punctuation">(</span>incorrect<span class="token punctuation">)</span> order is<span class="token operator">:</span> acquisition of lock at <span class="token number">0x10C080</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109639</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>  followed by a later acquisition of lock at <span class="token number">0x10C040</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109648</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Required order was established by acquisition of lock at <span class="token number">0x10C040</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109619</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>  followed by a later acquisition of lock at <span class="token number">0x10C080</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109628</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>  Lock at <span class="token number">0x10C040</span> was first observed
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109619</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>  Address <span class="token number">0x10c040</span> is <span class="token number">0</span> bytes inside data symbol <span class="token string">"m1"</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>  Lock at <span class="token number">0x10C080</span> was first observed
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109628</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>  Address <span class="token number">0x10c080</span> is <span class="token number">0</span> bytes inside data symbol <span class="token string">"m2"</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Use <span class="token operator">--</span>history<span class="token operator">-</span>level<span class="token operator">=</span>approx or <span class="token operator">=</span>none to gain increased speed<span class="token punctuation">,</span> at
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> the cost of reduced accuracy of conflicting<span class="token operator">-</span>access information
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> For lists of detected and suppressed errors<span class="token punctuation">,</span> rerun with<span class="token operator">:</span> <span class="token operator">-</span>s
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> ERROR SUMMARY<span class="token operator">:</span> <span class="token number">1</span> errors from <span class="token number">1</span> <span class="token function">contexts</span> <span class="token punctuation">(</span>suppressed<span class="token operator">:</span> <span class="token number">7</span> from <span class="token number">7</span><span class="token punctuation">)</span></code></pre></div>
<p>lock orderÍ∞Ä violated Îê®ÏùÑ ÏïåÎ†§Ï§ÄÎã§. m1Í≥º m2Ïùò addressÎ•º ÏïåÎ†§Ï£ºÎ©∞ ÏÑúÎ°ú ÏöîÍµ¨ÌïòÎäî lockÏù¥ Í≥†Ï∞© ÏÉÅÌÉúÏóê Îπ†ÏßÑÎã§Îäî ÏÇ¨Ïã§ÏùÑ ÏïåÎ†§Ï§ÄÎã§.</p>
<h4 id="5-now-run-helgrind-on-main-deadlock-globalc-examine-the-code-does-it-have-the-same-problem-that-main-deadlockc-has-should-helgrind-be-reporting-the-same-error-what-does-this-tell-you-about-tools-like-helgrind" style="position:relative;"><a href="#5-now-run-helgrind-on-main-deadlock-globalc-examine-the-code-does-it-have-the-same-problem-that-main-deadlockc-has-should-helgrind-be-reporting-the-same-error-what-does-this-tell-you-about-tools-like-helgrind" aria-label="5 now run helgrind on main deadlock globalc examine the code does it have the same problem that main deadlockc has should helgrind be reporting the same error what does this tell you about tools like helgrind permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5. Now run helgrind on main-deadlock-global.c. Examine the code; does it have the same problem that main-deadlock.c has? Should helgrind be reporting the same error? What does this tell you about tools like helgrind?</h4>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Helgrind<span class="token punctuation">,</span> a thread error detector
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> <span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2007</span><span class="token operator">-</span><span class="token number">2017</span><span class="token punctuation">,</span> and GNU GPL'd<span class="token punctuation">,</span> by OpenWorks LLP et al<span class="token punctuation">.</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Using Valgrind<span class="token operator">-</span><span class="token number">3.18</span><span class="token number">.1</span> and LibVEX<span class="token punctuation">;</span> rerun with <span class="token operator">-</span>h <span class="token keyword">for</span> copyright info
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Command<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token operator">-</span>deadlock
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">-</span>Thread<span class="token operator">-</span>Announcement<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Thread #<span class="token number">3</span> was created
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4990BA3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">76</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4991A9E</span><span class="token operator">:</span> <span class="token function">__clone_internal</span> <span class="token punctuation">(</span>clone<span class="token operator">-</span>internal<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">83</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FF758</span><span class="token operator">:</span> <span class="token function">create_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">295</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x490027F</span><span class="token operator">:</span> pthread_create@@GLIBC_2<span class="token punctuation">.</span><span class="token number">34</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">828</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4853767</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109564</span><span class="token operator">:</span> <span class="token function">Pthread_create</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1096C9</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Thread #<span class="token number">3</span><span class="token operator">:</span> lock order <span class="token string">"0x10C040 before 0x10C080"</span> violated
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> <span class="token function">Observed</span> <span class="token punctuation">(</span>incorrect<span class="token punctuation">)</span> order is<span class="token operator">:</span> acquisition of lock at <span class="token number">0x10C080</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109639</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>  followed by a later acquisition of lock at <span class="token number">0x10C040</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109648</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Required order was established by acquisition of lock at <span class="token number">0x10C040</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109619</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>  followed by a later acquisition of lock at <span class="token number">0x10C080</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109628</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>  Lock at <span class="token number">0x10C040</span> was first observed
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109619</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>  Address <span class="token number">0x10c040</span> is <span class="token number">0</span> bytes inside data symbol <span class="token string">"m1"</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>  Lock at <span class="token number">0x10C080</span> was first observed
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x109628</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>  Address <span class="token number">0x10c080</span> is <span class="token number">0</span> bytes inside data symbol <span class="token string">"m2"</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> Use <span class="token operator">--</span>history<span class="token operator">-</span>level<span class="token operator">=</span>approx or <span class="token operator">=</span>none to gain increased speed<span class="token punctuation">,</span> at
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> the cost of reduced accuracy of conflicting<span class="token operator">-</span>access information
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> For lists of detected and suppressed errors<span class="token punctuation">,</span> rerun with<span class="token operator">:</span> <span class="token operator">-</span>s
<span class="token operator">==</span><span class="token number">159</span><span class="token operator">==</span> ERROR SUMMARY<span class="token operator">:</span> <span class="token number">1</span> errors from <span class="token number">1</span> <span class="token function">contexts</span> <span class="token punctuation">(</span>suppressed<span class="token operator">:</span> <span class="token number">7</span> from <span class="token number">7</span><span class="token punctuation">)</span>
hdyang@DESKTOP<span class="token operator">-</span>EU17S6T<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>os_hw<span class="token operator">/</span><span class="token number">5</span>$ valgrind <span class="token operator">--</span>tool<span class="token operator">=</span>helgrind <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token operator">-</span>deadlock<span class="token operator">-</span>global 
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> Helgrind<span class="token punctuation">,</span> a thread error detector
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> <span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2007</span><span class="token operator">-</span><span class="token number">2017</span><span class="token punctuation">,</span> and GNU GPL'd<span class="token punctuation">,</span> by OpenWorks LLP et al<span class="token punctuation">.</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> Using Valgrind<span class="token operator">-</span><span class="token number">3.18</span><span class="token number">.1</span> and LibVEX<span class="token punctuation">;</span> rerun with <span class="token operator">-</span>h <span class="token keyword">for</span> copyright info
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> Command<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token operator">-</span>deadlock<span class="token operator">-</span>global
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">-</span>Thread<span class="token operator">-</span>Announcement<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> Thread #<span class="token number">3</span> was created
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    at <span class="token number">0x4990BA3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">76</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x4991A9E</span><span class="token operator">:</span> <span class="token function">__clone_internal</span> <span class="token punctuation">(</span>clone<span class="token operator">-</span>internal<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">83</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x48FF758</span><span class="token operator">:</span> <span class="token function">create_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">295</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x490027F</span><span class="token operator">:</span> pthread_create@@GLIBC_2<span class="token punctuation">.</span><span class="token number">34</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">828</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x4853767</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x109564</span><span class="token operator">:</span> <span class="token function">Pthread_create</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x1096E7</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token operator">-</span>global<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">27</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> Thread #<span class="token number">3</span><span class="token operator">:</span> lock order <span class="token string">"0x10C080 before 0x10C0C0"</span> violated
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> <span class="token function">Observed</span> <span class="token punctuation">(</span>incorrect<span class="token punctuation">)</span> order is<span class="token operator">:</span> acquisition of lock at <span class="token number">0x10C0C0</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x109648</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token operator">-</span>global<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>  followed by a later acquisition of lock at <span class="token number">0x10C080</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x109657</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token operator">-</span>global<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> Required order was established by acquisition of lock at <span class="token number">0x10C080</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x109628</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token operator">-</span>global<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>  followed by a later acquisition of lock at <span class="token number">0x10C0C0</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x109637</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token operator">-</span>global<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>  Lock at <span class="token number">0x10C080</span> was first observed
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x109628</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token operator">-</span>global<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">12</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>  Address <span class="token number">0x10c080</span> is <span class="token number">0</span> bytes inside data symbol <span class="token string">"m1"</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>  Lock at <span class="token number">0x10C0C0</span> was first observed
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    at <span class="token number">0x4850CCF</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x1093A6</span><span class="token operator">:</span> <span class="token function">Pthread_mutex_lock</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x109637</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>deadlock<span class="token operator">-</span>global<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">13</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>  Address <span class="token number">0x10c0c0</span> is <span class="token number">0</span> bytes inside data symbol <span class="token string">"m2"</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> Use <span class="token operator">--</span>history<span class="token operator">-</span>level<span class="token operator">=</span>approx or <span class="token operator">=</span>none to gain increased speed<span class="token punctuation">,</span> at
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> the cost of reduced accuracy of conflicting<span class="token operator">-</span>access information
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> For lists of detected and suppressed errors<span class="token punctuation">,</span> rerun with<span class="token operator">:</span> <span class="token operator">-</span>s
<span class="token operator">==</span><span class="token number">163</span><span class="token operator">==</span> ERROR SUMMARY<span class="token operator">:</span> <span class="token number">1</span> errors from <span class="token number">1</span> <span class="token function">contexts</span> <span class="token punctuation">(</span>suppressed<span class="token operator">:</span> <span class="token number">7</span> from <span class="token number">7</span><span class="token punctuation">)</span></code></pre></div>
<p>main-deadlock-global.cÏùò Í≤ΩÏö∞, Í∏ÄÎ°úÎ≤å lockÏùÑ ÌÜµÌï¥ Ïù¥Ï†ÑÏùò Î¨∏Ï†úÎ•º Ìï¥Í≤∞ÌïúÎã§. Îã§Îßå, helgrind ÏÉÅÏóêÏÑúÎäî Ï°∞Í∏à Ï∞®Ïù¥Í∞Ä ÏûàÍ∏¥ ÌïòÏßÄÎßå Ïó¨Ï†ÑÌûà ÏóêÎü¨Î¨∏Íµ¨Í∞Ä Î∞úÏÉùÌïúÎã§. Ïù¥Îü¨Ìïú Ï†êÏùÄ helgrindÎèÑ Ìï¥Îãπ ÏΩîÎìúÏùò ÏóêÎü¨Î•º ÏûòÎ™ª ÌåêÎã®Ìï† Ïàò ÏûàÎã§Îäî Ï†êÏùÑ ÏïåÎ†§Ï§ÄÎã§.</p>
<h4 id="6-lets-next-look-at-main-signalc-this-code-uses-a-variable-done-to-signal-that-the-child-is-done-and-that-the-parent-can-now-continue-why-is-this-code-inefficient-what-does-the-parent-end-up-spending-its-time-doing-particularly-if-the-child-thread-takes-a-long-time-to-complete" style="position:relative;"><a href="#6-lets-next-look-at-main-signalc-this-code-uses-a-variable-done-to-signal-that-the-child-is-done-and-that-the-parent-can-now-continue-why-is-this-code-inefficient-what-does-the-parent-end-up-spending-its-time-doing-particularly-if-the-child-thread-takes-a-long-time-to-complete" aria-label="6 lets next look at main signalc this code uses a variable done to signal that the child is done and that the parent can now continue why is this code inefficient what does the parent end up spending its time doing particularly if the child thread takes a long time to complete permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6. Let‚Äôs next look at main-signal.c. This code uses a variable (done) to signal that the child is done and that the parent can now continue. Why is this code inefficient? (what does the parent end up spending its time doing, particularly if the child thread takes a long time to complete?)</h4>
<p>Ìï¥Îãπ ÏΩîÎìúÏùò Í≤ΩÏö∞ child threadÍ∞Ä Ïò§Îû´ÎèôÏïà Ïã§ÌñâÎêúÎã§Î©¥, doneÏù¥ 1Ïù¥ ÎêòÍ∏∞ Ï†ÑÍπåÏßÄ parentÎäî ÏïÑÎ¨¥ ÏùòÎØ∏ ÏóÜÎäî Î∞òÎ≥µÎ¨∏Îßå Í≥ÑÏÜç ÎèåÎ©∞(spin) ÏûêÏõêÏùÑ ÎÇ≠ÎπÑÌïòÍ≤å ÎêúÎã§.</p>
<h4 id="7-now-run-helgrind-on-this-program-what-does-it-report-is-the-code-correct" style="position:relative;"><a href="#7-now-run-helgrind-on-this-program-what-does-it-report-is-the-code-correct" aria-label="7 now run helgrind on this program what does it report is the code correct permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>7. Now run helgrind on this program. What does it report? Is the code correct?</h4>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">hdyang@DESKTOP<span class="token operator">-</span>EU17S6T<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>os_hw<span class="token operator">/</span><span class="token number">5</span>$ valgrind <span class="token operator">--</span>tool<span class="token operator">=</span>helgrind <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token operator">-</span>signal
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Helgrind<span class="token punctuation">,</span> a thread error detector
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> <span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2007</span><span class="token operator">-</span><span class="token number">2017</span><span class="token punctuation">,</span> and GNU GPL'd<span class="token punctuation">,</span> by OpenWorks LLP et al<span class="token punctuation">.</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Using Valgrind<span class="token operator">-</span><span class="token number">3.18</span><span class="token number">.1</span> and LibVEX<span class="token punctuation">;</span> rerun with <span class="token operator">-</span>h <span class="token keyword">for</span> copyright info
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Command<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token operator">-</span>signal
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
this should print first
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">-</span>Thread<span class="token operator">-</span>Announcement<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Thread #<span class="token number">2</span> was created
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    at <span class="token number">0x4990BA3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">76</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x4991A9E</span><span class="token operator">:</span> <span class="token function">__clone_internal</span> <span class="token punctuation">(</span>clone<span class="token operator">-</span>internal<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">83</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x48FF758</span><span class="token operator">:</span> <span class="token function">create_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">295</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x490027F</span><span class="token operator">:</span> pthread_create@@GLIBC_2<span class="token punctuation">.</span><span class="token number">34</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">828</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x4853767</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x109584</span><span class="token operator">:</span> <span class="token function">Pthread_create</span> <span class="token punctuation">(</span>mythreads<span class="token punctuation">.</span>h<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x109682</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>signal<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">-</span>Thread<span class="token operator">-</span>Announcement<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Thread #<span class="token number">1</span> is the program's root thread
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Possible data race during write of size <span class="token number">4</span> at <span class="token number">0x10C014</span> by thread #<span class="token number">2</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Locks held<span class="token operator">:</span> none
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    at <span class="token number">0x109633</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>signal<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> This conflicts with a previous read of size <span class="token number">4</span> by thread #<span class="token number">1</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Locks held<span class="token operator">:</span> none
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    at <span class="token number">0x109684</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>signal<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>  Address <span class="token number">0x10c014</span> is <span class="token number">0</span> bytes inside data symbol <span class="token string">"done"</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Possible data race during read of size <span class="token number">4</span> at <span class="token number">0x10C014</span> by thread #<span class="token number">1</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Locks held<span class="token operator">:</span> none
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    at <span class="token number">0x109684</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>signal<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> This conflicts with a previous write of size <span class="token number">4</span> by thread #<span class="token number">2</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Locks held<span class="token operator">:</span> none
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    at <span class="token number">0x109633</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>signal<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>  Address <span class="token number">0x10c014</span> is <span class="token number">0</span> bytes inside data symbol <span class="token string">"done"</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Possible data race during write of size <span class="token number">1</span> at <span class="token number">0x52971A5</span> by thread #<span class="token number">1</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Locks held<span class="token operator">:</span> none
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    at <span class="token number">0x4859796</span><span class="token operator">:</span> <span class="token function">mempcpy</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x48F66E4</span><span class="token operator">:</span> <span class="token function">_IO_new_file_xsputn</span> <span class="token punctuation">(</span>fileops<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">1235</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x48F66E4</span><span class="token operator">:</span> _IO_file_xsputn@@GLIBC_2<span class="token punctuation">.</span><span class="token number">2.5</span> <span class="token punctuation">(</span>fileops<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">1196</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x48EBF9B</span><span class="token operator">:</span> <span class="token function">puts</span> <span class="token punctuation">(</span>ioputs<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x10969C</span><span class="token operator">:</span> <span class="token function">main</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>signal<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>  Address <span class="token number">0x52971a5</span> is <span class="token number">21</span> bytes inside a block of size <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">024</span> alloc'd
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    at <span class="token number">0x484A919</span><span class="token operator">:</span> <span class="token function">malloc</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x48E9C23</span><span class="token operator">:</span> <span class="token function">_IO_file_doallocate</span> <span class="token punctuation">(</span>filedoalloc<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">101</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x48F8D5F</span><span class="token operator">:</span> <span class="token function">_IO_doallocbuf</span> <span class="token punctuation">(</span>genops<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">347</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x48F7FDF</span><span class="token operator">:</span> _IO_file_overflow@@GLIBC_2<span class="token punctuation">.</span><span class="token number">2.5</span> <span class="token punctuation">(</span>fileops<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">744</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x48F6754</span><span class="token operator">:</span> <span class="token function">_IO_new_file_xsputn</span> <span class="token punctuation">(</span>fileops<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">1243</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x48F6754</span><span class="token operator">:</span> _IO_file_xsputn@@GLIBC_2<span class="token punctuation">.</span><span class="token number">2.5</span> <span class="token punctuation">(</span>fileops<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">1196</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x48EBF9B</span><span class="token operator">:</span> <span class="token function">puts</span> <span class="token punctuation">(</span>ioputs<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x109632</span><span class="token operator">:</span> <span class="token function">worker</span> <span class="token punctuation">(</span>main<span class="token operator">-</span>signal<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x485396A</span><span class="token operator">:</span> <span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span> <span class="token punctuation">(</span>in <span class="token operator">/</span>usr<span class="token operator">/</span>libexec<span class="token operator">/</span>valgrind<span class="token operator">/</span>vgpreload_helgrind<span class="token operator">-</span>amd64<span class="token operator">-</span>linux<span class="token punctuation">.</span>so<span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x48FFB42</span><span class="token operator">:</span> <span class="token function">start_thread</span> <span class="token punctuation">(</span>pthread_create<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">442</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>    by <span class="token number">0x4990BB3</span><span class="token operator">:</span> <span class="token function">clone</span> <span class="token punctuation">(</span>clone<span class="token punctuation">.</span>S<span class="token operator">:</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>  Block was alloc'd by thread #<span class="token number">2</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
this should print last
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> Use <span class="token operator">--</span>history<span class="token operator">-</span>level<span class="token operator">=</span>approx or <span class="token operator">=</span>none to gain increased speed<span class="token punctuation">,</span> at
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> the cost of reduced accuracy of conflicting<span class="token operator">-</span>access information
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> For lists of detected and suppressed errors<span class="token punctuation">,</span> rerun with<span class="token operator">:</span> <span class="token operator">-</span>s
<span class="token operator">==</span><span class="token number">167</span><span class="token operator">==</span> ERROR SUMMARY<span class="token operator">:</span> <span class="token number">24</span> errors from <span class="token number">3</span> <span class="token function">contexts</span> <span class="token punctuation">(</span>suppressed<span class="token operator">:</span> <span class="token number">40</span> from <span class="token number">34</span><span class="token punctuation">)</span></code></pre></div>
<p>helgrindÏóêÏÑúÎäî doneÏù¥ÎùºÎäî Î≥ÄÏàòÏóê ÎåÄÌï¥ 16Î≤àÏß∏ Ï§Ñ ‚Äúwhile (done == 0)‚ÄúÍ≥º 9Î≤àÏß∏ Ï§Ñ ‚Äúdone = 1;‚Äù ÏóêÏÑú race ÏÉÅÌÉúÍ∞Ä Î∞úÏÉùÌï† Ïàò ÏûàÎã§Îäî Ïò§Î•òÎ•º Î≥¥Ïó¨Ï§ÄÎã§. ÎòêÌïú, printf()Ïóê ÎåÄÌï¥ÏÑúÎèÑ ÏàúÏÑú Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌï®ÏùÑ ÏïåÎ†§Ï§ÄÎã§. Îã§Îßå, Ïã§Ï†úÎ°úÎäî spin Îì±Ïóê ÏùòÌï¥ Ïù¥Îü¨Ìïú Î∂ÄÎ∂ÑÏù¥ Î∞úÏÉùÌïòÏßÄ ÏïäÍ≤å ÎêúÎã§. Ï¶â, Ïã§Ï†ú ÏΩîÎìúÏóêÏÑúÎäî Î¨∏Ï†úÍ∞Ä Î∞úÏÉùÌïòÏßÄ ÏïäÍ≤å ÎêúÎã§.</p>
<h4 id="8-now-look-at-a-slightly-modified-version-of-the-code-which-is-found-in-main-signal-cvc-this-version-uses-a-condition-variable-to-do-the-signaling-and-associated-lock-why-is-this-code-preferred-to-the-previous-version-is-it-correctness-or-performance-or-both" style="position:relative;"><a href="#8-now-look-at-a-slightly-modified-version-of-the-code-which-is-found-in-main-signal-cvc-this-version-uses-a-condition-variable-to-do-the-signaling-and-associated-lock-why-is-this-code-preferred-to-the-previous-version-is-it-correctness-or-performance-or-both" aria-label="8 now look at a slightly modified version of the code which is found in main signal cvc this version uses a condition variable to do the signaling and associated lock why is this code preferred to the previous version is it correctness or performance or both permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>8. Now look at a slightly modified version of the code, which is found in main-signal-cv.c. This version uses a condition variable to do the signaling (and associated lock). Why is this code preferred to the previous version? Is it correctness, or performance, or both?</h4>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">__synchronizer_t</span> <span class="token punctuation">{</span>
    <span class="token class-name">pthread_mutex_t</span> lock<span class="token punctuation">;</span>
    <span class="token class-name">pthread_cond_t</span> cond<span class="token punctuation">;</span>
    <span class="token keyword">int</span> done<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token class-name">synchronizer_t</span><span class="token punctuation">;</span>

<span class="token class-name">synchronizer_t</span> s<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">signal_init</span><span class="token punctuation">(</span><span class="token class-name">synchronizer_t</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Pthread_mutex_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token operator">-></span>lock<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Pthread_cond_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token operator">-></span>cond<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s<span class="token operator">-></span>done <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">signal_done</span><span class="token punctuation">(</span><span class="token class-name">synchronizer_t</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token operator">-></span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    s<span class="token operator">-></span>done <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">Pthread_cond_signal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token operator">-></span>cond<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token operator">-></span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">signal_wait</span><span class="token punctuation">(</span><span class="token class-name">synchronizer_t</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Pthread_mutex_lock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token operator">-></span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>s<span class="token operator">-></span>done <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token function">Pthread_cond_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token operator">-></span>cond<span class="token punctuation">,</span> <span class="token operator">&amp;</span>s<span class="token operator">-></span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Pthread_mutex_unlock</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token operator">-></span>lock<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span><span class="token operator">*</span> <span class="token function">worker</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"this should print first\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">signal_done</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">pthread_t</span> p<span class="token punctuation">;</span>
    <span class="token function">signal_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Pthread_create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> worker<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">signal_wait</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"this should print last\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> </code></pre></div>
<p>Ïö∞ÏÑ†, correctness Ï∏°Î©¥ÏóêÏÑú Ìï¥Îãπ ÏΩîÎìúÎäî Ïù¥Ï†ÑÎ≥¥Îã§ Ï¢ãÏïÑÏ°åÎã§. signaling Í¥ÄÎ†® Í∏∞Îä•ÏùÑ Ï∂îÍ∞ÄÌï®ÏúºÎ°úÏç® threadÏùò lockÍ≥º Í¥ÄÎ†®Îêú Ï†ïÎ≥¥Îì§Ïù¥ ÏÑúÎ°ú Ï†ÑÎã¨ÎêòÍ≥†, Ïù¥Î•º ÌÜµÌï¥ concurrency Í¥ÄÎ†® Î¨∏Ï†úÎì§ÏùÑ ÎØ∏Î¶¨ ÏòàÎ∞©ÌïúÎã§.</p>
<p>Í∑∏Î¶¨Í≥†, performance Ï∏°Î©¥ÏóêÏÑúÎèÑ Ìï¥Îãπ ÏΩîÎìúÎäî Ïù¥Ï†ÑÎ≥¥Îã§ Ï¢ãÏïÑÏ°åÎã§. ÏùòÎØ∏ ÏóÜÎäî spinÏùÑ Î∞òÎ≥µÌï¥ÏÑú ÏûêÏõêÏùÑ ÎÇ≠ÎπÑÌïòÏßÄ ÏïäÍ≥† pthread_cond_wait() Îì±ÏùÑ ÌÜµÌï¥ÏÑú Ïä§ÏºÄÏ§ÑÎßÅÏùÑ Î∞îÍøàÏúºÎ°úÏç® (ex. blocked) ÎçîÏö± Ìö®Ïú®Ïù¥ Ï¢ãÍ∏∞ ÎïåÎ¨∏Ïù¥Îã§.</p>
<h4 id="9-once-again-run-helgrind-on-main-signal-cv-does-it-report-any-errors" style="position:relative;"><a href="#9-once-again-run-helgrind-on-main-signal-cv-does-it-report-any-errors" aria-label="9 once again run helgrind on main signal cv does it report any errors permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>9. Once again run helgrind on main-signal-cv. Does it report any errors?</h4>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">hdyang@DESKTOP<span class="token operator">-</span>EU17S6T<span class="token operator">:</span><span class="token operator">~</span><span class="token operator">/</span>os_hw<span class="token operator">/</span><span class="token number">5</span>$ valgrind <span class="token operator">--</span>tool<span class="token operator">=</span>helgrind <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token operator">-</span>signal<span class="token operator">-</span>cv 
<span class="token operator">==</span><span class="token number">180</span><span class="token operator">==</span> Helgrind<span class="token punctuation">,</span> a thread error detector
<span class="token operator">==</span><span class="token number">180</span><span class="token operator">==</span> <span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2007</span><span class="token operator">-</span><span class="token number">2017</span><span class="token punctuation">,</span> and GNU GPL'd<span class="token punctuation">,</span> by OpenWorks LLP et al<span class="token punctuation">.</span>
<span class="token operator">==</span><span class="token number">180</span><span class="token operator">==</span> Using Valgrind<span class="token operator">-</span><span class="token number">3.18</span><span class="token number">.1</span> and LibVEX<span class="token punctuation">;</span> rerun with <span class="token operator">-</span>h <span class="token keyword">for</span> copyright info
<span class="token operator">==</span><span class="token number">180</span><span class="token operator">==</span> Command<span class="token operator">:</span> <span class="token punctuation">.</span><span class="token operator">/</span>main<span class="token operator">-</span>signal<span class="token operator">-</span>cv
<span class="token operator">==</span><span class="token number">180</span><span class="token operator">==</span>
this should print first
this should print last
<span class="token operator">==</span><span class="token number">180</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token number">180</span><span class="token operator">==</span> Use <span class="token operator">--</span>history<span class="token operator">-</span>level<span class="token operator">=</span>approx or <span class="token operator">=</span>none to gain increased speed<span class="token punctuation">,</span> at
<span class="token operator">==</span><span class="token number">180</span><span class="token operator">==</span> the cost of reduced accuracy of conflicting<span class="token operator">-</span>access information
<span class="token operator">==</span><span class="token number">180</span><span class="token operator">==</span> For lists of detected and suppressed errors<span class="token punctuation">,</span> rerun with<span class="token operator">:</span> <span class="token operator">-</span>s
<span class="token operator">==</span><span class="token number">180</span><span class="token operator">==</span> ERROR SUMMARY<span class="token operator">:</span> <span class="token number">0</span> errors from <span class="token number">0</span> <span class="token function">contexts</span> <span class="token punctuation">(</span>suppressed<span class="token operator">:</span> <span class="token number">12</span> from <span class="token number">12</span><span class="token punctuation">)</span></code></pre></div>
<p>ÏóêÎü¨Í∞Ä Î∞úÏÉùÌïòÏßÄ ÏïäÎäîÎã§.</p>
<h2 id="source" style="position:relative;"><a href="#source" aria-label="source permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Source</h2>
<ul>
<li>„ÄéOperating Systems: Three Easy Pieces„Äè <em>-Remzi H. Arpaci-Dusseau ÏßÄÏùå</em><br>
<a href="https://pages.cs.wisc.edu/~remzi/OSTEP/" target="_blank" rel="nofollow">https://pages.cs.wisc.edu/~remzi/OSTEP/</a></li>
</ul></div><style data-emotion="css pit38s">.css-pit38s{height:auto;}</style><div class="css-pit38s etse75s1"><style data-emotion="css v7bn0g">.css-v7bn0g{position:-webkit-sticky;position:sticky;top:50px;display:inline-block;margin:120px 40px;margin-right:0px;height:auto;width:200px;font-size:14.5px;border-left:3px solid #4ccd97;}@media (max-width: 1200px){.css-v7bn0g{display:none;}}.css-v7bn0g li{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding:5px;color:gray;}.css-v7bn0g ul{margin-left:10px;padding:7px 5px;list-style:none;}.css-v7bn0g a:hover{-webkit-transition:0.3s;transition:0.3s;font-size:15px;font-weight:700;color:#433E49;}</style><div class="css-v7bn0g etse75s0"><ul>
<li>
<p><a href="#%EB%AC%B8%EC%A0%9C-%EB%B0%8F-%ED%92%80%EC%9D%B4">Î¨∏Ï†ú Î∞è ÌíÄÏù¥</a></p>
<ul>
<li>
<ul>
<li><a href="#1-first-build-main-racec-examine-the-code-so-you-can-see-the-hopefully-obvious-data-race-in-the-code-now-run-helgrind-by-typing-valgrind---toolhelgrind-main-race-to-see-how-it-reports-the-race-does-it-point-to-the-right-lines-of-code-what-other-information-does-it-give-to-you">1. First build main-race.c. Examine the code so you can see the (hopefully obvious) data race in the code. Now run helgrind (by typing valgrind ‚Äìtool=helgrind main-race) to see how it reports the race. Does it point to the right lines of code? What other information does it give to you?</a></li>
<li><a href="#2-what-happens-when-you-remove-one-of-the-offending-lines-of-code-now-add-a-lock-around-one-of-the-updates-to-the-shared-variable-and-then-around-both-what-does-helgrind-report-in-each-of-these-cases">2. What happens when you remove one of the offending lines of code? Now add a lock around one of the updates to the shared variable, and then around both. What does helgrind report in each of these cases?</a></li>
<li><a href="#3-now-lets-look-at-main-deadlockc-examine-the-code-this-code-has-a-problem-known-as-deadlock-which-we-discuss-in-much-more-depth-in-a-forthcoming-chapter-can-you-see-what-problem-it-might-have">3. Now let‚Äôs look at main-deadlock.c. Examine the code. This code has a problem known as deadlock (which we discuss in much more depth in a forthcoming chapter). Can you see what problem it might have?</a></li>
<li><a href="#4-now-run-helgrind-on-this-code-what-does-helgrind-report">4. Now run helgrind on this code. What does helgrind report?</a></li>
<li><a href="#5-now-run-helgrind-on-main-deadlock-globalc-examine-the-code-does-it-have-the-same-problem-that-main-deadlockc-has-should-helgrind-be-reporting-the-same-error-what-does-this-tell-you-about-tools-like-helgrind">5. Now run helgrind on main-deadlock-global.c. Examine the code; does it have the same problem that main-deadlock.c has? Should helgrind be reporting the same error? What does this tell you about tools like helgrind?</a></li>
<li><a href="#6-lets-next-look-at-main-signalc-this-code-uses-a-variable-done-to-signal-that-the-child-is-done-and-that-the-parent-can-now-continue-why-is-this-code-inefficient-what-does-the-parent-end-up-spending-its-time-doing-particularly-if-the-child-thread-takes-a-long-time-to-complete">6. Let‚Äôs next look at main-signal.c. This code uses a variable (done) to signal that the child is done and that the parent can now continue. Why is this code inefficient? (what does the parent end up spending its time doing, particularly if the child thread takes a long time to complete?)</a></li>
<li><a href="#7-now-run-helgrind-on-this-program-what-does-it-report-is-the-code-correct">7. Now run helgrind on this program. What does it report? Is the code correct?</a></li>
<li><a href="#8-now-look-at-a-slightly-modified-version-of-the-code-which-is-found-in-main-signal-cvc-this-version-uses-a-condition-variable-to-do-the-signaling-and-associated-lock-why-is-this-code-preferred-to-the-previous-version-is-it-correctness-or-performance-or-both">8. Now look at a slightly modified version of the code, which is found in main-signal-cv.c. This version uses a condition variable to do the signaling (and associated lock). Why is this code preferred to the previous version? Is it correctness, or performance, or both?</a></li>
<li><a href="#9-once-again-run-helgrind-on-main-signal-cv-does-it-report-any-errors">9. Once again run helgrind on main-signal-cv. Does it report any errors?</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><a href="#source">Source</a></p>
</li>
</ul></div></div></div><style data-emotion="css qi68kj">.css-qi68kj{width:768px;margin:auto auto;padding:0 10px;}@media (max-width: 768px){.css-qi68kj{width:100%;padding:0 20px;}}</style><div class="css-qi68kj elyfc7a0"><div id="disqus_thread"></div></div><style data-emotion="css 9w9jmx">.css-9w9jmx{display:grid;place-items:center;margin-top:auto;padding:50px 0;font-size:15px;text-align:center;line-height:1.5;}@media (max-width: 768px){.css-9w9jmx{font-size:13px;}}</style><footer class="css-9w9jmx e1oae0v81"><style data-emotion="css chvw2h">.css-chvw2h{width:80px;height:80px;background-image:url('bartender.png');-webkit-background-size:contain;background-size:contain;margin:20px auto 0px auto;}</style><div class="css-chvw2h e1oae0v80"></div>Just an developer with drinks<br/>2022 HyeonDong, Powered By Gatsby.</footer></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/os_hw_5/";window.___webpackCompilationHash="69cbe74074219f3bbd0d";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-c9fa82aa5b1f9c65f078.js"],"app":["/app-64dcf09724069a19b96a.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-c686bcb9fd021576da4f.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-2d1a635f9e34aa3c993c.js"],"component---src-pages-post-tsx":["/component---src-pages-post-tsx-66acd32db55f17007543.js"],"component---src-templates-post-template-tsx":["/component---src-templates-post-template-tsx-676c0d609cc6ccc353e7.js"]};/*]]>*/</script><script src="/polyfill-c9fa82aa5b1f9c65f078.js" nomodule=""></script><script src="/app-64dcf09724069a19b96a.js" async=""></script><script src="/framework-c57a9454c0e3bef16c3b.js" async=""></script><script src="/webpack-runtime-ee2c7898fe6f22c4cbd1.js" async=""></script></body></html>