{"componentChunkName":"component---src-templates-post-template-tsx","path":"/lambda_snap_action/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h2 id=\"0-문제-인식\" style=\"position:relative;\"><a href=\"#0-%EB%AC%B8%EC%A0%9C-%EC%9D%B8%EC%8B%9D\" aria-label=\"0 문제 인식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>0. 문제 인식</h2>\n<p>졸업작품 <a href=\"https://github.com/Yanghyeondong/DEV-ROOM\" target=\"_blank\" rel=\"nofollow\">DevRoom</a>을 진행하다가, 매번 번거롭게 AWS Lambda를 배포하지 않고 CI/CD를 적용해보기로 했습니다.\r\n하지만 SnapStart 기능을 활성화해서, 일반적인 방법으로는 바로 연결이 되지 않아 그 해결과정을 공유합니다.</p>\n<h2 id=\"1-미리보는-해답과-코드\" style=\"position:relative;\"><a href=\"#1-%EB%AF%B8%EB%A6%AC%EB%B3%B4%EB%8A%94-%ED%95%B4%EB%8B%B5%EA%B3%BC-%EC%BD%94%EB%93%9C\" aria-label=\"1 미리보는 해답과 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 미리보는 해답과 코드</h2>\n<ul>\n<li>API Gateway는 항상 별칭과 연결해서 특정 버전에 귀속되지 않도록 하자!</li>\n<li><code class=\"language-text\">aws lambda update-alias</code>로 매번 새로운 버전의 snapshot에 별칭을 업데이트 해주자!</li>\n<li>용량이 50MB를 넘어갈때는 <code class=\"language-text\">aws s3 sync</code>로 s3에 코드를 저장하자!</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> devroom<span class=\"token punctuation\">-</span>lambda<span class=\"token punctuation\">-</span>cicd\r\n\r\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> develop\r\n\r\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">build-and-deploy</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\r\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v4\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up JDK 21\r\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>java@v4\r\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">java-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'21'</span>\r\n          <span class=\"token key atrule\">distribution</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'temurin'</span>\r\n\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Copy application.properties\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo \"$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.APPLICATION_PROPERTIES <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\" <span class=\"token punctuation\">></span> ./backend/src/main/resources/application.properties\r\n\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build with Gradle\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> cd backend;chmod +x gradlew;./gradlew buildZip\r\n\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Configure AWS Credentials\r\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>actions/configure<span class=\"token punctuation\">-</span>aws<span class=\"token punctuation\">-</span>credentials@v3\r\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">aws-access-key-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.AWS_ACCESS_KEY_ID <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token key atrule\">aws-secret-access-key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.AWS_SECRET_ACCESS_KEY <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token key atrule\">aws-region</span><span class=\"token punctuation\">:</span> ap<span class=\"token punctuation\">-</span>northeast<span class=\"token punctuation\">-</span><span class=\"token number\">2</span>\r\n\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Upload S3 code\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> aws s3 sync ./backend/build/distributions/ s3<span class=\"token punctuation\">:</span>//devroombucket/lambda_snap\r\n\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Update Lambda code\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\r\n          FUNCTION_NAME=devRoomLambda;\r\n          aws lambda update-function-code --function-name $FUNCTION_NAME \\\r\n          --s3-bucket devroombucket --s3-key lambda_snap/DevRoom-Spring.zip</span>\r\n\r\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Update Lambda SnapStart Alias Version\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\r\n          FUNCTION_NAME=devRoomLambda;\r\n          VERSION=$(aws lambda publish-version --function-name $FUNCTION_NAME | jq -r .Version);\r\n          aws lambda update-alias --function-name $FUNCTION_NAME --name snap --function-version $VERSION</span></code></pre></div>\n<h2 id=\"2-snapstart와-api-gateway\" style=\"position:relative;\"><a href=\"#2-snapstart%EC%99%80-api-gateway\" aria-label=\"2 snapstart와 api gateway permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. SnapStart와 API Gateway</h2>\n<p>Lambda에서 SnapStart을 활성화할 경우, 연결되어 있던 API Gateway를 우선 해제해야 합니다.<br>\nSnapStart는 특정 버전을 기준으로 작동하기 때문입니다!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d8c0a4e61c60988425710212cec3b593/737c3/001.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.1875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAwElEQVQY06XQPQsCMQwG4P7//+AkuDs4CO4KbiLi4iCCnpXeebZJr02aih+nHCgIPnQJNC9JVGNrZwpbnyEQM8WH0IRW/E6NV0Vvuh0u9hcHzjlOSUQkv8l3arLW/flutCwuANY5yTlFbPQG0AMgAIYQiagb+KQ61f2Hrw6n2eB4Mlrr4qgR0XvPzB+aiTnS7aU2vAmkS2ut5TsiAsRXs4iklvLel1VlyrKb/WHIB2Y+17Ux5naw1/b5Z++D5T9cAUA20+fL4rQ8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d8c0a4e61c60988425710212cec3b593/a59e9/001.webp 192w,\n/static/d8c0a4e61c60988425710212cec3b593/0ca9f/001.webp 384w,\n/static/d8c0a4e61c60988425710212cec3b593/dc9b9/001.webp 768w,\n/static/d8c0a4e61c60988425710212cec3b593/d2508/001.webp 1111w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d8c0a4e61c60988425710212cec3b593/3b721/001.png 192w,\n/static/d8c0a4e61c60988425710212cec3b593/66595/001.png 384w,\n/static/d8c0a4e61c60988425710212cec3b593/fe486/001.png 768w,\n/static/d8c0a4e61c60988425710212cec3b593/737c3/001.png 1111w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d8c0a4e61c60988425710212cec3b593/fe486/001.png\"\n            alt=\".\"\n            title=\".\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>이후 최신 버전에다 다음과 같이 API Gateway를 연결해줘야 합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2a2a47a1a955e1934b5f0d25bc56cad1/07220/003.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.77083333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA1ElEQVQoz6WPPW7DMAxGdf8jFegJOnTr2KFAUkmWLMEmLcUUycI/aTIkQ92HDxAB6hGk6VPqQjidzzElnCZAXAIACHv9PAYQvfff1g5YL5d5g1ioMRFRa0Q0P8GUWlVVFlj2R6evd8wesMC6Q62VqMkdm2LqVdadpRo/XsPp03XReW+dB0Bmvn7QtqKqZhjw7SXEkJ13fd8z89IRacy/wm3yaqaUQozUmkHEzmZnfcqZiHijbRPupEeYUosI0zxvm/yJ/eZj/E8upYoosxyIGcbxcH4A3EeDbw3/fO0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/2a2a47a1a955e1934b5f0d25bc56cad1/a59e9/003.webp 192w,\n/static/2a2a47a1a955e1934b5f0d25bc56cad1/0ca9f/003.webp 384w,\n/static/2a2a47a1a955e1934b5f0d25bc56cad1/dc9b9/003.webp 768w,\n/static/2a2a47a1a955e1934b5f0d25bc56cad1/e2c2f/003.webp 1152w,\n/static/2a2a47a1a955e1934b5f0d25bc56cad1/694bf/003.webp 1156w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/2a2a47a1a955e1934b5f0d25bc56cad1/3b721/003.png 192w,\n/static/2a2a47a1a955e1934b5f0d25bc56cad1/66595/003.png 384w,\n/static/2a2a47a1a955e1934b5f0d25bc56cad1/fe486/003.png 768w,\n/static/2a2a47a1a955e1934b5f0d25bc56cad1/d2d74/003.png 1152w,\n/static/2a2a47a1a955e1934b5f0d25bc56cad1/07220/003.png 1156w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/2a2a47a1a955e1934b5f0d25bc56cad1/fe486/003.png\"\n            alt=\".\"\n            title=\".\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span><br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bac7e64cc0a7ea56f20b7f5c5f6b0970/13d24/002.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.979166666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVQoz6WQ3Q6DIAyFef9XdNcqiRcI2Bba4uJcHOqyn3jSq9Me+lHTdX3T3AYXx4mY86aUUv4mE2L0Pow+AGL+R0hkJoAQonMjABKlrSYARKqdtbYxRDJ5YU1t2yLR+iQAeO+ttYDI9U8era63L+yUM4sk1rnsNATqHRLLwa9lmFlUl/BerMpSSjnYc20t2KKaRT8M1eY+/MSWA5KqvkWt/Wub+Up4vfb5qj9hX9l8B3t1w710ZkDPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/bac7e64cc0a7ea56f20b7f5c5f6b0970/a59e9/002.webp 192w,\n/static/bac7e64cc0a7ea56f20b7f5c5f6b0970/0ca9f/002.webp 384w,\n/static/bac7e64cc0a7ea56f20b7f5c5f6b0970/dc9b9/002.webp 768w,\n/static/bac7e64cc0a7ea56f20b7f5c5f6b0970/3a5f0/002.webp 845w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/bac7e64cc0a7ea56f20b7f5c5f6b0970/3b721/002.png 192w,\n/static/bac7e64cc0a7ea56f20b7f5c5f6b0970/66595/002.png 384w,\n/static/bac7e64cc0a7ea56f20b7f5c5f6b0970/fe486/002.png 768w,\n/static/bac7e64cc0a7ea56f20b7f5c5f6b0970/13d24/002.png 845w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/bac7e64cc0a7ea56f20b7f5c5f6b0970/fe486/002.png\"\n            alt=\".\"\n            title=\".\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h2 id=\"3-yml-작성-및-설명\" style=\"position:relative;\"><a href=\"#3-yml-%EC%9E%91%EC%84%B1-%EB%B0%8F-%EC%84%A4%EB%AA%85\" aria-label=\"3 yml 작성 및 설명 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. yml 작성 및 설명</h2>\n<p><code class=\"language-text\">.github/workflows</code>폴더에 yml 파일을 작성해 줍니다.<br>\n최종 코드는 포스트 상단에 작성했으며, 한문단씩 설명하도록 하겠습니다.</p>\n<h3 id=\"1-develop-브랜치에-push-할시-작동한다\" style=\"position:relative;\"><a href=\"#1-develop-%EB%B8%8C%EB%9E%9C%EC%B9%98%EC%97%90-push-%ED%95%A0%EC%8B%9C-%EC%9E%91%EB%8F%99%ED%95%9C%EB%8B%A4\" aria-label=\"1 develop 브랜치에 push 할시 작동한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. develop 브랜치에 push 할시 작동한다.</h3>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> devroom<span class=\"token punctuation\">-</span>lambda<span class=\"token punctuation\">-</span>cicd\r\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\r\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\r\n      <span class=\"token punctuation\">-</span> develop</code></pre></div>\n<h3 id=\"2-spring-코드를-배포하기-위한-java-환경-구축\" style=\"position:relative;\"><a href=\"#2-spring-%EC%BD%94%EB%93%9C%EB%A5%BC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%9C-java-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%B6%95\" aria-label=\"2 spring 코드를 배포하기 위한 java 환경 구축 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Spring 코드를 배포하기 위한 java 환경 구축</h3>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Set up JDK 21\r\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/setup<span class=\"token punctuation\">-</span>java@v4\r\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">java-version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'21'</span>\r\n          <span class=\"token key atrule\">distribution</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'temurin'</span></code></pre></div>\n<h3 id=\"3-노출되면-안되는-시크릿-값을-spring에-주입\" style=\"position:relative;\"><a href=\"#3-%EB%85%B8%EC%B6%9C%EB%90%98%EB%A9%B4-%EC%95%88%EB%90%98%EB%8A%94-%EC%8B%9C%ED%81%AC%EB%A6%BF-%EA%B0%92%EC%9D%84-spring%EC%97%90-%EC%A3%BC%EC%9E%85\" aria-label=\"3 노출되면 안되는 시크릿 값을 spring에 주입 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 노출되면 안되는 시크릿 값을 Spring에 주입</h3>\n<p>Spring에서 사용하는 k8s 토큰등이 담겨있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Copy application.properties\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> echo \"$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.APPLICATION_PROPERTIES <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\" <span class=\"token punctuation\">></span> ./backend/src/main/resources/application.properties</code></pre></div>\n<h3 id=\"4-gradle로-java-빌드\" style=\"position:relative;\"><a href=\"#4-gradle%EB%A1%9C-java-%EB%B9%8C%EB%93%9C\" aria-label=\"4 gradle로 java 빌드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Gradle로 Java 빌드</h3>\n<p>SpringBoot 개발시 Gradle을 사용했기에 동일하게 작성해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build with Gradle\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> cd backend;chmod +x gradlew;./gradlew buildZip</code></pre></div>\n<h3 id=\"5-aws-배포를-위한-인증\" style=\"position:relative;\"><a href=\"#5-aws-%EB%B0%B0%ED%8F%AC%EB%A5%BC-%EC%9C%84%ED%95%9C-%EC%9D%B8%EC%A6%9D\" aria-label=\"5 aws 배포를 위한 인증 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. AWS 배포를 위한 인증</h3>\n<p>중요 정보가 노출되지 않도록 깃허브 시크릿을 사용합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Configure AWS Credentials\r\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> aws<span class=\"token punctuation\">-</span>actions/configure<span class=\"token punctuation\">-</span>aws<span class=\"token punctuation\">-</span>credentials@v3\r\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\r\n          <span class=\"token key atrule\">aws-access-key-id</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.AWS_ACCESS_KEY_ID <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token key atrule\">aws-secret-access-key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.AWS_SECRET_ACCESS_KEY <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\r\n          <span class=\"token key atrule\">aws-region</span><span class=\"token punctuation\">:</span> ap<span class=\"token punctuation\">-</span>northeast<span class=\"token punctuation\">-</span><span class=\"token number\">2</span></code></pre></div>\n<h3 id=\"6-용량-문제가-생기는-spring-코드를-s3에-업로드\" style=\"position:relative;\"><a href=\"#6-%EC%9A%A9%EB%9F%89-%EB%AC%B8%EC%A0%9C%EA%B0%80-%EC%83%9D%EA%B8%B0%EB%8A%94-spring-%EC%BD%94%EB%93%9C%EB%A5%BC-s3%EC%97%90-%EC%97%85%EB%A1%9C%EB%93%9C\" aria-label=\"6 용량 문제가 생기는 spring 코드를 s3에 업로드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 용량 문제가 생기는 Spring 코드를 S3에 업로드</h3>\n<p>50MB를 넘어가면 직접 업로드가 안됩니다!</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Upload S3 code\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> aws s3 sync ./backend/build/distributions/ s3<span class=\"token punctuation\">:</span>//devroombucket/lambda_snap</code></pre></div>\n<h3 id=\"7-s3를-소스로-해서-새로운-람다-버전-배포\" style=\"position:relative;\"><a href=\"#7-s3%EB%A5%BC-%EC%86%8C%EC%8A%A4%EB%A1%9C-%ED%95%B4%EC%84%9C-%EC%83%88%EB%A1%9C%EC%9A%B4-%EB%9E%8C%EB%8B%A4-%EB%B2%84%EC%A0%84-%EB%B0%B0%ED%8F%AC\" aria-label=\"7 s3를 소스로 해서 새로운 람다 버전 배포 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. S3를 소스로 해서 새로운 람다 버전 배포</h3>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">     <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Update Lambda code\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\r\n          FUNCTION_NAME=devRoomLambda;\r\n          aws lambda update-function-code --function-name $FUNCTION_NAME \\\r\n          --s3-bucket devroombucket --s3-key lambda_snap/DevRoom-Spring.zip</span></code></pre></div>\n<h3 id=\"8-최신-버전의-람다에-alias를-할당\" style=\"position:relative;\"><a href=\"#8-%EC%B5%9C%EC%8B%A0-%EB%B2%84%EC%A0%84%EC%9D%98-%EB%9E%8C%EB%8B%A4%EC%97%90-alias%EB%A5%BC-%ED%95%A0%EB%8B%B9\" aria-label=\"8 최신 버전의 람다에 alias를 할당 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8. 최신 버전의 람다에 alias를 할당.</h3>\n<p><code class=\"language-text\">VERSION=$(aws lambda publish-version --function-name $FUNCTION_NAME | jq -r .Version);</code>으로 최신버전을 불러오는 것이 핵심입니다!</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\">      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Update Lambda SnapStart Alias Version\r\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\r\n          FUNCTION_NAME=devRoomLambda;\r\n          VERSION=$(aws lambda publish-version --function-name $FUNCTION_NAME | jq -r .Version);\r\n          aws lambda update-alias --function-name $FUNCTION_NAME --name snap --function-version $VERSION</span></code></pre></div>","id":"2e673f5d-b744-5d93-bce0-389f6dc20210","tableOfContents":"<ul>\n<li>\n<p><a href=\"#0-%EB%AC%B8%EC%A0%9C-%EC%9D%B8%EC%8B%9D\">0. 문제 인식</a></p>\n</li>\n<li>\n<p><a href=\"#1-%EB%AF%B8%EB%A6%AC%EB%B3%B4%EB%8A%94-%ED%95%B4%EB%8B%B5%EA%B3%BC-%EC%BD%94%EB%93%9C\">1. 미리보는 해답과 코드</a></p>\n</li>\n<li>\n<p><a href=\"#2-snapstart%EC%99%80-api-gateway\">2. SnapStart와 API Gateway</a></p>\n</li>\n<li>\n<p><a href=\"#3-yml-%EC%9E%91%EC%84%B1-%EB%B0%8F-%EC%84%A4%EB%AA%85\">3. yml 작성 및 설명</a></p>\n<ul>\n<li><a href=\"#1-develop-%EB%B8%8C%EB%9E%9C%EC%B9%98%EC%97%90-push-%ED%95%A0%EC%8B%9C-%EC%9E%91%EB%8F%99%ED%95%9C%EB%8B%A4\">1. develop 브랜치에 push 할시 작동한다.</a></li>\n<li><a href=\"#2-spring-%EC%BD%94%EB%93%9C%EB%A5%BC-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%9C-java-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%B6%95\">2. Spring 코드를 배포하기 위한 java 환경 구축</a></li>\n<li><a href=\"#3-%EB%85%B8%EC%B6%9C%EB%90%98%EB%A9%B4-%EC%95%88%EB%90%98%EB%8A%94-%EC%8B%9C%ED%81%AC%EB%A6%BF-%EA%B0%92%EC%9D%84-spring%EC%97%90-%EC%A3%BC%EC%9E%85\">3. 노출되면 안되는 시크릿 값을 Spring에 주입</a></li>\n<li><a href=\"#4-gradle%EB%A1%9C-java-%EB%B9%8C%EB%93%9C\">4. Gradle로 Java 빌드</a></li>\n<li><a href=\"#5-aws-%EB%B0%B0%ED%8F%AC%EB%A5%BC-%EC%9C%84%ED%95%9C-%EC%9D%B8%EC%A6%9D\">5. AWS 배포를 위한 인증</a></li>\n<li><a href=\"#6-%EC%9A%A9%EB%9F%89-%EB%AC%B8%EC%A0%9C%EA%B0%80-%EC%83%9D%EA%B8%B0%EB%8A%94-spring-%EC%BD%94%EB%93%9C%EB%A5%BC-s3%EC%97%90-%EC%97%85%EB%A1%9C%EB%93%9C\">6. 용량 문제가 생기는 Spring 코드를 S3에 업로드</a></li>\n<li><a href=\"#7-s3%EB%A5%BC-%EC%86%8C%EC%8A%A4%EB%A1%9C-%ED%95%B4%EC%84%9C-%EC%83%88%EB%A1%9C%EC%9A%B4-%EB%9E%8C%EB%8B%A4-%EB%B2%84%EC%A0%84-%EB%B0%B0%ED%8F%AC\">7. S3를 소스로 해서 새로운 람다 버전 배포</a></li>\n<li><a href=\"#8-%EC%B5%9C%EC%8B%A0-%EB%B2%84%EC%A0%84%EC%9D%98-%EB%9E%8C%EB%8B%A4%EC%97%90-alias%EB%A5%BC-%ED%95%A0%EB%8B%B9\">8. 최신 버전의 람다에 alias를 할당.</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"Lambda SnapStart를 Github Action으로 배포할 때 주의할 점","summary":"SnapStart를 사용할 때 Github Action의 yml 코드를 알아봅니다","date":"2024.05.31.","categories":["AWS","DevOps"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAgJB//EABUBAQEAAAAAAAAAAAAAAAAAAAcI/9oADAMBAAIQAxAAAAGaTkpa5TYeUgMdIhpL/8QAGxAAAgIDAQAAAAAAAAAAAAAABAUCBgABAxP/2gAIAQEAAQUCBUNGOqpXCOslSsSAa80zhKtNGWsFYGeP/8QAJBEAAgECAwkAAAAAAAAAAAAAAQIRAwQABQcSExUhIjEzQZH/2gAIAQMBAT8Byi24jmrI7tG+KkNBHJoEQO33Fpp9ZvbUH2qPVSQ+M+wMf//EACQRAAIBAgQHAQAAAAAAAAAAAAECAwQFAAYREgchIiMxQVFh/9oACAECAQE/Ab9cVy/lyOaOnRyKZZAVBVjuQE7urQnXxyGn7i4cdLnHXVca0b7UqJVHe9ByPmP/xAAjEAEAAgEEAQQDAAAAAAAAAAABAgMhAAQREgUxQVFhFCIk/9oACAEBAAY/ApXbPx+93VFUmNt2321ttNciJNLLYRYQSCSe0jiKPuaplDx296hGM38S/qzikFHqmZ+pzh+NQjM4kKInCOMI5H6ddKN3uaa2fZrpvtqgyxlhCUYrgynOD4NV8eQ3mAD+m7gPg/f0+tC7iaqqvCr7qpyr7rr/xAAZEAEAAwEBAAAAAAAAAAAAAAABESExAEH/2gAIAQEAAT8hE213W4tcxJUhjqN2gbGQnm6ADkcdwGCA0gI0nRS6U2t7t8erA8wT6wWiUFcET5zZQAPLQULQq2s9/9oADAMBAAIAAwAAABCg7//EABkRAQEBAQEBAAAAAAAAAAAAAAERITFB4f/aAAgBAwEBPxAL8IAXAikOipeT1/WXrNW1uud+3//EABoRAQEAAwEBAAAAAAAAAAAAAAEhABExQbH/2gAIAQIBAT8Qv6+AiK/UAiNZzcgZEQ0Ic39c/8QAFxABAQEBAAAAAAAAAAAAAAAAAQARIf/aAAgBAQABPxAi+wbC5qchygpzuHWe/PBsDppUSNVOkQyBMhLIgmFfE0fSgQOxTcDMhAZb12Ph7zOJ6xQMoS3/2Q=="},"images":{"fallback":{"src":"/static/f886df80774d75f058c8af99f74d4b68/bc134/logo.jpg","srcSet":"/static/f886df80774d75f058c8af99f74d4b68/2278c/logo.jpg 320w,\n/static/f886df80774d75f058c8af99f74d4b68/0f1c0/logo.jpg 640w,\n/static/f886df80774d75f058c8af99f74d4b68/bc134/logo.jpg 1280w","sizes":"(min-width: 1280px) 1280px, 100vw"},"sources":[{"srcSet":"/static/f886df80774d75f058c8af99f74d4b68/378b7/logo.webp 320w,\n/static/f886df80774d75f058c8af99f74d4b68/3c3fb/logo.webp 640w,\n/static/f886df80774d75f058c8af99f74d4b68/c2dd8/logo.webp 1280w","type":"image/webp","sizes":"(min-width: 1280px) 1280px, 100vw"}]},"width":1280,"height":720}},"publicURL":"/static/f886df80774d75f058c8af99f74d4b68/logo.jpg"}}}}]}},"pageContext":{"slug":"/lambda_snap_action/"}},"staticQueryHashes":[]}