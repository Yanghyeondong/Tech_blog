{"componentChunkName":"component---src-templates-post-template-tsx","path":"/os_hw_1/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p><em>해당 포스트는 필자가 직접 풀이한 것으로 오답이나 잘못된 해석이 있을 수도 있습니다.</em><br>\n<em>혹시나 지적할 부분이 있다면 항상 환영입니다!</em> 😏</p>\n<h2 id=\"문제-및-풀이\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EB%B0%8F-%ED%92%80%EC%9D%B4\" aria-label=\"문제 및 풀이 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 및 풀이</h2>\n<h4 id=\"1-write-a-program-that-calls-fork-before-calling-fork-have-the-main-process-access-a-variable-eg-x-and-set-its-value-to-something-eg-100\" style=\"position:relative;\"><a href=\"#1-write-a-program-that-calls-fork-before-calling-fork-have-the-main-process-access-a-variable-eg-x-and-set-its-value-to-something-eg-100\" aria-label=\"1 write a program that calls fork before calling fork have the main process access a variable eg x and set its value to something eg 100 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Write a program that calls fork(). Before calling fork(), have the main process access a variable (e.g., x) and set its value to something (e.g., 100).</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">int</span> x <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"At the start, x is %d\\n\"</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    \r\n    <span class=\"token keyword\">int</span> rc <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fork failed\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// child</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"I am child (pid:%d)\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tnow x is %d\\n\"</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tchange x into %d\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        x <span class=\"token operator\">=</span> <span class=\"token number\">200</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tnow x is %d\\n\"</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// parent</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"I am parent of %d (pid:%d)\\n\"</span><span class=\"token punctuation\">,</span>\r\n\t       rc<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tnow x is %d\\n\"</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tchange x into %d\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">300</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        x <span class=\"token operator\">=</span> <span class=\"token number\">300</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tnow x is %d\\n\"</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>stdout:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">At the start<span class=\"token punctuation\">,</span> x is <span class=\"token number\">100</span>\r\nI am parent of <span class=\"token number\">26124</span> <span class=\"token punctuation\">(</span>pid<span class=\"token operator\">:</span><span class=\"token number\">26123</span><span class=\"token punctuation\">)</span>\r\n        now x is <span class=\"token number\">100</span>\r\n        change x into <span class=\"token number\">300</span>\r\n        now x is <span class=\"token number\">300</span>\r\nI am <span class=\"token function\">child</span> <span class=\"token punctuation\">(</span>pid<span class=\"token operator\">:</span><span class=\"token number\">26124</span><span class=\"token punctuation\">)</span>\r\n        now x is <span class=\"token number\">100</span>\r\n        change x into <span class=\"token number\">200</span></code></pre></div>\n<p>What value is the variable in the child process?<br>\n⇒ child process에서 변수 x의 값은 처음에 설정한 100으로 나타난다. (복제된다)<br>\nWhat happens to the variable when both the child and parent change the value of x?<br>\n⇒ child와 parent는 fork() 전 x 값의 서로 다른 복제본을 사용한다. 따라서 child와 parent가 x를 바꾸더라도 서로 영향이 가지 않게 개별로 변형시킨다. child (x = 100 → 200), parent (x = 100 → 300)</p>\n<h4 id=\"2-write-a-program-that-opens-a-file-with-the-open-system-call-and-then-calls-fork-to-create-a-new-process\" style=\"position:relative;\"><a href=\"#2-write-a-program-that-opens-a-file-with-the-open-system-call-and-then-calls-fork-to-create-a-new-process\" aria-label=\"2 write a program that opens a file with the open system call and then calls fork to create a new process permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Write a program that opens a file (with the open() system call) and then calls fork() to create a new process.</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">int</span> fd <span class=\"token operator\">=</span> <span class=\"token function\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./test.txt\"</span><span class=\"token punctuation\">,</span> O_CREAT<span class=\"token operator\">|</span>O_WRONLY<span class=\"token operator\">|</span>O_TRUNC<span class=\"token punctuation\">,</span> S_IRWXU<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">int</span> rc <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// fork failed; exit</span>\r\n        <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fork failed\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// child</span>\r\n        <span class=\"token keyword\">char</span> sent<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"child\\n\"</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n            <span class=\"token function\">write</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> sent<span class=\"token punctuation\">,</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>sent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// parent</span>\r\n        <span class=\"token keyword\">char</span> sent<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"parent\\n\"</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i<span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">&lt;</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span>i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n            <span class=\"token function\">write</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">,</span> sent<span class=\"token punctuation\">,</span> <span class=\"token function\">strlen</span><span class=\"token punctuation\">(</span>sent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>test.txt: (실행마다 바뀜)</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">parent\r\nparent\r\nparent\r\nparent\r\nparent\r\nparent\r\nchild\r\nparent\r\nchild\r\nparent\r\nchild\r\nparent\r\nchild\r\nparent\r\nchild\r\nchild\r\nchild\r\nchild\r\nchild\r\nchild</code></pre></div>\n<p>Can both the child and parent access the file descriptor returned by open()?<br>\n⇒ child와 parent 모두 file descriptor 접근이 가능하다. write()를 통해 test.txt에 접근 가능함을 확인하였다.<br>\nWhat happens when they are writing to the file concurrently, i.e., at the same time?<br>\n⇒ child와 parent가 동시에 접근할 경우, 출력이 번갈아 되면서 겹치는 부분이 가끔씩 발생하였다. 즉, IO 접근 할당에 따라 child와 parent가 각자의 출력을 번갈아 실행하는 것이 확인된다.</p>\n<h4 id=\"3-write-another-program-using-fork-the-child-process-should-print-hello-the-parent-process-should-print-goodbye-you-should-try-to-ensure-that-the-child-process-always-prints-first\" style=\"position:relative;\"><a href=\"#3-write-another-program-using-fork-the-child-process-should-print-hello-the-parent-process-should-print-goodbye-you-should-try-to-ensure-that-the-child-process-always-prints-first\" aria-label=\"3 write another program using fork the child process should print hello the parent process should print goodbye you should try to ensure that the child process always prints first permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Write another program using fork(). The child process should print “hello”; the parent process should print “goodbye”. You should try to ensure that the child process always prints first;</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">int</span> rc <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// fork failed; exit</span>\r\n        <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fork failed\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// child</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// parent</span>\r\n\r\n        <span class=\"token keyword\">int</span> wc <span class=\"token operator\">=</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token comment\">// sleep(10); </span>\r\n        <span class=\"token comment\">// wait()대신 충분한 sleep()을 사용해도 child가 먼저 print 되도록 가능함.</span>\r\n\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"goodbye\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>stdout:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">hello\r\ngoodbye\r\n</code></pre></div>\n<p>can you do this without calling wait() in the parent?<br>\n⇒ parent 실행 부분에 wait()를 제거하고 sleep() 함수를 추가할 경우, parent가 먼저 실행되더라도 일정시간 뒤에 스케줄러에 의해 child가 실행되어 hello가 먼저 print되도록 만든다. 단, sleep()을 충분히 주지 않을 경우 parent가 먼저 print 될 수도 있다.</p>\n<h4 id=\"4-write-a-program-that-calls-fork-and-then-calls-some-form-of-exec-to-run-the-program-binls-see-if-you-can-try-all-of-the-variants-of-exec-including-on-linux-execl-execle-execlp-execv-execvp-and-execvpe\" style=\"position:relative;\"><a href=\"#4-write-a-program-that-calls-fork-and-then-calls-some-form-of-exec-to-run-the-program-binls-see-if-you-can-try-all-of-the-variants-of-exec-including-on-linux-execl-execle-execlp-execv-execvp-and-execvpe\" aria-label=\"4 write a program that calls fork and then calls some form of exec to run the program binls see if you can try all of the variants of exec including on linux execl execle execlp execv execvp and execvpe permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Write a program that calls fork() and then calls some form of exec() to run the program /bin/ls. See if you can try all of the variants of exec(), including (on Linux) execl(), execle(), execlp(), execv(), execvp(), and execvpe().</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">int</span> rc <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// fork failed; exit</span>\r\n        <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fork failed\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token function\">execl</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/bin/ls\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"ls\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// extern char **environ;</span>\r\n        <span class=\"token comment\">// execle(\"/bin/ls\", \"ls\", NULL, environ);</span>\r\n\r\n        <span class=\"token comment\">// execlp(\"ls\", \"ls\", NULL);</span>\r\n\r\n        <span class=\"token comment\">// char *myargs[2];</span>\r\n        <span class=\"token comment\">// myargs[0] = strdup(\"/bin/ls\");</span>\r\n        <span class=\"token comment\">// myargs[1] = NULL;</span>\r\n        <span class=\"token comment\">// execv(myargs[0], myargs);</span>\r\n\r\n        <span class=\"token comment\">// char *myargs[2];</span>\r\n        <span class=\"token comment\">// myargs[0] = strdup(\"ls\");</span>\r\n        <span class=\"token comment\">// myargs[1] = NULL;</span>\r\n        <span class=\"token comment\">// execvp(myargs[0], myargs);</span>\r\n\r\n        <span class=\"token comment\">/* \r\n        execvpe은 #define _GNU_SOURCE가 필요함.\r\n        */</span>\r\n        <span class=\"token comment\">// extern char **environ;</span>\r\n        <span class=\"token comment\">// char *myargs[2];</span>\r\n        <span class=\"token comment\">// myargs[0] = strdup(\"/bin/ls\");</span>\r\n        <span class=\"token comment\">// myargs[1] = NULL;</span>\r\n        <span class=\"token comment\">// execvpe(myargs[0], myargs, environ);</span>\r\n        \r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// parent</span>\r\n        <span class=\"token keyword\">int</span> wc <span class=\"token operator\">=</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">assert</span><span class=\"token punctuation\">(</span>wc <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>stdout:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token number\">1.</span>c  <span class=\"token number\">3.</span>c  <span class=\"token number\">5.</span>c  <span class=\"token number\">7.</span>c  ans_1<span class=\"token punctuation\">.</span>out  ans_3<span class=\"token punctuation\">.</span>out  ans_5<span class=\"token punctuation\">.</span>out  ans_7<span class=\"token punctuation\">.</span>out  r\r\n<span class=\"token number\">2.</span>c  <span class=\"token number\">4.</span>c  <span class=\"token number\">6.</span>c  <span class=\"token number\">8.</span>c  ans_2<span class=\"token punctuation\">.</span>out  ans_4<span class=\"token punctuation\">.</span>out  ans_6<span class=\"token punctuation\">.</span>out  ans_8<span class=\"token punctuation\">.</span>out  test<span class=\"token punctuation\">.</span>txt</code></pre></div>\n<p>Why do you think there are so many variants of the same basic call?<br>\n⇒ exec() 함수가 여러 개로 파생되는 이유는 디렉토리 이름, 명령라인 인수, 환경변수 등의 여부가 다르기 때문이다. exec 뒤에 l이 붙는 경우는 명령라인 인수를 리스트로 받는 것이고, v가 붙는 것은 명령라인 인수를 배열로 받는 것이다. e가 붙는 것은 환경변수 envp를 받는 것이고, p가 붙는 것은 디렉토리와 파일 이름 전체가 아닌 파일 이름만 받는 것이다. 이렇게 다양한 기능과 옵션에 따라 exec()가 파생되는 것이다.</p>\n<h4 id=\"5-now-write-a-program-that-uses-wait-to-wait-for-the-child-process-to-finish-in-the-parent\" style=\"position:relative;\"><a href=\"#5-now-write-a-program-that-uses-wait-to-wait-for-the-child-process-to-finish-in-the-parent\" aria-label=\"5 now write a program that uses wait to wait for the child process to finish in the parent permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. Now write a program that uses wait() to wait for the child process to finish in the parent.</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">int</span> rc <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// fork failed; exit</span>\r\n        <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fork failed\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// child</span>\r\n        <span class=\"token keyword\">int</span> wc <span class=\"token operator\">=</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"I am child (wc:%d) (pid:%d)\\n\"</span><span class=\"token punctuation\">,</span>\r\n\t        wc<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// parent</span>\r\n        <span class=\"token keyword\">int</span> wc <span class=\"token operator\">=</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"I am parent of %d (wc:%d) (pid:%d)\\n\"</span><span class=\"token punctuation\">,</span>\r\n\t       rc<span class=\"token punctuation\">,</span> wc<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>stdout:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">I am <span class=\"token function\">child</span> <span class=\"token punctuation\">(</span>wc<span class=\"token operator\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>pid<span class=\"token operator\">:</span><span class=\"token number\">31828</span><span class=\"token punctuation\">)</span>\r\nI am parent of <span class=\"token number\">31828</span> <span class=\"token punctuation\">(</span>wc<span class=\"token operator\">:</span><span class=\"token number\">31828</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>pid<span class=\"token operator\">:</span><span class=\"token number\">31827</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>What does wait() return?<br>\n⇒ parent의 경우 wait()는 child의 pid를 return 한다.<br>\nWhat happens if you use wait() in the child?<br>\n⇒ child의 경우 wait()는 -1을 return 한다.</p>\n<h4 id=\"6-write-a-slight-modification-of-the-previous-program-this-time-using-waitpid-instead-of-wait\" style=\"position:relative;\"><a href=\"#6-write-a-slight-modification-of-the-previous-program-this-time-using-waitpid-instead-of-wait\" aria-label=\"6 write a slight modification of the previous program this time using waitpid instead of wait permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. Write a slight modification of the previous program, this time using waitpid() instead of wait().</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">int</span> rc <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// fork failed; exit</span>\r\n        <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fork failed\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// child (new process)</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"I am child (pid:%d)\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// parent goes down this path (original process)</span>\r\n        <span class=\"token keyword\">int</span> wc <span class=\"token operator\">=</span> <span class=\"token function\">waitpid</span><span class=\"token punctuation\">(</span>rc<span class=\"token punctuation\">,</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"I am parent of %d (wc:%d) (pid:%d)\\n\"</span><span class=\"token punctuation\">,</span>\r\n\t       rc<span class=\"token punctuation\">,</span> wc<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>stdout:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">I am <span class=\"token function\">child</span> <span class=\"token punctuation\">(</span>pid<span class=\"token operator\">:</span><span class=\"token number\">32730</span><span class=\"token punctuation\">)</span>\r\nI am parent of <span class=\"token number\">32730</span> <span class=\"token punctuation\">(</span>wc<span class=\"token operator\">:</span><span class=\"token number\">32730</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>pid<span class=\"token operator\">:</span><span class=\"token number\">32729</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>When would waitpid() be useful?<br>\n부모 프로세스가 특정 자식 프로세스를 기다리거나 자식의 종료를 기다리지 않는 등 특수한 조건을 넣고 싶을 때, waitpid()가 유용하다. waidpid 함수는 다음과 같은 인자들을 받는다. pid_t waitpid (pid_t pid, int* status, int options) 여기서 pid는 자식 프로세스의 id를 의미하며, -1, 0 등 값을 바꿈으로써 자식 프로세스 전체를 기다릴 수도, 특정 자식만 기다릴 수도 있다. status의 경우 wait() 함수와 동일한 역할을 하며, options는 WNOHANG과 같이 자식 프로세스의 종료를 기다리지 않는 기능을 한다.</p>\n<h4 id=\"7-write-a-program-that-creates-a-child-process-and-then-in-the-child-closes-standard-output-stdout-fileno\" style=\"position:relative;\"><a href=\"#7-write-a-program-that-creates-a-child-process-and-then-in-the-child-closes-standard-output-stdout-fileno\" aria-label=\"7 write a program that creates a child process and then in the child closes standard output stdout fileno permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. Write a program that creates a child process, and then in the child closes standard output (STDOUT FILENO).</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">int</span> rc <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// fork failed; exit</span>\r\n        <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fork failed\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token comment\">// child: redirect standard output to a file</span>\r\n\t    <span class=\"token function\">close</span><span class=\"token punctuation\">(</span>STDOUT_FILENO<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"I am child (pid:%d)\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">int</span> wc <span class=\"token operator\">=</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token function\">assert</span><span class=\"token punctuation\">(</span>wc <span class=\"token operator\">>=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>stdout:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">   </code></pre></div>\n<p>What happens if the child calls printf() to print some output after closing the descriptor?<br>\n⇒ child가 descriptor(STDOUT FILENO)를 닫은 후 printf()를 호출할 경우, 아무것도 출력되지 않음을 알 수 있다.</p>\n<h4 id=\"8-write-a-program-that-creates-two-children-and-connects-the-standard-output-of-one-to-the-standard-input-of-the-other-using-the-pipe-system-call\" style=\"position:relative;\"><a href=\"#8-write-a-program-that-creates-two-children-and-connects-the-standard-output-of-one-to-the-standard-input-of-the-other-using-the-pipe-system-call\" aria-label=\"8 write a program that creates two children and connects the standard output of one to the standard input of the other using the pipe system call permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8. Write a program that creates two children, and connects the standard output of one to the standard input of the other, using the pipe() system call.</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> argc<span class=\"token punctuation\">,</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>argv<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">int</span> fd<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">int</span> rc_1 <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc_1 <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// fork failed; exit</span>\r\n        <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fork failed\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc_1 <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n\t    <span class=\"token comment\">// child_1</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"I am child_1 (pid:%d)\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">char</span> msg_send<span class=\"token punctuation\">[</span><span class=\"token number\">100</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"i'm child_1. who are you?\"</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\twrite msg to STDOUT_FILENO: %s\\n\"</span><span class=\"token punctuation\">,</span> msg_send<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">dup2</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> STDOUT_FILENO<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">write</span><span class=\"token punctuation\">(</span>STDOUT_FILENO<span class=\"token punctuation\">,</span> msg_send<span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">int</span> rc_2 <span class=\"token operator\">=</span> <span class=\"token function\">fork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc_2 <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token comment\">// fork failed; exit</span>\r\n            <span class=\"token function\">fprintf</span><span class=\"token punctuation\">(</span><span class=\"token constant\">stderr</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fork failed\\n\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token function\">exit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rc_2 <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token comment\">// child_2</span>\r\n            <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"I am child_2 (pid:%d)\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">char</span> msg_get<span class=\"token punctuation\">[</span><span class=\"token number\">100</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\r\n\r\n            <span class=\"token function\">close</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token function\">dup2</span><span class=\"token punctuation\">(</span>fd<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> STDIN_FILENO<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token function\">read</span><span class=\"token punctuation\">(</span>STDIN_FILENO<span class=\"token punctuation\">,</span> msg_get<span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\\tread msg from STDIN_FILENO: %s\\n\"</span><span class=\"token punctuation\">,</span> msg_get<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"I am parents (pid:%d)\\n\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span> <span class=\"token function\">getpid</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token keyword\">int</span> wc_1 <span class=\"token operator\">=</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">int</span> wc_2 <span class=\"token operator\">=</span> <span class=\"token function\">wait</span><span class=\"token punctuation\">(</span><span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>stdout:</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">I am <span class=\"token function\">parents</span> <span class=\"token punctuation\">(</span>pid<span class=\"token operator\">:</span><span class=\"token number\">2213</span><span class=\"token punctuation\">)</span>\r\nI am <span class=\"token function\">child_1</span> <span class=\"token punctuation\">(</span>pid<span class=\"token operator\">:</span><span class=\"token number\">2214</span><span class=\"token punctuation\">)</span>\r\n        write msg to STDOUT_FILENO<span class=\"token operator\">:</span> i'm child_1<span class=\"token punctuation\">.</span> who are you<span class=\"token operator\">?</span>\r\nI am <span class=\"token function\">child_2</span> <span class=\"token punctuation\">(</span>pid<span class=\"token operator\">:</span><span class=\"token number\">2215</span><span class=\"token punctuation\">)</span>\r\n        read msg from STDIN_FILENO<span class=\"token operator\">:</span> i'm child_1<span class=\"token punctuation\">.</span> who are you<span class=\"token operator\">?</span></code></pre></div>\n<p>⇒ 위의 코드는 pipe() 함수로 file descriptor를 만들고, fork() 함수로 child_1과 child_2 자식 프로세스를 만든다. 이때 child_1 은 dup2() 함수를 통해 기존의 STDOUT을 fd[1](output stream)으로 교체하고, child_2은 기존의 STDIN을 fd[0] 로 교체한다. 즉, 한 자식의 standard output을 다른 자식의 standard input으로 만든다. 이경우, child_1이 write를 통해 문자열을 STDOUT로 보내면 child_2가 read를 통해 STDIN에서 받게 된다. 결과적으로 자식 프로세스 간의 통신이 가능해진 것이다.</p>\n<h2 id=\"source\" style=\"position:relative;\"><a href=\"#source\" aria-label=\"source permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Source</h2>\n<ul>\n<li>『Operating Systems: Three Easy Pieces』 <em>-Remzi H. Arpaci-Dusseau 지음</em><br>\n<a href=\"https://pages.cs.wisc.edu/~remzi/OSTEP/\" target=\"_blank\" rel=\"nofollow\">https://pages.cs.wisc.edu/~remzi/OSTEP/</a></li>\n</ul>","id":"fd8c4e6d-92af-55a5-8c17-605b0317764f","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C-%EB%B0%8F-%ED%92%80%EC%9D%B4\">문제 및 풀이</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#1-write-a-program-that-calls-fork-before-calling-fork-have-the-main-process-access-a-variable-eg-x-and-set-its-value-to-something-eg-100\">1. Write a program that calls fork(). Before calling fork(), have the main process access a variable (e.g., x) and set its value to something (e.g., 100).</a></li>\n<li><a href=\"#2-write-a-program-that-opens-a-file-with-the-open-system-call-and-then-calls-fork-to-create-a-new-process\">2. Write a program that opens a file (with the open() system call) and then calls fork() to create a new process.</a></li>\n<li><a href=\"#3-write-another-program-using-fork-the-child-process-should-print-hello-the-parent-process-should-print-goodbye-you-should-try-to-ensure-that-the-child-process-always-prints-first\">3. Write another program using fork(). The child process should print “hello”; the parent process should print “goodbye”. You should try to ensure that the child process always prints first;</a></li>\n<li><a href=\"#4-write-a-program-that-calls-fork-and-then-calls-some-form-of-exec-to-run-the-program-binls-see-if-you-can-try-all-of-the-variants-of-exec-including-on-linux-execl-execle-execlp-execv-execvp-and-execvpe\">4. Write a program that calls fork() and then calls some form of exec() to run the program /bin/ls. See if you can try all of the variants of exec(), including (on Linux) execl(), execle(), execlp(), execv(), execvp(), and execvpe().</a></li>\n<li><a href=\"#5-now-write-a-program-that-uses-wait-to-wait-for-the-child-process-to-finish-in-the-parent\">5. Now write a program that uses wait() to wait for the child process to finish in the parent.</a></li>\n<li><a href=\"#6-write-a-slight-modification-of-the-previous-program-this-time-using-waitpid-instead-of-wait\">6. Write a slight modification of the previous program, this time using waitpid() instead of wait().</a></li>\n<li><a href=\"#7-write-a-program-that-creates-a-child-process-and-then-in-the-child-closes-standard-output-stdout-fileno\">7. Write a program that creates a child process, and then in the child closes standard output (STDOUT FILENO).</a></li>\n<li><a href=\"#8-write-a-program-that-creates-two-children-and-connects-the-standard-output-of-one-to-the-standard-input-of-the-other-using-the-pipe-system-call\">8. Write a program that creates two children, and connects the standard output of one to the standard input of the other, using the pipe() system call.</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#source\">Source</a></p>\n</li>\n</ul>","frontmatter":{"title":"OS: Three Easy Pieces [Remzi] <5.Process API> 풀이","summary":"교재 Operating Systems: Three Easy Pieces [Remzi] 속 Homework 문제 풀이","date":"2023.08.20.","categories":["OS"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABESAAAREgEAwpvaAAABrklEQVQozzWSPa/qMAyG08RN4iRNvxADGwL1qiBoqaAduiAhMfADGEAV450Y2BD8+atTn/sMUeTYsvO+ZlEUOeeUUgCgtZZSGmMQ0VqrlPLex3EMAFEUAQAiAoBSii5MSqlG4ji21mZZhohJkiBilmXWWmNMFEVCCMr03mutAUBKyYQQnPMgCIQQv6ERzrmUEgAoQY4EQcAYU0pxzn87c86ttcfjcbvdFkWxXq/7vu+6bj6fV1V1Op2apun7vqqqpmkWiwVNEYYhc85xzrMsu9/v7/d7GIbb7fZ6vYZh+H6/5/P58/n8HXk+n4/H43q9MsZghGmtnXPee6VUnueHw6Esy9Vqtd/v+74vy7Jt2z8jk8lECEFyIqIQgiEi1ZPaZVnWdb3ZbOq67rpuvV4XRbHb7dq2nc1mxhgSIk1T5xwjqYMgoAt9hoQVQmithRD0pLXO89w5J6X8LQYAspROmsI5lyQJ+a+1NsZQkAy31iKiMebHKkQk6eM4FiNku9Y6DEP/H5rZWhtFUZqmy+XypzNV0pIBQBiGAOC9R0SayHtP24KI0+m0LMumaS6Xyz8ykDVBPPlfZQAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/5e3e112afb9c9c7bd4c291006dba33a4/3739d/book2.png","srcSet":"/static/5e3e112afb9c9c7bd4c291006dba33a4/da853/book2.png 141w,\n/static/5e3e112afb9c9c7bd4c291006dba33a4/9f0de/book2.png 283w,\n/static/5e3e112afb9c9c7bd4c291006dba33a4/3739d/book2.png 565w","sizes":"(min-width: 565px) 565px, 100vw"},"sources":[{"srcSet":"/static/5e3e112afb9c9c7bd4c291006dba33a4/cdf2b/book2.webp 141w,\n/static/5e3e112afb9c9c7bd4c291006dba33a4/d9fe4/book2.webp 283w,\n/static/5e3e112afb9c9c7bd4c291006dba33a4/8b8b9/book2.webp 565w","type":"image/webp","sizes":"(min-width: 565px) 565px, 100vw"}]},"width":565,"height":306}},"publicURL":"/static/5e3e112afb9c9c7bd4c291006dba33a4/book2.png"}}}}]}},"pageContext":{"slug":"/os_hw_1/"}},"staticQueryHashes":[]}