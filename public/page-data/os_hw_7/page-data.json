{"componentChunkName":"component---src-templates-post-template-tsx","path":"/os_hw_7/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p><em>해당 포스트는 필자가 직접 풀이한 것으로 오답이나 잘못된 해석이 있을 수도 있습니다.</em><br>\n<em>혹시나 지적할 부분이 있다면 항상 환영입니다!</em> 😏</p>\n<h2 id=\"문제-및-풀이\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EB%B0%8F-%ED%92%80%EC%9D%B4\" aria-label=\"문제 및 풀이 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 및 풀이</h2>\n<h4 id=\"1-first-lets-make-sure-you-understand-how-the-programs-generally-work-and-some-of-the-key-options-study-the-code-in-vector-deadlockc-as-well-as-in-main-commonc-and-related-files-now-run-vector-deadlock--n-2--l-1--v-which-instantiates-two-threads--n-2-each-of-which-does-one-vector-add--l-1-and-does-so-in-verbose-mode--v-make-sure-you-understand-the-output-how-does-the-output-change-from-run-to-run\" style=\"position:relative;\"><a href=\"#1-first-lets-make-sure-you-understand-how-the-programs-generally-work-and-some-of-the-key-options-study-the-code-in-vector-deadlockc-as-well-as-in-main-commonc-and-related-files-now-run-vector-deadlock--n-2--l-1--v-which-instantiates-two-threads--n-2-each-of-which-does-one-vector-add--l-1-and-does-so-in-verbose-mode--v-make-sure-you-understand-the-output-how-does-the-output-change-from-run-to-run\" aria-label=\"1 first lets make sure you understand how the programs generally work and some of the key options study the code in vector deadlockc as well as in main commonc and related files now run vector deadlock  n 2  l 1  v which instantiates two threads  n 2 each of which does one vector add  l 1 and does so in verbose mode  v make sure you understand the output how does the output change from run to run permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. First let’s make sure you understand how the programs generally work, and some of the key options. Study the code in vector-deadlock.c, as well as in main-common.c and related files. Now, run ./vector-deadlock -n 2 -l 1 -v, which instantiates two threads (-n 2), each of which does one vector add (-l 1), and does so in verbose mode (-v). Make sure you understand the output. How does the output change from run to run?</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>deadlock <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1</span> <span class=\"token operator\">-</span>v\r\n<span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>deadlock <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1</span> <span class=\"token operator\">-</span>v\r\n<span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>deadlock <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1</span> <span class=\"token operator\">-</span>v\r\n<span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>실행시마다 좌측과 우측의 출력 순서가 가끔씩 바뀌는 모습을 보인다. 즉, 쓰레드의 순서가 조금씩 바뀌는 것을 확인할 수 있다.</p>\n<h4 id=\"2-now-add-the--d-flag-and-change-the-number-of-loops--l-from-1-to-higher-numbers-what-happens-does-the-code-always-deadlock\" style=\"position:relative;\"><a href=\"#2-now-add-the--d-flag-and-change-the-number-of-loops--l-from-1-to-higher-numbers-what-happens-does-the-code-always-deadlock\" aria-label=\"2 now add the  d flag and change the number of loops  l from 1 to higher numbers what happens does the code always deadlock permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Now add the -d flag, and change the number of loops (-l) from 1 to higher numbers. What happens? Does the code (always) deadlock?</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">&lt;</span><span class=\"token operator\">-</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n              <span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token operator\">-></span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token operator\">^</span>C</code></pre></div>\n<p>항상은 아니고 가끔씩 deadlock 에 빠지는 경우가 있다.</p>\n<h4 id=\"3-how-does-changing-the-number-of-threads--n-change-the-outcome-of-the-program-are-there-any-values-of--n-that-ensure-no-deadlock-occurs\" style=\"position:relative;\"><a href=\"#3-how-does-changing-the-number-of-threads--n-change-the-outcome-of-the-program-are-there-any-values-of--n-that-ensure-no-deadlock-occurs\" aria-label=\"3 how does changing the number of threads  n change the outcome of the program are there any values of  n that ensure no deadlock occurs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. How does changing the number of threads (-n) change the outcome of the program? Are there any values of -n that ensure no deadlock occurs?</h4>\n<p><code class=\"language-text\">-n</code>의 값이 늘어나면 데드락이 더 자주 걸리는 것 같은 느낌이다. 당연하게도, 쓰레드의 개수 <code class=\"language-text\">-n</code> 이 2개 이상이 아니라면 deadlock이 발생하지 않는다. 즉, <code class=\"language-text\">-n</code> &#x3C; 2 인 경우 deadlock이 불가능하다.</p>\n<h4 id=\"4-now-examine-the-code-in-vector-global-orderc-first-make-sure-you-understand-what-the-code-is-trying-to-do-do-you-understand-why-the-code-avoids-deadlock-also-why-is-there-a-special-case-in-this-vector-add-routine-when-the-source-and-destination-vectors-are-the-same\" style=\"position:relative;\"><a href=\"#4-now-examine-the-code-in-vector-global-orderc-first-make-sure-you-understand-what-the-code-is-trying-to-do-do-you-understand-why-the-code-avoids-deadlock-also-why-is-there-a-special-case-in-this-vector-add-routine-when-the-source-and-destination-vectors-are-the-same\" aria-label=\"4 now examine the code in vector global orderc first make sure you understand what the code is trying to do do you understand why the code avoids deadlock also why is there a special case in this vector add routine when the source and destination vectors are the same permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Now examine the code in vector-global-order.c. First, make sure you understand what the code is trying to do; do you understand why the code avoids deadlock? Also, why is there a special case in this vector add() routine when the source and destination vectors are the same?</h4>\n<p><code class=\"language-text\">v_dst</code>와 <code class=\"language-text\">v_src</code> 값의 차이에 따라서 <code class=\"language-text\">mutex_lock</code> 순서를 바꿔주기 때문에 avoids deadlock 이 가능하다. 그리고 special case가 있는 이유는 <code class=\"language-text\">v_dst</code>와 <code class=\"language-text\">v_src</code> 가 서로 동일할때 lock을 각자 걸게되면 결국 동일한 lock을 2번 거는게 되어버리기 때문이다. 따라서 special case로 이러한 상황을 처리해주게 된다.</p>\n<h4 id=\"5-now-run-the-code-with-the-following-flags--t--n-2--l-100000--d-how-long-does-the-code-take-to-complete-how-does-the-total-time-change-when-you-increase-the-number-of-loops-or-the-number-of-threads\" style=\"position:relative;\"><a href=\"#5-now-run-the-code-with-the-following-flags--t--n-2--l-100000--d-how-long-does-the-code-take-to-complete-how-does-the-total-time-change-when-you-increase-the-number-of-loops-or-the-number-of-threads\" aria-label=\"5 now run the code with the following flags  t  n 2  l 100000  d how long does the code take to complete how does the total time change when you increase the number of loops or the number of threads permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. Now run the code with the following flags: -t -n 2 -l 100000 -d. How long does the code take to complete? How does the total time change when you increase the number of loops, or the number of threads?</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">100000</span> <span class=\"token operator\">-</span>d\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.08</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span> <span class=\"token operator\">-</span>d\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.59</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">10000000</span> <span class=\"token operator\">-</span>d\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">4.87</span> seconds</code></pre></div>\n<p><code class=\"language-text\">-l</code> 의 값을 늘릴경우 실행시간이 점점 길어지는 모습을 보인다. 정확히 비례하지는 않지만, <code class=\"language-text\">-l</code> 이 증가함에따라 같이 증가하는 모습을 보인다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">100000</span> <span class=\"token operator\">-</span>d\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.08</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">4</span> <span class=\"token operator\">-</span>l <span class=\"token number\">100000</span> <span class=\"token operator\">-</span>d\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.25</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">8</span> <span class=\"token operator\">-</span>l <span class=\"token number\">100000</span> <span class=\"token operator\">-</span>d\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.64</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">16</span> <span class=\"token operator\">-</span>l <span class=\"token number\">100000</span> <span class=\"token operator\">-</span>d\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">1.96</span> seconds</code></pre></div>\n<p><code class=\"language-text\">-n</code> 의 값을 늘릴경우 실행시간이 점점 길어지는 모습을 보인다.</p>\n<h4 id=\"6-what-happens-if-you-turn-on-the-parallelism-flag--p-how-much-would-you-expect-performance-to-change-when-each-thread-is-working-on-adding-different-vectors-which-is-what--p-enables-versus-working-on-the-same-ones\" style=\"position:relative;\"><a href=\"#6-what-happens-if-you-turn-on-the-parallelism-flag--p-how-much-would-you-expect-performance-to-change-when-each-thread-is-working-on-adding-different-vectors-which-is-what--p-enables-versus-working-on-the-same-ones\" aria-label=\"6 what happens if you turn on the parallelism flag  p how much would you expect performance to change when each thread is working on adding different vectors which is what  p enables versus working on the same ones permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. What happens if you turn on the parallelism flag (-p)? How much would you expect performance to change when each thread is working on adding different vectors (which is what -p enables) versus working on the same ones?</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">100000</span> <span class=\"token operator\">-</span>d <span class=\"token operator\">-</span>p\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.08</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">4</span> <span class=\"token operator\">-</span>l <span class=\"token number\">100000</span> <span class=\"token operator\">-</span>d <span class=\"token operator\">-</span>p\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.05</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">8</span> <span class=\"token operator\">-</span>l <span class=\"token number\">100000</span> <span class=\"token operator\">-</span>d <span class=\"token operator\">-</span>p\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.09</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">16</span> <span class=\"token operator\">-</span>l <span class=\"token number\">100000</span> <span class=\"token operator\">-</span>d <span class=\"token operator\">-</span>p\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.11</span> seconds</code></pre></div>\n<p>이전과 비교했을때 -n 의 값이 증가하더라도 실행시간에 엄청 큰 영향을 미치지는 않았다. 서로 병렬로 실행됨에 따라 각 쓰레드가 대기하는 시간이 없어져서 그런 것으로 예상된다.</p>\n<h4 id=\"7-now-lets-study-vector-try-waitc-first-make-sure-you-understand-the-code-is-the-first-call-to-pthread-mutex-trylock-really-needed-now-run-the-code-how-fast-does-it-run-compared-to-the-global-order-approach-how-does-the-number-of-retries-as-counted-by-the-code-change-as-the-number-of-threads-increases\" style=\"position:relative;\"><a href=\"#7-now-lets-study-vector-try-waitc-first-make-sure-you-understand-the-code-is-the-first-call-to-pthread-mutex-trylock-really-needed-now-run-the-code-how-fast-does-it-run-compared-to-the-global-order-approach-how-does-the-number-of-retries-as-counted-by-the-code-change-as-the-number-of-threads-increases\" aria-label=\"7 now lets study vector try waitc first make sure you understand the code is the first call to pthread mutex trylock really needed now run the code how fast does it run compared to the global order approach how does the number of retries as counted by the code change as the number of threads increases permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. Now let’s study vector-try-wait.c. First make sure you understand the code. Is the first call to pthread mutex trylock() really needed? Now run the code. How fast does it run compared to the global order approach? How does the number of retries, as counted by the code, change as the number of threads increases?</h4>\n<p>해당 코드가 꼭 필요하지는 않다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>try<span class=\"token operator\">-</span>wait <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span>\r\nRetries<span class=\"token operator\">:</span> <span class=\"token number\">69399</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">1.05</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.60</span> seconds</code></pre></div>\n<p><code class=\"language-text\">global order approach</code> 에 비해 <code class=\"language-text\">vector-try-wait</code>의 시간이 조금더 걸리는 것을 볼 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.69</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">4</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">2.19</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">8</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">5.67</span> seconds</code></pre></div>\n<p><code class=\"language-text\">-n</code>의 개수가 늘수록 <code class=\"language-text\">Retries</code>와 <code class=\"language-text\">Time</code>도 확연히 많아지는 모습을 보인다.</p>\n<h4 id=\"8-now-lets-look-at-vector-avoid-hold-and-waitc-what-is-the-main-problem-with-this-approach-how-does-its-performance-compare-to-the-other-versions-when-running-both-with--p-and-without-it\" style=\"position:relative;\"><a href=\"#8-now-lets-look-at-vector-avoid-hold-and-waitc-what-is-the-main-problem-with-this-approach-how-does-its-performance-compare-to-the-other-versions-when-running-both-with--p-and-without-it\" aria-label=\"8 now lets look at vector avoid hold and waitc what is the main problem with this approach how does its performance compare to the other versions when running both with  p and without it permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8. Now let’s look at vector-avoid-hold-and-wait.c. What is the main problem with this approach? How does its performance compare to the other versions, when running both with -p and without it?</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>avoid<span class=\"token operator\">-</span>hold<span class=\"token operator\">-</span>and<span class=\"token operator\">-</span>wait <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">1.13</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>try<span class=\"token operator\">-</span>wait <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span>\r\nRetries<span class=\"token operator\">:</span> <span class=\"token number\">95539</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.90</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.49</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>avoid<span class=\"token operator\">-</span>hold<span class=\"token operator\">-</span>and<span class=\"token operator\">-</span>wait <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span> <span class=\"token operator\">-</span>p\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.65</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>try<span class=\"token operator\">-</span>wait <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span> <span class=\"token operator\">-</span>p\r\nRetries<span class=\"token operator\">:</span> <span class=\"token number\">0</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.25</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span> <span class=\"token operator\">-</span>p\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.27</span> seconds</code></pre></div>\n<p>코드속 주석 <code class=\"language-text\">put GLOBAL lock around all lock acquisition</code> 의 설명처럼 하나를 제외하고 모든 쓰레드에 락이 걸리게되어 속도가 느려진다.</p>\n<h4 id=\"9-finally-lets-look-at-vector-nolockc-this-version-doesnt-use-locks-at-all-does-it-provide-the-exact-same-semantics-as-the-other-versions-why-or-why-not\" style=\"position:relative;\"><a href=\"#9-finally-lets-look-at-vector-nolockc-this-version-doesnt-use-locks-at-all-does-it-provide-the-exact-same-semantics-as-the-other-versions-why-or-why-not\" aria-label=\"9 finally lets look at vector nolockc this version doesnt use locks at all does it provide the exact same semantics as the other versions why or why not permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>9. Finally, let’s look at vector-nolock.c. This version doesn’t use locks at all; does it provide the exact same semantics as the other versions? Why or why not?</h4>\n<p>해당 코드는 다른코드와 다르게 lock이 아닌 <code class=\"language-text\">fetch_and_add()</code> 함수를 사용한다. 코드내의 주석 <a href=\"https://en.wikipedia.org/wiki/Fetch-and-add\" target=\"_blank\" rel=\"nofollow\">https://en.wikipedia.org/wiki/Fetch-and-add</a> 사이트 설명을 보면 알 수 있듯이 CPU instruction atomically 한 성질을 지니기 때문에 lock 처럼 동작할 수 있다.</p>\n<h4 id=\"10-now-compare-its-performance-to-the-other-versions-both-when-threads-are-working-on-the-same-two-vectors-no--p-and-when-each-thread-is-working-on-separate-vectors--p-how-does-this-no-lock-version-perform\" style=\"position:relative;\"><a href=\"#10-now-compare-its-performance-to-the-other-versions-both-when-threads-are-working-on-the-same-two-vectors-no--p-and-when-each-thread-is-working-on-separate-vectors--p-how-does-this-no-lock-version-perform\" aria-label=\"10 now compare its performance to the other versions both when threads are working on the same two vectors no  p and when each thread is working on separate vectors  p how does this no lock version perform permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10. Now compare its performance to the other versions, both when threads are working on the same two vectors (no -p) and when each thread is working on separate vectors (-p). How does this no-lock version perform?</h4>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>avoid<span class=\"token operator\">-</span>hold<span class=\"token operator\">-</span>and<span class=\"token operator\">-</span>wait <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.89</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>try<span class=\"token operator\">-</span>wait <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span>\r\nRetries<span class=\"token operator\">:</span> <span class=\"token number\">85995</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.93</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.50</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>nolock <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">2.54</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>avoid<span class=\"token operator\">-</span>hold<span class=\"token operator\">-</span>and<span class=\"token operator\">-</span>wait <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span> <span class=\"token operator\">-</span>p\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.63</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>try<span class=\"token operator\">-</span>wait <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span> <span class=\"token operator\">-</span>p\r\nRetries<span class=\"token operator\">:</span> <span class=\"token number\">0</span>\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.19</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>global<span class=\"token operator\">-</span>order <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span> <span class=\"token operator\">-</span>p\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.19</span> seconds\r\n<span class=\"token number\">2019312219</span>@swji<span class=\"token operator\">:</span><span class=\"token operator\">~</span><span class=\"token operator\">/</span>hw<span class=\"token operator\">/</span><span class=\"token number\">7</span>$ <span class=\"token punctuation\">.</span><span class=\"token operator\">/</span>vector<span class=\"token operator\">-</span>nolock <span class=\"token operator\">-</span>t <span class=\"token operator\">-</span>n <span class=\"token number\">2</span> <span class=\"token operator\">-</span>l <span class=\"token number\">1000000</span> <span class=\"token operator\">-</span>p\r\nTime<span class=\"token operator\">:</span> <span class=\"token number\">0.96</span> seconds</code></pre></div>\n<p><code class=\"language-text\">-p</code>가 없을때는 다른 버전에 비해 비교적 낮은 성능을 보여주며, -p 옵션이 들어가면 -p가 없을때의 자기 자신보단 빨라지지만 여전히 다른 버전에 비해 낮은 성능을 보여준다.</p>\n<h2 id=\"source\" style=\"position:relative;\"><a href=\"#source\" aria-label=\"source permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Source</h2>\n<ul>\n<li>『Operating Systems: Three Easy Pieces』 <em>-Remzi H. Arpaci-Dusseau 지음</em><br>\n<a href=\"https://pages.cs.wisc.edu/~remzi/OSTEP/\" target=\"_blank\" rel=\"nofollow\">https://pages.cs.wisc.edu/~remzi/OSTEP/</a></li>\n</ul>","id":"5e737dbe-df1d-59ff-b957-73e73906b8d3","tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C-%EB%B0%8F-%ED%92%80%EC%9D%B4\">문제 및 풀이</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#1-first-lets-make-sure-you-understand-how-the-programs-generally-work-and-some-of-the-key-options-study-the-code-in-vector-deadlockc-as-well-as-in-main-commonc-and-related-files-now-run-vector-deadlock--n-2--l-1--v-which-instantiates-two-threads--n-2-each-of-which-does-one-vector-add--l-1-and-does-so-in-verbose-mode--v-make-sure-you-understand-the-output-how-does-the-output-change-from-run-to-run\">1. First let’s make sure you understand how the programs generally work, and some of the key options. Study the code in vector-deadlock.c, as well as in main-common.c and related files. Now, run ./vector-deadlock -n 2 -l 1 -v, which instantiates two threads (-n 2), each of which does one vector add (-l 1), and does so in verbose mode (-v). Make sure you understand the output. How does the output change from run to run?</a></li>\n<li><a href=\"#2-now-add-the--d-flag-and-change-the-number-of-loops--l-from-1-to-higher-numbers-what-happens-does-the-code-always-deadlock\">2. Now add the -d flag, and change the number of loops (-l) from 1 to higher numbers. What happens? Does the code (always) deadlock?</a></li>\n<li><a href=\"#3-how-does-changing-the-number-of-threads--n-change-the-outcome-of-the-program-are-there-any-values-of--n-that-ensure-no-deadlock-occurs\">3. How does changing the number of threads (-n) change the outcome of the program? Are there any values of -n that ensure no deadlock occurs?</a></li>\n<li><a href=\"#4-now-examine-the-code-in-vector-global-orderc-first-make-sure-you-understand-what-the-code-is-trying-to-do-do-you-understand-why-the-code-avoids-deadlock-also-why-is-there-a-special-case-in-this-vector-add-routine-when-the-source-and-destination-vectors-are-the-same\">4. Now examine the code in vector-global-order.c. First, make sure you understand what the code is trying to do; do you understand why the code avoids deadlock? Also, why is there a special case in this vector add() routine when the source and destination vectors are the same?</a></li>\n<li><a href=\"#5-now-run-the-code-with-the-following-flags--t--n-2--l-100000--d-how-long-does-the-code-take-to-complete-how-does-the-total-time-change-when-you-increase-the-number-of-loops-or-the-number-of-threads\">5. Now run the code with the following flags: -t -n 2 -l 100000 -d. How long does the code take to complete? How does the total time change when you increase the number of loops, or the number of threads?</a></li>\n<li><a href=\"#6-what-happens-if-you-turn-on-the-parallelism-flag--p-how-much-would-you-expect-performance-to-change-when-each-thread-is-working-on-adding-different-vectors-which-is-what--p-enables-versus-working-on-the-same-ones\">6. What happens if you turn on the parallelism flag (-p)? How much would you expect performance to change when each thread is working on adding different vectors (which is what -p enables) versus working on the same ones?</a></li>\n<li><a href=\"#7-now-lets-study-vector-try-waitc-first-make-sure-you-understand-the-code-is-the-first-call-to-pthread-mutex-trylock-really-needed-now-run-the-code-how-fast-does-it-run-compared-to-the-global-order-approach-how-does-the-number-of-retries-as-counted-by-the-code-change-as-the-number-of-threads-increases\">7. Now let’s study vector-try-wait.c. First make sure you understand the code. Is the first call to pthread mutex trylock() really needed? Now run the code. How fast does it run compared to the global order approach? How does the number of retries, as counted by the code, change as the number of threads increases?</a></li>\n<li><a href=\"#8-now-lets-look-at-vector-avoid-hold-and-waitc-what-is-the-main-problem-with-this-approach-how-does-its-performance-compare-to-the-other-versions-when-running-both-with--p-and-without-it\">8. Now let’s look at vector-avoid-hold-and-wait.c. What is the main problem with this approach? How does its performance compare to the other versions, when running both with -p and without it?</a></li>\n<li><a href=\"#9-finally-lets-look-at-vector-nolockc-this-version-doesnt-use-locks-at-all-does-it-provide-the-exact-same-semantics-as-the-other-versions-why-or-why-not\">9. Finally, let’s look at vector-nolock.c. This version doesn’t use locks at all; does it provide the exact same semantics as the other versions? Why or why not?</a></li>\n<li><a href=\"#10-now-compare-its-performance-to-the-other-versions-both-when-threads-are-working-on-the-same-two-vectors-no--p-and-when-each-thread-is-working-on-separate-vectors--p-how-does-this-no-lock-version-perform\">10. Now compare its performance to the other versions, both when threads are working on the same two vectors (no -p) and when each thread is working on separate vectors (-p). How does this no-lock version perform?</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#source\">Source</a></p>\n</li>\n</ul>","frontmatter":{"title":"OS: Three Easy Pieces [Remzi] <32.Deadlock> 풀이","summary":"교재 Operating Systems: Three Easy Pieces [Remzi] 속 Homework 문제 풀이","date":"2023.09.03.","categories":["Operating System"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAABESAAAREgEAwpvaAAABrklEQVQozzWSPa/qMAyG08RN4iRNvxADGwL1qiBoqaAduiAhMfADGEAV450Y2BD8+atTn/sMUeTYsvO+ZlEUOeeUUgCgtZZSGmMQ0VqrlPLex3EMAFEUAQAiAoBSii5MSqlG4ji21mZZhohJkiBilmXWWmNMFEVCCMr03mutAUBKyYQQnPMgCIQQv6ERzrmUEgAoQY4EQcAYU0pxzn87c86ttcfjcbvdFkWxXq/7vu+6bj6fV1V1Op2apun7vqqqpmkWiwVNEYYhc85xzrMsu9/v7/d7GIbb7fZ6vYZh+H6/5/P58/n8HXk+n4/H43q9MsZghGmtnXPee6VUnueHw6Esy9Vqtd/v+74vy7Jt2z8jk8lECEFyIqIQgiEi1ZPaZVnWdb3ZbOq67rpuvV4XRbHb7dq2nc1mxhgSIk1T5xwjqYMgoAt9hoQVQmithRD0pLXO89w5J6X8LQYAspROmsI5lyQJ+a+1NsZQkAy31iKiMebHKkQk6eM4FiNku9Y6DEP/H5rZWhtFUZqmy+XypzNV0pIBQBiGAOC9R0SayHtP24KI0+m0LMumaS6Xyz8ykDVBPPlfZQAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/5e3e112afb9c9c7bd4c291006dba33a4/3739d/book2.png","srcSet":"/static/5e3e112afb9c9c7bd4c291006dba33a4/da853/book2.png 141w,\n/static/5e3e112afb9c9c7bd4c291006dba33a4/9f0de/book2.png 283w,\n/static/5e3e112afb9c9c7bd4c291006dba33a4/3739d/book2.png 565w","sizes":"(min-width: 565px) 565px, 100vw"},"sources":[{"srcSet":"/static/5e3e112afb9c9c7bd4c291006dba33a4/cdf2b/book2.webp 141w,\n/static/5e3e112afb9c9c7bd4c291006dba33a4/d9fe4/book2.webp 283w,\n/static/5e3e112afb9c9c7bd4c291006dba33a4/8b8b9/book2.webp 565w","type":"image/webp","sizes":"(min-width: 565px) 565px, 100vw"}]},"width":565,"height":306}},"publicURL":"/static/5e3e112afb9c9c7bd4c291006dba33a4/book2.png"}}}}]}},"pageContext":{"slug":"/os_hw_7/"}},"staticQueryHashes":[]}